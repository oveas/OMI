\documentclass[a4paper]{book}
\usepackage{fancyhdr}
\usepackage[pdftex
	,pagebackref=true
	,colorlinks=true
	,linkcolor=blue
	,unicode]{hyperref}
\usepackage{makeidx}
\makeindex
\pagenumbering{roman}
\newcommand{\vs}{\vspace{3mm}}
\newcommand{\lt}{\texttt{<}}
\newcommand{\gt}{\texttt{>}}
\setlength{\parindent}{5mm}
\setcounter{secnumdepth}{4}
\renewcommand{\indent}{\hspace*{5mm}}
\makeatletter
\makeatother
\begin{document}

\title{
OMI v2.6\\
Oscar's Menu Interpreter for VMS\\
Reference Guide}

\author{
Oscar van Eijk\\
Oveas Functionality Provider\\
oscar.van.eijk@oveas.com\\
https://github.com/oveas/OMI}

\date{Belgium, May 16, 2019}

\maketitle

\tableofcontents
\listoffigures
\listoftables

\setcounter{page}{1}
\pagenumbering{arabic}
\chapter*{Preface}\addcontentsline{toc}{chapter}{Preface}
\label{sec:introductione}

Oscar's Menu Interface is a DCL program that reads menu files and 
represents the menu structure on a ChUI based terminal. The layout depends 
on the user specific configuration.

\vs

OMI does not perform any actions on its own. Additional procedures are 
required to handle upon the user input. OMI is strictly created to create a 
standard user interface for all kinds of actions, with a clear structure, 
support for different security levels and password protection.

\vs

The additional procedures that are required for any actions are referred to 
as OMI modules. Several OMI commands have been created for use in OMI 
modules, and with the expandable Toolbox, it's easy to add your own 
commands.

\section*{Known Bugs}\addcontentsline{toc}{section}{Known Bugs}
\label{subsec:known}

The following bugs have not been solved yet: \\
\begin{itemize}
\item When \textsl{OMI{\$}DISPLAY{\_}INFO}\index{OMI commands in 
modules!OMI{\$}DISPLAY{\_}INFO} needs to display a blank line between two 
records, the \textsl{OMI{\$}RECORD}n needs to contain at least one blank. \newline
E.g. when the next three lines need to be displayed:\newline
\indent\textsf{OMI{\$}RECORD1 = "The first line"} \newline
\indent\textsf{OMI{\$}RECORD2 = "" ! A blank line to separate} \newline
\indent\textsf{OMI{\$}RECORD3 = "The last line"} \newline
the command \textsl{OMI{\$}DISPLAY} will display only the first line. This can be 
solved by specifying \textsl{OMI{\$}RECORD2} as \verb*|" "| (a blank).
\item When a \textsl{TEXTAREA} input element is defined with the option \textsl{LARGE} set to \textsl{TRUE}, 
the command \textsl{SHOW TEXTAREA} shows nothing in certain circumstances without 
warning.
\item When a library file is included with \textsl{{\#}INCLUDE}, and duplicate values are 
encountered, a leading value can be specified with the \textsl{{\#}LEADING} attribute 
as described in section \ref{subsubsec:handling}. However, when the 
menu file is validated with the \textsl{/VALIDATE} qualifier, a warning will be 
displayed if the first item of two duplicate item names was specified as 
leading. During run-time this is handled properly.
\item Switching menus using the \textsl{MENU} command causes \texttt{\%OMI-W-DUPL}
messages. After this, OMI can crash at random moments without warning.
\end{itemize}

\section*{About this document}\addcontentsline{toc}{section}{About this document}

\subsection*{Conventions}\addcontentsline{toc}{subsection}{Conventions}

\begin{itemize}
\item[\textsl{Names}] All OMI literal names (filenames, logicals etc) are
displayed in a slanted font.
\item[\textsf{Literals}] This sans-serif font is used when literal text is
displayed as it should be entered by the user.
\item[\textsf{\textit{Variables}}] When the user should replace the text as
displayed with a environment- specific value, the text is printed italic.
\item[\texttt{Examples}] All examples are printed in this monotype font.
\end{itemize}

\section*{Copyright}\addcontentsline{toc}{section}{Copyright}
\label{subsec:copyrightbrary}

The software and all associated files remains the copyright of the author 
but may be freely used and distributed without charge to any other user, 
provided that all copyright notices are retained intact.

\noindent\textbf{{\copyright} 1997-2019\\
Oscar van Eijk - Oveas Funcionality Provider\\
support@oveas.com}\\*[3mm]
This tool is delivered ``as is''. No warranty, express or implied, is 
offered as to the suitability of the software for any purpose. Any errors 
arising from the use of this software, is the responsibility of the user.\\*[3mm]
Support and the latest version is available at \\
\indent\textbf{https://github.com/oveas/OMI/releases} \\
%To stay informed about the changes and fixes, subscribe to the OMI mailing 
%list by sending an email to \textsl{omi-request@oveas.com} with the word 
%\textsl{subscribe} on the subject line. \\
For questions, bug reports, feature requests etc., please use the tracket at GitHub: \\
\indent\textbf{https://github.com/oveas/OMI/issues}

\section*{Acknowledgements}\addcontentsline{toc}{section}{Acknowledgements}

This document was typeset with \LaTeXe\ -- Lesle Lamports document typesetting system
based upon Donald E. Knuth's \TeX.\\
The PDF version was created with \texttt{dvipdf}, GNU Ghostscript 6.52.\\
The Postscript version was created with \texttt{dvips} v5.86. \\
The HTML version was created with LaTeX2HTML v2002 (1.62).

\vs

Henry Juengst made me aware of possible crashes and gave me the code that
resulted in the \texttt{OMI\$INPUT\_VALIDATE} command (v1.0b4). \\
Edward Vlak did some debugging and fixed a possible loop in \texttt{REQUIRED\_ORDER} (v2.2).

\chapter{Installation}
\label{sec:installationrmed}

\section{System installation}
\index{installation}
\label{subsec:system}

To install OMI, download the distribution ZIP file\footnote{ This requires UNZIP for VMS, available from
ftp://www.process.com/vms-freeware/} in BINary format.
Also, download \textsl{OMI{\$}INSTALL.COM} in ASCII format.
 
Next, set default to the directory where the installation
script is located, and issue the command: \\
\indent \textsf{{\$} @OMI{\$}INSTALL}
 

\vs

Follow the instructions to install OMI.
The procedure extracts the distribution and moves all
files to the desired location (that you will be prompted for).
 
The installation procedure also creates the HELP library,
and repairs message datafiles, which have been corrupted
by the distribution.


\begin{figure}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\hrulefill \\
\begin{ttfamily}\begin{small}
{\$} @omi{\$}install  \newline
{\%}OMI-I-INS{\_}ZIP, installing the ZIP distribution \newline
{\_}Install in [{\$}1{\$}DKA200:[APPLIC.OMI]]: \newline
{\%}OMI-I-UNPACK, please wait - unpacking distribution \newline
DELETE {\$}1{\$}DKA200:[TEMP]OMI-V2{\_}1.COM;1 ? [N]: \newline
{\%}OMI-I-EXISTS, OMI{\$}TOOLBOX.INI exists \newline
-OMI-S-TBPATCHED, OMI{\$}TOOLBOX.INI successfully patched \newline
{\%}OMI-I-EXISTS, OMI{\$}MENU.CFG exists \newline
-OMI-I-NEWNAME, installing new config file as OMI{\$}MENU.CFG{\_}NEW \newline
{\%}OMI-I-CREHELP, creating the help library \newline
{\%}OMI-I-MSGREPAIR, repairing the message datafiles - ignore BADMSGFIL messages \newline
{\%}OMI-F-BADMSGFIL, message file corrupt - please repair \newline
{\%}OMI-F-BADMSGFIL, message file corrupt - please repair \newline
{\%}OMI-F-BADMSGFIL, message file corrupt - please repair \newline
{\%}OMIMGT-S-MSGREP, message file for OMIMGT successfully repaired \newline
{\%}OMI-S-INSTALLED, OMI succesfully installed \newline
{\$}
\end{small}\end{ttfamily}
\caption{an OMI installation session}\label{fig:systinst}
\hrulefill
\end{minipage}
\end{figure}


\section{User installation}
\label{subsec:mylabel1}

\subsection{User specific installation}
\index{installation}
\index{installation!user specific}
\label{subsubsec:mylabel1}

Let all the users who will be using OMI execute the procedure
\linebreak\textsl{OMI{\$}USER{\_}INSTALL} once. They should use the command: \\
\indent\textsf{{\$} @\lt\textit{OMI{\_}location}\gt OMI{\$}USER{\_}INSTALL} \\
This will create the file \textsl{OMI{\$}SETUP.COM} in the \textsl{SYS{\$}LOGIN:} directory of 
the user, and creates a user specific directory to contain OMI menu files 
(default is \textsl{[.OMI]} under the \textsl{SYS{\$}LOGIN:}).

Figure \ref{fig:userinst} shows an example session of the \textsl{OMI{\$}USER{\_}INSTALL}
procedure.

\vs

\begin{figure}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\hrulefill \\
\begin{ttfamily}\begin{small}
{\$} @{\$}1{\$}DKA200:[APPLIC.OMI]OMI{\$}USER{\_}INSTALL \newline
Where do you want to store your Menu files (*.MNU) ? \newline
[{\$}1{\$}DKA100:[OSCAR.OMI]]: \newline
Create this directory ? ([Y]/N) \newline
{\%}COPY-S-COPIED, {\$}1{\$}DKA200:[APPLIC.OMI]OMI{\$}MENU.CFG;4 copied to {\$}1{\$}DKA100:[OSCAR]OMI{\$}MENU.CFG;1 (2 blocks) \newline
What will be your default printer ? [SYS{\$}PRINT]:\newline
The file OMI{\$}SETUP.COM has been created in your LOGIN directory. \newline
To be able to use OMI every time you log in, add the command \newline
{\$} @SYS{\$}LOGIN:OMI{\$}SETUP.COM \newline
to your LOGIN.COM \newline
For modifications to the setup file, refer to the comments.\newline
{\%}OMI-S-SETUP, OMI environment successfully initialized \newline
OMI-I-NEWCMD, the new command OMI has been defined \newline
{\$}
\end{small}\end{ttfamily}
\caption{an OMI user installation session}\label{fig:userinst}
\hrulefill
\end{minipage}
\end{figure}

The newly created procedure should be called every time the user logs in, so 
either the command \\
\indent\textsf{{\$} @SYS{\$}LOGIN:OMI{\$}SETUP}\\
should be added to the users \textsl{LOGIN.COM}, or the following lines should be 
added to the system-wide login procedure:\\
\indent\textsf{{\$} IF F{\$}SEARCH("SYS{\$}LOGIN:OMI{\$}SETUP.COM") .NES. ""  THEN - \\
\indent\indent{\$} @SYS{\$}LOGIN:OMI{\$}SETUP}

\vs

Installation is now complete. All users can optionally change the behavior 
of OMI by modifying the file \textsl{OMI{\$}MENU.CFG}, located in their 
\textsl{SYS{\$}LOGIN:}.

\subsection{Shared installation}
\index{installation!group wide}
\label{subsubsec:shared}

To let all users, or groups of users, share OMI installations and 
configurations, one user should execute the file \textsl{OMI{\$}USER{\_}INSTALL}. 
When the procedure asks for a directory to store the Menu files, enter a 
shared directory.

\vs

After installation is completed, move the files \textsl{OMI{\$}SETUP.COM} and
\linebreak\textsl{OMI{\$}MENU.CFG} to a location where all users can read them.

Edit the file \textsl{OMI{\$}SETUP.COM} and search for the following line

\textsf{{\$}! DEFINE /NOLOG OMI{\$}CONFIG \lt\textit{Path and name of your 
configuration file}\gt} \\
Uncomment this, and let the logical point to the shared configuration file.

Repeat these steps for all groups.

\vs

\hspace{-8mm}\textbf{NOTE:} To prevent users to set a key in a shared environment
(see section \ref{subsubsec:mylabel16}), make sure they don't have WRITE privilege on the configuration file!


\section{Upgrades}
\index{installation!upgrades}

If OMI is already installed on your system, and it just needs to be upgraded,
follow the steps in section \ref{subsec:system}. Site specific files will not be
overwritten. \\
User installation (section \ref{subsec:mylabel1}) do not need an upgrade.

Figure \ref{fig:systinst} shows an upgrade where the configuration file \textsl{OMI{\$}MENU.CFG}
is saved, and the toolbox initialisation file \textsl{OMI{\$}TOOLBOX.INI}\index{toolbox!initialisation file} is patched.

\section{Test the installation}
\label{subsec:mylabel2}

To test OMI, you can use the example menu file \textsl{OMI{\$}EXAMPLE.MNU} which 
comes with the distribution. Start this menu with the command \\
\indent\textsf{{\$} OMI OMI{\$}EXAMPLE}\\
This menu performs no other action than displaying information. The 
\textsl{Protected menu} is protected with the password \textsf{test123456789}\footnote{ Passwords are case sensitive.}.

\chapter{Starting OMI}
\label{sec:starting}

When OMI has been set up properly, as described in chapter 
\ref{sec:installationrmed}, OMI can be started from the DCL prompt with the 
command \textsf{OMI}. If the logical \linebreak\textsl{OMI{\$}STARTMENU} is not defined, this 
will display a list of all available menus in the directories \textsl{OMI{\$}:} and 
\textsl{OMI{\$}MENU{\_}DIRECTORY:}.

Since version 1.4, OMI also reads command line qualifiers\footnote{ When qualifiers are used, the first parameter, which refers 
to the menu file, is \textit{always required}, even if the logical \textsl{OMI{\$}STARTMENU} is defined and 
points to the menu file that should be started!}.

\section{Parameters}
\index{OMI!parameters}
\label{subsec:parameters}

When running interactive, OMI supports three parameters, of which the second 
and third are obsolete since version 1.4 However, for backwards 
compatibility, they are still supported. For description of those 
parameters, refer to section \ref{subsubsec:mylabel7}.

\vs

The first parameter is the name of the menu file that should be started. 
This menu file has to be located in the \textsl{OMI{\$}:} or \textsl{OMI{\$}MENU{\_}DIRECTORY:}. 
If the parameter is omitted, and the logical \textsl{OMI{\$}STARTMENU} (see section 
\ref{subsubsec:mylabel14}), a list with available menus is presented, 
from which a selection can be made.

\vs

When running in the background (see section \ref{subsubsec:mylabel2}), 
OMI supports one parameter, which is the name of the module that should be 
started in the background.

\section{Qualifiers}
\index{OMI!qualifiers}
\index{qualifiers}
\label{subsec:qualifiers}

Qualifiers can be specified \textit{after} the first parameter on the DCL
command line.

\subsection{/BACKGROUND[=mode]}
\index{OMI mode!background}
\index{qualifiers!background}
\label{subsubsec:mylabel2}

\vs

\indent\textbf{/BACKGROUND=BATCH} (default) \newline
\indent\textbf{/BACKGROUND=DETACH}\\*[3mm]
Start an OMI module in the background. The first parameter is now an OMI 
module name (\textsl{\textit{filename}.OMI}) in stead of a menu 
name. This module should be created to run unattended (e.g. using Mailboxes 
for communication, refer to chapter \ref{sec:writing} for more 
information on writing OMI modules).

\vs

An OMI module can run as a detached process\index{detached 
process}\index{process!detached} (requires VMS DETACH privilege), or in a 
batch queue\index{batch process}\index{process!batch}.

\subsection{/BATCH}
\index{batch mode}
\index{OMI mode!batch}
\index{qualifiers!batch}
\label{subsubsec:mylabel3}

\vs

\indent\textbf{/BATCH} \newline
\indent\textbf{/NOBATCH} (default)\\*[3mm]
Start OMI in Batch mode. In this mode, all output, written to \textsl{SYS{\$}OUTPUT}, 
is suppressed. This also means the menus are not displayed at all. This 
option is useful when used together with \textsl{/SUBMENU} and \textsl{/JUMPS}.

\subsection{/DEBUG}
\index{debug mode}
\index{OMI mode!debug}
\index{qualifiers!debug}
\index{OMI commands in modules!debugging}
\label{subsubsec:mylabel4}

\indent\textbf{/DEBUG} \newline
\indent\textbf{/NODEBUG} (default\footnote{ By default, debug mode is disabled. 
However, in versions prior to 1.4, the mode was set by the symbol 
\textsl{OMI{\$}{\_}DEBUG}. Setting this symbol to 1 still enables debug mode.\par})\\*[3mm]
By default, all error messages from DCL are suppressed in OMI. If an error 
occurs in OMI, it's handled by OMI itself. This should also be the case in 
all OMI modules, but while these modules are being developed, it is useful 
to see all messages that are generated by VMS.

With the /DEBUG qualifier, all messages will be displayed. If \textsf{SET VERIFY}
is issued before starting OMI, all code is displayed as well.

\vs

This qualifier replaces the symbol \textsl{OMI{\$}{\_}DEBUG}, that was used until 
version 1.3 (however this symbol is still supported).

\subsection{/IGNORE}
\index{ignore warnings}
\index{qualifiers!ignore}
\label{subsubsec:ignore}
\indent\textbf{/NOIGNORE} (default)\newline
\indent\textbf{/IGNORE=\textit{(keyword[,...])}}

Ignore specified warnings or errors during the OMI session.
If you specify only one keyword, you can omit the parentheses.

\subsubsection{DUPLICATES}
\index{ignore!duplicates}
\index{qualifiers!ignore!duplicates}
\index{\%OMI-W-DUPL}
\indent\textbf{/IGNORE=DUPLICATES}

When starting OMI, \texttt{\%OMI-W-DUPL} warnings are displayed when OMI
tries to set a symbol that's already defined. This happens after
a crash of the previous OMI session, when the menu file is invalid,
or when a new OMI session is started in a subprocess from within OMI
(for OTF menus, this is the only way to open a new menu without
leaving the OFT context).

The /IGNORE=DUPLICATES qualifier overwrites all existing symbols
without a warning.
    
\subsubsection{DCLERRORS}
\index{ignore!DCL errors}
\index{qualifiers!ignore!dclerrors}
\indent\textbf{/IGNORE=DCLERRORS}

When a DCL command is given in the menu file, or entered at the OMI 
prompt (commands \texttt{DCL} (\$) or \texttt{SILENT\_DCL}), or when
a subprocess is spawned from the menu file (as an option) or using the
OMI \texttt{SPAWN} command, OMI will catch its exit status and act
accordingly. It the exit code was an error (severity 2), OMI crashes.

The /IGNORE=DCLERRORS qualifier ignores errors generated in such circumstances.

\vs

\textbf{NOTE:} This does not apply to \texttt{(SILENT\_)DCL} or \texttt{SPAWN} action from within OMI modules !
    
\subsubsection{DCLFATALS}
\index{ignore!DCL fatals}
\index{qualifiers!ignore!dclfatals}
\indent\textbf{/IGNORE=DCLFATALS}


This keyword has the same effect as the DCLERRORS keyword, but for
fatal exit codes (severity 4).

Both keywords can be given together as /IGNORE=(DCLERRORS,DCLFATALS).

\subsection{/JUMPS}
\index{auto mode}
\index{qualifiers!jumps}
\label{subsubsec:mylabel5}

\vs

\indent\textbf{/JUMPS=option-list}\\*[3mm]
With the \textsl{/JUMPS} qualifier, all options that are normally entered one by one 
at the OMI prompt, can now be specified at the DCL prompt as a list of 
options separated by comma's. If this list with option contains OMI commands 
with parameters, blanks are required to separate the parameters if they 
should be specified. The option has to be enclosed by double quotes.

\vs

For more info, see \textit{Auto mode} in section \ref{subsubsec:mylabel10}.

\subsection{/PROGRESS}
\index{qualifiers!progress}
\label{subsubsec:mylabel6}

\vs

\indent\textbf{/PROGRESS} \newline
\indent\textbf{/NOPROGRESS}\\*[3mm]
This qualifier can be used to overwrite the \textsl{SHOW{\_}PROGRESS} element from 
the configuration file (see section \ref{para:mylabel2}).

\subsection{/SUBMENU}
\index{auto mode}
\index{qualifiers!submenu}
\label{subsubsec:mylabel7}

\vs

\indent\textbf{/SUBMENU=submenu-name}\\*[3mm]
With the \textsl{/SUBMENU} qualifier, it is possible to start the OMI session with 
the submenu that has the specified name. By default, OMI starts a menu file 
with the main menu (see section \ref{subsubsec:mylabel21}), but when 
one ore more submenus have names (see section \ref{subsubsec:mylabel24}),
OMI can start in one of those menus.

\subsection{/VALIDATE}
\index{validate}
\index{OMI mode!validate}
\index{qualifiers!validate}
\index{menu file!validate}
\label{subsubsec:mylabel8}

\vs

\indent\textbf{/VALIDATE[=log-file]} \newline
\indent\textbf{/NOVALIDATE} (default)\\*[3mm]
This qualifier reads the menu file and validates the syntax line by line. It 
signals errors and warnings when errors or possible errors are found, like 
calling non- existing submenus, commands or modules, missing elements (e.g. 
\textsl{ITEM1}, \textsl{ITEM2}, \textsl{ITEM4}\ldots\footnote{ Although items do not
have to be explicitly numbered (see section \ref{subsec:mylabel4}), this is still supported.
When explicit and implicit numbering is mixed, the validation will also find errors there.}), duplicate elements etc.

\vs

If no errors are warnings are found, this does not guarantee a valid menu, 
since not everything can be checked (especially when variables are used, or 
logicals defined by an \textsl{ON{\_}INIT} module), but it finds the most common 
errors.

\vs

A filename to write all messages to can optionally be specified. If omitted, 
all messages are written to \textsl{SYS{\$}ERROR}.

\vs

This qualifier requires WRITE privilege to the menu.

\chapter{Using OMI Menus}
\label{sec:using}

Oscar's Menu Interface can be used to walk through pre- defined menu 
structures. Such structures are created in \textsl{.MNU} files, which should be 
located in the same directory where OMI resides (referred to with the 
logical OMI{\$}) or a special directory pointed to with the logical 
\textsl{OMI{\$}MENU{\_}DIRECTORY}\index{logical names!OMI{\$}MENU{\_}DIRECTORY}.

To start OMI, just type the command OMI at the DCL prompt. OMI will start a 
menu if:
\begin{enumerate}
\item the logical \textsl{OMI{\$}START{\_}MENU} points to a valid menu file in 
OMI{\$}:\index{logical names!OMI{\$}} (the directory in which OMI is located)
or \textsl{OMI{\$}MENU{\_}DIRECTORY}\index{logical names!OMI{\$}MENU{\_}DIRECTORY}:

\item the file \textsl{OMI{\$}MENU.MNU} exists in \textsl{OMI{\$}:} or
\textsl{OMI{\$}MENU{\_}DIRECTORY}\index{logical names!OMI{\$}MENU{\_}DIRECTORY}:
\end{enumerate}

If none of these are found, a list of all available menus in the directories 
will be displayed, and OMI prompts to specify a menu file. When OMI is 
started with a parameter, the menu file pointed to by that parameter will be 
opened. When that file is not found, the user is prompted to enter a new 
menu file.

\section{Navigating through menus}
\label{subsec:navigating}

OMI Menus display a list of options and/or values that can be filled in, 
further called `options'. To select an option, just type the number on the 
command line.

\vs

OMI commands can also be entered at the command line\footnote{ In 
``on-the-fly'' menus---described in chapter \ref{sec:mylabel2},
not all OMI commands can be used (see also section 
\ref{subsubsec:mylabel66}). The commands that can not be used are 
marked in chapter \ref{sec:mylabel1}.}. All OMI commands are 
described in chapter \ref{sec:mylabel1}, and in the online HELP.

\vs

When more than one input values need to be entered, the option with which all inputs can 
be entered at once, will always be visible. The name of the options depends 
on the setting in the configuration file. By default, this is \textsl{All inputs}.

\vs

To go back one level in the menu structure, you can use the \textsl{BACK}\index{OMI 
commands!BACK} command, the \lt Ctrl/Z\gt{} keystroke, or type a \textsl{0} (zero), 
followed by \lt Return\gt . When the current menu is the top level of the menu 
structure, this will exit OMI.

\subsection{Fast moving}
\label{subsubsec:mylabel9}

In stead of entering the options, or using \textsl{0} or \lt Ctrl/Z\gt , there are 
several commands that can be used for fast navigation. They should be 
entered at the OMI prompt.

\vs

The \textsl{MAIN}\index{OMI commands!MAIN} command jumps immediately to the top-level 
menu from anywhere in the structure. The commands \textsl{EXIT}\index{OMI 
commands!EXIT} or \textsl{QUIT}\index{OMI commands!QUIT} end the OMI session.

\vs

The command \textsl{JUMP}\index{OMI commands!JUMP}, followed by a menu name, jumps to 
the specified submenu. Names can be displayed automatically by changing the 
configuration file (described in chapter \ref{sec:using}), or in a menu using the \textsl{SHOW 
NAME}\index{OMI commands!SHOW NAME}\index{name}\index{menu!name} command.

\vs

When in a menu, a different menu file can be selected with the \textsl{MENU} command, 
followed by the name of the new \textsl{.MNU} file. This command cleans up the 
current menu completely before starting the new menu.

\subsection{Auto mode}
\index{auto mode}
\index{navigating}
\label{subsubsec:mylabel10}

When the user knows all options, a menu can also be called in Auto Mode. 
This means, the menu file is specified as the first parameter for 
OMI\footnote{ If the menu file, pointed to by the logical 
\textsl{OMI{\$}START{\_}MENU} or the file \textsl{OMI{\$}MENU.MNU} needs to be called,
the parameter can be specified empty (\textsl{""})}, followed by the name of a submenu.

\vs

The third parameter can be a list of options that needs to be specified, 
separated by commas. If this list contains OMI commands with blanks in it 
(e.g. \textsl{RESET PASSWORD}), that option has to be enclosed by double quotes, e.g. \\
\indent\textsf{{\$} OMI MY-MENU SUB3 "RESET PASSWORD",EXIT} \\
or \\
\indent\textsf{{\$} OMI MY-MENU /SUBMENU=SUB3 /JUMPS="RESET PASSWORD",EXIT}

The example above would remove the password of the menu with the name \textsl{SUB3}, 
and exit the menu. However, OMI will prompt for the current password when 
entering the menu before executing any command.

\vs

If one of the options selects a TAG list, the Ctrl/Z{} keystroke can be 
emulated with the string \textsl{\^{}Z}\footnote{ = `shift-6' `Z' on VT keyboards}.

\vs

Since version 1.4 qualifiers are also supported. With these qualifiers the 
menu name can also specified as \textsl{/SUBMENU=menu-name}, the list of 
options can be specified with the qualifier \textsl{/JUMPS=options-list}. 
For more info on qualifiers refer to chapter \ref{sec:starting}.

To have a look at the possibilities with this Auto Mode, try starting the 
example menu OMI{\$}EXAMPLE with the following command:\\
\indent\textsf{{\$} OMI OMI{\$}EXAMPLE INPUT 4,5,5,3,10,\^{}Z,3,EXIT} \\
or \\
\indent\textsf{{\$} OMI OMI{\$}EXAMPLE /SUBMENU=INPUT /JUMPS=4,5,5,3,10,\^{}Z,3,EXIT}

\vs

\hspace{-8mm}\textbf{NOTE:} When using qualifiers, the first parameter (the menu file), 
is always required, and has to be entered \textit{before} all qualifiers!

\section{Entering values}
\index{enter input}
\label{subsec:entering}

When an input option is selected, the user is either prompted for a value, 
or a list is displayed from which values can be selected.

Some input options need to have special formats. This depends on the 
definition in the menu file. When a wrong value or format is entered, the 
error message explains what the format should be.

\subsection{Tag lists}
\index{tag lists}
\index{enter input!tagging from a list}
\label{subsubsec:mylabel11}

Some input options display a list of possibilities that can be tagged. If a 
tag option is selected, a list of possible values will be displayed. 
Entering the corresponding numbers will cause the values to be selected and 
added to a list.

\vs

The last option from a tag list is always to reverse the current selection, 
so when a tag list is selected for the first time, and all values need to be 
selected, the last option will do so. After this, the last option will 
deselect all values.

When all required values are selected, use the \lt Ctrl/Z\gt{} keystroke to return 
to the menu.

\subsection{Select lists}
\index{select lists}
\index{enter input!selecting from a list}
\label{subsubsec:select}

If an input option is selected, that can have one value from a predefined 
list, this list is displayed in a pop-up window. When the list is too long 
to fit on one screen, the commands \textsl{NEXT} and \textsl{PREVIOUS} can be used to scroll 
through the list.

Typing the corresponding number, followed by \lt Return\gt , selects that value 
and returns control to the menu. \\
The \lt Ctrl/Z\gt{} keystroke cancels the selection.

\vs

It is possible to have an option defined in a select list, with which a 
value can be entered that is not displayed in the list (a `free' option). If 
this option is selected, OMI will prompt to enter a value.

\vs 

\hspace{-8mm}\textbf{NOTE:} If the values need to have a special format (e.g. an 
uppercase string) it must be entered in the correct format, since unlike the 
usual input option, OMI does not perform any checks or formatting on the 
free option in a select list! (See also section \ref{subsubsec:mylabel39}.)

\subsection{Entering all inputs in a menu}
\label{subsubsec:entering}

When a menu contains more than one input option, the text on the display of the last 
option is the value of \textsl{ALL{\_}INPUTS}\index{OMI commands!ALL}  in the 
\textsl{[QUESTIONS]} section of the configuration file. This option is generated by 
OMI, and allows the user to enter all inputs at once.

\vs

OMI will ask for all required inputs one by one, without the need to select 
the options separately. When any if the inputs is omitted (the user enters 
\lt Return\gt{} without a value), the current value will not be overwritten.

If this is disabled for the current menu (see section \ref{subsubsec:mylabel30}),
this facility can still be used by entering the \textsl{ALL} command at the OMI prompt.

\section{Protected Menus}
\index{password}
\label{subsec:protected}

When a menu is selected that is protected with a password, the Password 
prompt will appear. When an invalid password is entered, for three times in 
a row, access will be denied.

\vs

When the same menu is selected for three times in a row, and an invalid 
password has been entered for nine times in total, the menu will be blocked 
for the current user. An intrusion record is set, that will not disappear 
until the user logs out from the system.

\chapter{Configuration}
\label{sec:configuration}

\section{Logical Names}
\index{logical names}
\label{subsec:logical}

When OMI is installed using the \textsl{OMI{\$}USER{\_}INSTALL} procedure, the file 
\textsl{OMI{\$}SETUP.COM} is created in the users \textsl{SYS{\$}LOGIN:} directory, or in a 
shared directory (refer to section \ref{subsec:mylabel1}). This file 
contains a few logicals, which can be changed manually.

\subsection{OMI{\$}}
\index{logical names!OMI{\$}}
\label{subsubsec:mylabel12}

This logical is not defined in the setup file by default, but can be added 
there. If the logical does not exist when OMI starts, it will be defined 
automatically, and deassigned when OMI exits. \\
This logical points to the location of all OMI files.

\subsection{OMI{\$}MENU{\_}DIRECTORY}
\index{logical names!OMI{\$}MENU{\_}DIRECTORY}
\label{subsubsec:mylabel13}

When this logical exists, OMI looks in the directory or directories where it 
points to for all menu files. If a file is not found here, OMI looks in the 
default directory, pointed to by \textsl{OMI{\$}:}.

\vs

Menu files should be located in one of those directories. If they can't be 
found there, an error message will be displayed. This logical can be defined 
as a search list.

\subsection{OMI{\$}STARTMENU}
\index{logical names!OMI{\$}STARTMENU}
\label{subsubsec:mylabel14}

If this logical is set, it points to the menu file with which OMI starts 
every session. \\
This logical can be user specific or system wide.

\subsection{OMI{\$}CONFIG}
\index{logical names!OMI{\$}CONFIG}
\label{subsubsec:mylabel15}

This logical points to the user specific configuration file. It should 
represent the full path and filename. \\
If not set, OMI looks for the default configuration file \textsl{OMI{\$}MENU.CFG}, 
first in the users \textsl{SYS{\$}LOGIN:}, then in the OMI directory (\textsl{OMI{\$}:}).

\section{Configuration File}
\index{configuration file}
\label{subsec:configuration}

A great deal of the behavior (layout in specific) can be modified using a 
configuration file. This is a file called \textsl{OMI{\$}MENU.CFG}, that should be 
located in the users \textsl{SYS{\$}LOGIN:}, or any other file name in another 
directory, pointed to by the logical \textsl{OMI{\$}CONFIG}\index{logical 
names!OMI{\$}CONFIG} \\
If none of these are found, the default file \textsl{OMI{\$}:OMI{\$}MENU.CFG} is 
used.

\vs

This section describes the elements that can be modified in the file. Some 
values can be empty (only when explicitly said so). All element names are 
case insensitive.

\vs

\hspace{-8mm}\textbf{NOTE:} Blank lines and comments (!) are allowed. Double quotes (") 
are NOT allowed\index{special characters}.

\subsection{[MAIN]}
\label{subsubsec:mylabel16}

This section defines some generally used values.

\paragraph{EMPTY{\_}VALUE}

In menus where input values are displayed, \linebreak\textsl{EMPTY{\_}VALUE} represents the 
way an unspecified value will be displayed. If it shouldn't display 
anything, just remove any value (`\textsl{EMPTY{\_}VALUE =} ').

\paragraph{KEY}

If a key was set using the \textsl{SET KEY}\index{OMI commands!SET KEY} command 
before version 1.3, it will be stored here in the configuration file. The 
key has a binary code, and should not be set or changed manually.

\vs

Since version 1.3, this key cannot be set anymore. Keys are now named and 
stored in the user specific keyring (see section \ref{subsubsec:mylabel20}). \newline
Decryption of strings that were encrypted  with this key before version 1.3 is
still supported.

\paragraph{SILENT{\_}OUTPUT}

If DCL commands are executed in silent mode (using the OMI command 
\textsl{SILENT{\_}DCL}\index{OMI commands!SILENT{\_}DCL}), the output, if any, 
including errors, will be written to the NULL device (\textsl{NLA0:}),
or any file name specified by this element. \\
The final return status of the command will always be displayed.

\paragraph{TIME{\_}FORMAT}
\label{para:mylabel1}

This element can have the values 12 or 24. It specifies the default time 
format for the TIME format type (see section \ref{para:mylabel6}). The
default value is 12.

\paragraph{EDITOR}
\label{para:editorlement}

When you need to use an editor somewhere in an OMI procedure, this symbol 
will be used. Specify any (foreign) command. \\
This setting can be used in OMI modules as: \\
\indent\textsf{{\$} 'MAIN'{\$}EDITOR filename}

\paragraph{FLOAT{\_}POINT}
\index{floating point}
\label{para:float}

Specifies the default character (``.'' or ``,'') that will be used for the 
floating point INTEGER format type (see section \ref{para:mylabel4}).

\paragraph*{VERSION{\_}ID}

This element is obsolete since v1.2.

\paragraph{PROTECT{\_}PROMPT}
\label{para:protect}

When an own prompt is defined (see section \ref{para:option}),
this can be overwritten by a prompt in a chosen menu. Setting 
\linebreak\textsl{PROTECT{\_}PROMPT} to \textsl{1} or \textsl{TRUE}, will tell OMI to use the prompt from 
the configuration file in all menus.

\paragraph{PRINTER}
\index{printer queue}
\index{configuration!printer queue}
\index{queue!printer}

This element can be used to define a user specific printer queue. By 
default, this will be \textsl{SYS{\$}PRINT}. The installation procedure will prompt 
for a default printer (see section \ref{subsec:mylabel1}).

\paragraph{SHOW{\_}PROGRESS}
\label{para:mylabel2}

By default, OMI display the percentage of the menu file that was read during 
initialization. This can be switched off by setting this element to \textsl{FALSE} or \textsl{0}.

\vs

Display the percentage read is useful if large menu files are used, since 
initialization can take pretty long, depending on the system on which OMI 
runs.

\vs

The setting can always be overwritten by specifying the \textsl{/[NO]PROGRESS} 
qualifier when starting OMI from the DCL command line (see section
\ref{subsubsec:mylabel6}).

\subsection{[SCREEN]}
\index{configuration file!modify the layout of OMI}
\label{subsubsec:mylabel17}

This section contains all elements that define the layout of the menu 
screen.

\paragraph{WIDTH{\_}MARGIN}

You can use the full width of the screen (without borderlines at both 
sides), by setting this margin to \textsl{0}. If you do want borders, any value 
(\textit{n}) will cause the leftmost and rightmost \textit{n} columns not to be used.

\paragraph{HEIGHT{\_}MARGIN}

You can use the full height of the screen by setting this margin to \textsl{0}. If 
you do want smaller windows, any value (\textit{n}) will cause the uppermost and 
lowermost \textit{n} lines not to be used.

\paragraph{WIDTH}

The symbol \textsl{WIDTH} allows two values: 80 and 132. Values up to 80 will be 
changed to 80. All values greater than 80 will be changed to 132. It defines 
the screen width of the menu window.

Specify 0 to leave the current screen width unchanged.

\paragraph{HEIGHT}

Define the number of lines the menu should use. It is not recommended to 
change the default value of 24.

Specify 0 to leave the current screen height unchanged.

\paragraph{EXIT{\_}WIDTH}

When leaving the menu, \textsl{EXIT{\_}WIDTH} is the screenwidth that is set on 
exit.

The value '0' can be used to restore to the original value before OMI started.

\paragraph{EXIT{\_}WIDTH}

When leaving the menu, \textsl{EXIT{\_}WIDTH} is the number of lines that the terminal will be set to on exit.

The value '0' can be used to restore to the original value before OMI started.

\paragraph{WINDOW{\_}TOPMARGIN}

Specify the number of lines that should be left blank at the top of the 
window. This is inside the menu window, so is specifies the number of blank 
lines between the menu header and the first line being used.

\paragraph{SCROLL{\_}REGION}

You can enable or disable a \textsl{SCROLL{\_}REGION}. When enabled, a scroll region 
is created, leaving the menu screen intact, for the output of DCL commands.

\paragraph{SCROLLREGION{\_}AUTODISABLE}

Using a scroll region might screw up the menu window when a width margin is 
used, since it does overwrite the left and right borderlines. By setting 
\textsl{SCROLLREGION{\_}AUTODISABLE} to \textsl{1} or \textsl{YES}, the use of a scroll region is 
automatically disabled in this case.

\paragraph{SEPARATE{\_}INPUTS}

This is a boolean, which can be set to \textsl{TRUE} or \textsl{FALSE} (or \textsl{1} or \textsl{0}), that 
specifies whether or not the menu screen should be split in two separate 
parts when input options are specified in the current menu, using the lower 
part of the screen for the input values.

If set to \textsl{FALSE}, all items and inputs will be displayed as one long list, 
which spares the use of two extra lines for separating items and inputs.

\paragraph{DISPLAY{\_}NAMES}

This element, which can be \textsl{TRUE} or \textsl{FALSE}, specifies if menu names should be 
displayed. If set to \textsl{TRUE}, the name of the submenus, if they are set, will 
be displayed in the window, enclosed by brackets.

When set to \textsl{FALSE}, the only way to find the names of menus, is using the 
\textsl{SHOW NAME}\index{OMI commands!SHOW NAME}\index{name}\index{menu!name} command 
when inside the menu.

\paragraph{TAB}

The \textsl{TAB} setting is used when more columns are displayed on the menu screen. 
It specifies the number of blanks between the two columns.

A second column is used to display the values of input options on the menu 
screen, and for tag and select lists if they don't fit in one column.

\subsection{[QUESTIONS]}
\index{configuration file!change the language}
\label{subsubsec:mylabel18}

This section defines the several strings, as they will be displayed whenever 
OMI or the menu needs input. \\
These strings can be used to translate all questions in your native 
language.

\paragraph{ALL{\_}INPUTS}
\index{OMI commands!ALL}
\label{para:mylabel3}

When a menu contains input options, the last option will be to enter all 
values without the need to make the choice for all options separately. This 
element specifies how this choice is represented on the screen.

\paragraph{REVERSE{\_}TAGS}

In tag screens, the last option will reverse the current selection. This 
element specifies how this choice is represented on the screen.

\paragraph{OPTION}\index{prompt!OMI commandline}
\label{para:option}

This element represents the OMI prompt. This can be overwritten by a 
\textsl{PROMPT} element in a menu file, unless the \textsl{PROTECT{\_}PROMPT} (see section 
\ref{para:protect}) is set to \textsl{TRUE}.

\paragraph{INPUT}\index{prompt!inputs}
\label{para:input}

Represents how the user will be prompted to enter input when an input option 
is selected.

If the \textsl{INPUT} item doesn't exist in the configuration file, the first part of the \textsl{INPUT}
item from the menu file is used as prompt (see also section \ref{subsec:mylabel5}).

\paragraph{SELLIST{\_}INPUT}\index{prompt!select lists}
\label{para:sellistinput}

Represents how the user will be prompted to make a selection from a select options in a taglist (section \ref{subsubsec:mylabel39}).

If the \textsl{SELLIST{\_}INPUT} item doesn't exist in the configuration file, the \textsl{INPUT} prompt will be used.

\paragraph{TAGLIST{\_}INPUT}\index{prompt!tag lists}
\label{para:taglistinput}

Represents how the user will be prompted to select multiple options in a taglist (section \ref{subsubsec:mylabel40}).

If the \textsl{TAGLIST{\_}INPUT} item doesn't exist in the configuration file, the default ``\textsl{Select, press \lt\Ctrl/Z\gt\ when done}'' will be used.


\paragraph{DCL{\_}COMMAND}

Represents how the user will be prompted to enter a DCL\index{OMI 
commands!DCL} command.

\paragraph{DEFAULT{\_}CONFIRM}\label{para:defconfirm}

When \textsl{OMI{\$}POPUP} is called with the \textsl{CONFIM} option (see section \ref{subsubsec:mylabel59}, this specifies the question asked for confirmation.

\paragraph{DEFAULT{\_}INPUT}

When input is required for dynamic input (specified by the string \textsl{\~{}?} in the item 
element---see also section \ref{para:dyninput} on page \pageref{para:dyninput}),
this option specifies the default prompt if none is specified in 
the item element (this can by done by adding \textsl{{\{}\textit{prompt}{\}}} to the input string).

\paragraph{CONFIRM}
\label{para:confirmput}

Several commands ask for a confirmation\index{OMI commands!confirmation}
before executing by default. Setting this element to \textsl{FALSE} can change this.

\paragraph{WAIT{\_}PROMPT}

When OMI waits until the user hits return (or any called procedure using the 
\textsl{OMI{\$}WAIT}\index{OMI commands in modules!OMI{\$}WAIT} command), this 
represents the prompt.

\paragraph{ANSWER{\_}YES\\ANSWER{\_}NO}\index{OMI commands!confirmation}

By default, the \textsf{OMI{\$}CONFIRM} command asks the user to enter `Y(es)' or `N(o)' by
default (see section~\ref{subsubsec:mylabel46}. If you want your users to be able tp
answer in their own language on confirmations, these values can be modified with the
values of your choice.\\
E.g., in Dutch, this would: \\
\indent\texttt{answer{\_}yes = J}\\
\indent\texttt{answer{\_}no = N}\\
for `Ja' (Yes) and `Nee' (no).

\subsection{[BGRPROCESS]}
\index{configuration file!OMI background process}
\label{subsubsec:mylabel19}

This section contains all elements that define how background processes 
should be started.

\paragraph{BATCH{\_}QUEUE}

Define which queue should be used when OMI modules are started in a batch. 
Default is \textsl{SYS{\$}BATCH}.\index{batch queue}\index{queue!batch}

\paragraph{DETACHED{\_}LGICMD}

When starting processes in DETACHED mode, the user's \textsl{LOGIN.COM} is 
not executed. Therefore, several logicals, symbols etc. might not be 
available.

This element specifies a command procedure which sets up the proper user 
environment. Default is \textsl{SYS{\$}LOGIN:LOGIN.COM}. \\
The file \textsl{OMI{\$}SETUP.COM} will be executed automatically.

\paragraph{LOGFILE}

Specifies the name of the logfile that will be written by the background 
process. Default is 
\textsl{SYS{\$}LOGIN:OMI{\$}BACKGROUND{\_}\textit{\lt identifier\gt }.LOG}.

\paragraph{OPTIONS{\_}BAT}

Used to add extra qualifiers to the \textsl{SUBMIT} command, eg:\\
\indent\textsf{OPTIONS{\_}BAT = /NOTIFY} \\
For more information, refer to the OpenVMS documentation.

\paragraph{OPTIONS{\_}DET}

Used to add extra qualifiers to the \textsl{RUN /DETACH} command, eg:\\
\indent\textsf{OPTIONS{\_}DET = /JOB{\_}TABLE{\_}QUOTA=8192} \\
For more information, refer to the OpenVMS documentation.

\subsection{[KEYRING]}
\index{keyring}
\index{security!encryption key}
\label{subsubsec:mylabel20}

All encryption keys that are created by the user with the \textsl{SET KEY} command, 
or imported with the \textsl{IMPORT KEY} command, are stored in this section. They 
have a binary value, and cannot be added or modified manually.

\subsection{Adding sections}
\index{configuration file!Adding your own items}
\label{subsubsec:adding}

When you want to create default settings that can be used in your own menus 
and modules, you can add your own sections to the configuration file. \\
E.g., if you want to add a printer queue that can be changed per user for 
use in OMI, the following section and element can be added: \\
\indent\textsf{[MYDEFS]} \\
\indent\indent\textsf{PRINT{\_}QUEUE = MY{\_}PRINTER} \\
If a file needs to be printed on the user specific printer queue, use the command: \\
\indent\textsf{{\$} PRINT /QUEUE='MYDEFS{\$}PRINTER{\_}QUEUE' \textit{filename}}

\vs

\hspace{-8mm}\textbf{NOTE:} Several section names are reserved! They are listed in table 
\ref{tab:ressect}.

\begin{table}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\noindent\textsl{[MAIN]} \newline
\textsl{[SCREEN]} \newline
\textsl{[QUESTIONS]} \newline
\textsl{[BGRPROCESS]} \newline
\textsl{[KEYRING]} \newline
\textsl{[COUNTER]} \newline
\textsl{[INTERACTIVE{\_}AUTH]} \newline
\textsl{[MENU{\_}\textit{*}]} (all sections starting with \textsl{MENU{\_}}) \newline
\caption{Reserved section names}\label{tab:ressect}
\end{minipage}
\end{table}

\vs

It is possible to add elements to existing sections (e.g. adding the 
\linebreak MY{\_}PRINTER element to section \textsl{[MAIN]} would 
result in the symbol \linebreak MAIN{\$}MY{\_}PRINTER), but this is not recommended,
since this might conflict in future releases.

\subsection{Example Configuration file}
\label{subsubsec:example}

Figure \ref{fig:omiconfig} shows how a configuration file can look like.

\begin{figure}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\hrulefill \\
\begin{ttfamily}
\noindent[main] \newline
\indent empty{\_}value = ..... \newline
\indent silent{\_}output = NLA0: \newline
\indent editor = edit/tpu \newline
 \newline
\noindent[screen] \newline
\indent width{\_}margin = 4 \newline
\indent height{\_}margin = 1 \newline
\indent width = 80 \newline
\indent height = 24 \newline
\indent exit{\_}width = 80 \newline
\indent window{\_}topmargin = 1 \newline
\indent scroll{\_}region = enabled \newline
\indent scrollregion{\_}autodisable = y \newline
\indent tab = 8 \newline
 \newline
\noindent[questions] \newline
\indent all{\_}inputs = All Inputs \newline
\indent reverse{\_}tags = Reverse selection \newline
\indent option = OMI\gt  \newline
\indent input = Enter Value \newline
\indent dcl{\_}command = DCL Command \newline
\indent default{\_}input = Input \newline
\indent wait{\_}prompt = Press \lt Return\gt  to continue \newline
\indent answer{\_}yes = Y \newline
\indent answer{\_}no = N \newline
 \newline
\noindent[bgrprocess] \newline
\indent batch{\_}queue = omi{\$}batch \newline
\indent logfile = Omi{\$}:Omi{\$}Background{\_}Process.Log \newline
\indent options{\_}bat = /notify /retain=error \newline
 \newline
\noindent[keyring] ! This section is created by OMI \newline
\indent my{\_}key = \`{O}\`{O}\`{O}\`{O}$^{1}$ \newline
\indent group{\_}key = \`{O}\c{c}\`{O}\`{O}\`{O}$^{1}$ \newline
\indent system{\_}key = \`{O}\'{\i}\`{O}\`{O}\`{O}$^{1}$ \newline
 \newline
\noindent! \newline
\noindent! Below are my personal additions \newline
\noindent! \newline
\noindent[mydefs] \newline
\indent print{\_}queue = my{\_}printer \newline
\indent data{\_}location = device:[data{\_}dir] \newline
\end{ttfamily} \newline
\caption{the OMI configuration file}\label{fig:omiconfig}
\hrulefill
\end{minipage}
\end{figure}

\chapter{Creating Menus}
\label{sec:creating}

The Menu File contains all specifications and actions of the menu 
structures. The files are built with sections, specified as a name between 
square brackets (\textsl{[section{\_}name]}).

\vs

Any section name can be chosen. The elements that are specified in the 
section, are defined as symbols, and are available during the OMI session. \\
E.g. if the following section is defined: \\
\indent\textsf{[MY{\_}SECTION]} \\
\indent\indent\textsf{A{\_}STRING = My String} \\
\indent\indent\textsf{AN{\_}INTEGER = 2} \\
the symbols MY{\_}SECTION{\$}A{\_}STRING (with value ``My String'') and 
\linebreak MY{\_}SECTION{\$}AN{\_}INTEGER (with value 2) are available in OMI.

\vs

These sections are used for defining and configuring the menu structure. For 
special purposes, the section names \textsl{COUNTER}, \textsl{MAIN}, \textsl{SCREEN} and 
\textsl{QUESTIONS}, and all section names starting with \textsl{MENU{\_}} are reserved 
(see also table \ref{tab:ressect} on page \pageref{tab:ressect}).

\section{Defining Menus}
\label{subsec:defining}

The name of a menu section always starts with \textsl{MENU{\_}}, and the main menu 
has to be named \textsl{MENU}, so a section \textsl{[MENU{\_}MENU]} is required. \\
All information, and all elements, of the menu are specified inside a menu 
section.

\subsection{The Main Menu}
\label{subsubsec:mylabel21}

As stated above, every menu file has to contain a section called 
\textsl{[MENU{\_}MENU]}. This is the main menu of the menu file. \\
All elements that will be described below, can be specified in the main 
menu.

\section{Menu Characteristics}
\label{subsec:mylabel3}

Each menu can have unique characteristics, which can make the navigation 
easier. These elements are all optional. Every menu can have it's own 
prompt, title, name and comment line. Title and comment lines will be 
displayed by default.

\subsection{The ON{\_}INIT and ON{\_}EXIT elements}
\label{subsubsec:mylabel22}

When the user starts enters a menu (by starting OMI or by entering a 
sublevel), OMI will execute an OMI module if the menu contains the 
\textsl{ON{\_}INIT} element\index{menu!define an initialisation 
procedure}\index{menu!initialisation module}. This will only be done 
if the user comes from a higher level, \textit{not} when a coming up from a sublevel. \\
If the module returns status \textsl{OMI{\$}{\_}WARNING} (described in chapter \ref{sec:writing}), 
control will not be passed to the selected menu level.

\vs

If a menu contains the \textsl{ON{\_}EXIT} element\index{menu!define an exit 
procedure}\index{menu!exit module}\index{OMI commands!EXIT}, the 
specified exit module will be executed when the user leaves that menu. This 
will only be done if the user leaves a menu to go to a higher level, \textit{not} when a 
submenu is chosen! \\
If the exit module returns status \textsl{OMI{\$}{\_}WARNING} (described in chapter 
\ref{sec:writing}), control will be returned to the current menu.

\vs

If a submenu is left with any of the commands \textsl{MENU}, \textsl{EXIT} or \textsl{QUIT}, OMI will 
check both the current submenu and the main menu for the \textsl{ON{\_}EXIT} element. \\
The default type of init- and exit modules is \textsl{.OMI}. Figure \ref{fig:iemods}
shows the use of init- and exit modules.

\begin{figure}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\hrulefill \\
\noindent Example of the Menu file\newline
\begin{ttfamily}\begin{small}
\noindent [MENU{\_}MENU] \newline
\indent ITEM = Exit the menu{\#}COMMAND{\#}EXIT \newline
\indent ITEM = Start another menu{\#}MENU{\#}OTHER{\_}MENU \newline
\indent ON{\_}INIT\index{menu!define an initialisation procedure} = START{\_}WITH ! This module will be executed when OMI starts \newline
\indent ON{\_}EXIT\index{menu!define an exit procedure} = EXIT{\_}WITH ! This module will be executed when OMI exits \newline
\end{small}\end{ttfamily}
\vspace{1mm} 
\noindent Example of EXIT{\_}WITH.OMI:\newline
\begin{ttfamily}\begin{small}
\noindent{\$} OMI{\$}CONFIRM\index{OMI commands in modules!OMI{\$}CONFIRM} "Are you sure you want to exit ? " - \newline
\indent 'QUESTIONS{\$}ANSWER{\_}NO'
{\$} IF .NOT. OMI{\$}CONFIRMED THEN {\$} EXIT OMI{\$}{\_}WARNING \newline
{\$} EXIT OMI{\$}{\_}OK\newline
\end{small}\end{ttfamily}
\noindent This example shows how you can ask the user for a confirmation before 
actually leaving OMI.
\caption{using initialising- and exit modules in a menu}\label{fig:iemods}\index{menu!define an initialisation procedure}\index{menu!define an exit procedure}
\hrulefill
\end{minipage}
\end{figure}

\subsubsection{Execute OMI commands with ON{\_}INIT and ON{\_}EXIT}

Since version 2.2 it is also possible to execute OMI commands in the
\textsl{ON{\_}INIT}\index{menu!initialisation command} and
\textsl{ON{\_}EXIT}\index{menu!exit command} elements.

To do so, the element value should start a colon (``:''), immediatly followed my the OMI command.
The command will be executed, then control is passed to the selected menu. Figure~\ref{fig:iecmds}
shows an example where all variables in the menu are reset to their default values (using the
command \textsl{RESET VARIABLES}, see section~\ref{subsubsec:resetvar}) when the user leaves the
menu.

The return value of the OMI command is not evaluated.

\begin{figure}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\hrulefill \\
\begin{ttfamily}\begin{small}
\noindent [MENU{\_}ASKINPUT] \newline
\indent ON{\_}EXIT = :RESET VARIABLES BACKGROUND \newline
\indent ITEM  = Back to the main menu{\#}COMMAND{\#}MAIN \newline
\indent ITEM  = Start another menu{\#}MENU{\#}OTHER{\_}MENU \newline
\indent INPUT = Select a day\#\{SEL|WEEKDAYS\}wk\_day\#VALUE1 \newline
\indent INPUT = Enter a time\#tme\#\#FRM\_TIME
\end{small}\end{ttfamily}
\noindent  the variable name \textit{wk\_day} will be reset to it's default value listed as \textit{VALUE1}
in the \textit{WEEKDAYS} select list. The variable \textit{tme} is removed from memory (if it was
set).
\caption{using initialising- and exit commands in a menu}\label{fig:iecmds}
\hrulefill
\end{minipage}
\end{figure}

\subsection{The PROMPT element}
\index{menu!prompt}
\index{prompt}
\label{subsubsec:mylabel23}

The prompt element defines the prompt that 
will show up in the menu. Every submenu can have its own prompt. If none is 
specified, the prompt from the top-level menu is used. If no prompt element 
is found at all, the prompt from the configuration file (element \textsl{OPTION} from 
section \textsl{[QUESTIONS]}) is used. \\
This last prompt will always be used if it is protected (see section \ref{para:protect}).

\subsection{The NAME element}
\index{menu!name}
\index{name}
\label{subsubsec:mylabel24}

The name will only be displayed when the element \textsl{DISPLAY{\_}NAMES} in the 
configuration file is set to \textsl{TRUE}, and with the \textsl{SHOW NAME}\index{OMI 
commands!SHOW NAME} command on the OMI prompt.

\vs

The name is used for the \textsl{JUMP}\index{OMI commands!JUMP} command (see section \ref{subsec:mylabel16}),
and in auto mode (see section \ref{subsubsec:mylabel10}).

\subsection{The COMMENT element}
\index{menu!comment lines}
\label{subsubsec:mylabel25}

Comment lines can contain variables. They should be enclosed by accolades. 
The comment line is displayed on the first line of the menu screen. If the 
comment element is omitted, the menu screen will only display the specified 
elements.

\subsection{The TITLE element}
\index{menu!title}
\label{subsubsec:mylabel26}

The title will be displayed in the title bar of the menu. If omitted, a 
default title will be displayed.

\subsection{The AUTO{\_}REFRESH element}
\index{refresh the screen!automatically}
\label{subsubsec:mylabel27}

When this element is specified, it gives the number of seconds that OMI 
waits for input on the OMI prompt before the menu screen is automatically 
refreshed. The value should be between \textsl{0} and \textsl{255}. When this element is 
omitted, or has value \textsl{0}, the automatic screen refresh is disabled.

\subsection{The AUTO{\_}INCREASE element}
\index{counters!auto increase}
\label{subsubsec:mylabel28}

If a submenu uses a counter from another (higher level) menu, and default 
values are used in array- variables, the counter has to be specified in the 
menu. To prevent the counter from being increased automatically, set the 
\textsl{AUTO{\_}INCREASE} value in the submenu to \textsl{FALSE}. If this element is set to 
\textsl{TRUE} (the default value), the counter value will be increased each time the 
menu is chosen.

\subsection{The REQUIRED{\_}ORDER element}
\index{enter input!required order}
\label{subsubsec:mylabel29}

The user can be forced to enter the input values in a predefined order. This 
can be done with the \textsl{REQUIRED{\_}ORDER} element. Specify the list of values 
in the proper order, separated by comma's, as the value for this element.

\vs

When the user selects an input element that is found in the 
\linebreak\textsl{REQUIRED{\_}ORDER} element, but not as the first one, a warning message is 
displayed, telling the user to select another input element first.

\vs

If the selected element is the first one required, it is removed from the 
list and the user can enter the input. When the list is completely empty 
(all required inputs have been entered in the correct order), no checks will 
be performed until the \textsl{RESET ORDER} (see section 
\ref{subsubsec:mylabel72}) is issued from the menu.

\vs

Using the \textsl{REQUIRED{\_}ORDER} element will set the \textsl{ALL{\_}INPUTS} element (see 
section \ref{subsubsec:mylabel30}) to \textsl{FALSE}.

\begin{figure}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\hrulefill \\
\begin{ttfamily}
\noindent[MENU{\_}INPUTS] \newline
\indent REQUIRED{\_}ORDER = 1,2,3,5 \newline
\indent INPUT = Directory{\#}{\{}SEL\textbar DIRLIST{\}}DIRECT \newline
\indent INPUT = Filename{\#}{\{}SEL\textbar FN{\_}'DIRECT'LIST{\}}FNAME \newline
\indent INPUT = Filetype{\#}{\{}SEL\textbar FTYPELIST{\}}FTYPE \newline
\indent INPUT = Comment{\#}COMMENTLINE \newline
\indent INPUT = Action{\#}{\{}SEL\textbar ACTIONLIST{\}}ACTION \newline
\end{ttfamily}
\noindent This example forces the user to enter input element 1 as the first one. With 
input 1, a value is selected from a select list (select lists are described 
in section \ref{subsubsec:mylabel39}), which is required to determine 
from which select list input 2 has to be selected.
\caption{Force the order in which input is entered}\label{fig:reqorder}
\hrulefill
\end{minipage}
\end{figure}

In figure \ref{fig:reqorder}, input 5 cannot be selected when the inputs 1, 2 and 3 have 
not been selected yet. Input 4 is optional.

\subsection{The ALL{\_}INPUTS element}
\index{enter input!all values}
\label{subsubsec:mylabel30}

By default, OMI will display an option that can be selected to enter all 
input elements without selecting them separately (see also section 
\ref{subsubsec:entering}). Adding the \textsl{ALL{\_}INPUTS} element to a menu 
section with value \textsl{0} or \textsl{FALSE} can disable this.

\vs

This element will be disabled by default when the \textsl{REQUIRED{\_}ORDER} element 
(see section \ref{subsubsec:mylabel29}) is specified for this menu.

\begin{figure}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\hrulefill \\
\noindent Example of MYMENU.MNU: \newline
\begin{ttfamily}
\noindent[MENU{\_}MYMENU] \newline
\indent TITLE\index{title}\index{menu!title} = This is the title of My Menu \newline
\indent NAME\index{name}\index{menu!name} = my{\_}menu ! This element can not contain blanks! \newline
\indent COMMENT\index{menu!comment line}\index{comment lines} = This is an example, username is {\{}OMI{\$}CURRENT{\_}USER{\}} \newline
\end{ttfamily}
\noindent This example shows the use of menu characteristics. The symbol 
\textsl{OMI{\$}CURRENT{\_}USER} will be translated to the current username, and 
displayed on the comment line. This symbol is described in section \ref{subsubsec:symbols}.

The name can be used to let OMI start with MYMENU (specified by the section 
name [MENU{\_}MYMENU], in stead of the main menu \textsl{[MENU{\_}MENU]}, by entering \newline
\indent \textsf{{\$} OMI MYMENU MY{\_}MENU} \newline
on the DCL prompt.

Note that the first parameter (``MYMENU'', which points to the file- name) is 
required, even if the logical \textsl{OMI{\$}START{\_}MENU} points to that file, when 
the menu- name is used as a parameter! (See also section \ref{subsubsec:mylabel10})
\caption{Setting menu characteristics}
\hrulefill
\end{minipage}
\end{figure}

\section{Counters}
\index{counters}
\index{menu!counter}
\label{subsec:counters}

A special menu element is the counter. This defines a variable that will be 
increased every time the menu is called (unless the \textsl{AUTO{\_}INCREASE} item is 
set to \textsl{FALSE}, as described in section \ref{subsubsec:mylabel28}).
The use of counters requires a section \textsl{[COUNTER]}, which contains all counters.

Using this structure, it is possible to define arrays\index{arrays}, as in figure \ref{fig:counter}.

\begin{figure}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\hrulefill \\
\begin{ttfamily}
\noindent[MENU{\_}TEST] \newline
\indent COMMENT\index{menu!comment line}\index{comment lines} = The counter is now {\{}COUNTER{\$}TEST{\_}COUNTER{\}} \newline
\indent ITEM = Display the array{\#}CALL{\#}DISPLAY{\_}ARRAY \newline
\indent INPUT = Enter any value{\#}MY{\_}VAR'COUNTER'{\$}TEST{\_}COUNTER` \newline
\indent COUNTER = TEST{\_}COUNTER \newline
 \newline
\noindent[MENU{\_}TEST2] \newline
\indent . \newline
\indent . \newline
\indent . \newline
\indent COUNTER = TEST{\_}COUNTER \newline
 \newline
\noindent[COUNTER] \newline
\indent TEST{\_}COUNTER = 0 \newline
\end{ttfamily}

\noindent The TEST menu above has a counter that will be increased every time the menu 
is called. After every call, the user can enter a value by selecting the 
option `Enter any value' on the menu screen, which will be stored in the 
variable with the name MY{\_}VARn, where `n' is the current value of the 
counter.

The \textsl{[COUNTER]} section is required to initialize all counters that are used in the 
menu with any value. Most likely, the initial value will be 0, but there's 
no default, so a value has to be specified!

In the example, a second menu, TEST2, uses the same counter. This means, the 
counter is increased every time \textit{any} of the two menus is called! Note that 
one (sub)menu can have only one counter. The total number of counters in the 
menu file is unlimited.

The current value of the counter can be displayed in the comment line, as in 
the example, or with the \textsl{SHOW COUNTER}\index{OMI commands!SHOW COUNTER} 
command.

The option ``Display the array'' calls an example OMI module, 
DISPLAY{\_}ARRAY.OMI, which could be created to display all entered values.
\caption{Using counters}\label{fig:counter}
\hrulefill
\end{minipage}
\end{figure}

\subsection{Manipulating counter values}
\label{subsubsec:manipulating}

Counter values can also be manipulated using commands on the OMI prompt. If 
any of these commands are used, the comment line in figure \ref{fig:counter} will not be 
updated until the screen is refreshed with the \textsl{REFRESH}\index{OMI 
commands!REFRESH} command, except for \textsl{INCREASE}\index{OMI commands!INCREASE} 
command, with which the \textsl{REFRESH} parameter can optionally be specified. \\
The \textsl{INCREASE}\index{OMI commands!INCREASE} command increases the current 
counter value with one.

\vs

If the value needs to be reset to 0\footnote{ NOT the initial value as 
specified in the \textsl{[COUNTER]} section!}\label{fnote:resetcounter},
\newcounter{resetfnote}\setcounter{resetfnote}{\value{footnote}}
use the command \\
\indent\textsf{RESET COUNTER}\index{OMI commands!RESET COUNTER}.

The command \textsl{SET COUNTER}\index{OMI commands!SET COUNTER}\index{menu!counter}, 
followed by an integer value, sets the counter to the specified value.

\vs

For more information about this and other OMI commands, refer to the chapter 
\ref{sec:mylabel1}.

\subsection{Using default values in arrays}
\label{subsubsec:using}

If a submenu uses a counter from another (higher level) menu, and default 
values are used in array- variables, the counter has to be specified in the 
menu.

To prevent the counter from being increased automatically, set the 
\linebreak\textsl{AUTO{\_}INCREASE}\index{menu!counter!disable automatic increase}, value in 
the submenu to \textsl{FALSE}. If this element is set to \textsl{TRUE} or omitted, the counter 
value will be increased each time the menu is chosen.

\section{Security}
\index{security}
\label{subsec:security}

Every menu can be protected using security elements and passwords. Besides 
this, every submenu can also have an owner.

None of these elements are required, and there's no default.

\subsection{The OWNER element}
\index{owner}
\index{menu!owner}
\label{subsubsec:mylabel31}

The owner can be either a single username, or a list of usernames separated 
by commas.

\vs

If an owner is specified for the main menu\index{owner!of the main menu}, 
this user will be considered the owner for the complete menu file (all 
submenus), except for those submenus that have a different owner element.

\vs

If no \textsl{SECURITY} element\index{security}\index{menu!security} is specified, 
all users have \textsl{READ} and \textsl{EXEC} privilege on all menus, except the owner, who 
has \textsl{READ}, \textsl{EXEC} and \textsl{WRITE}.

\subsection{The SECURITY element}
\index{security}
\index{menu!security}
\label{subsubsec:mylabel32}

The \textsl{SECURITY} element\index{security}\index{menu!security} should point to a 
section in the menu file with the security settings for the menu.

\vs

The security section contains a list of usernames with their privileges on 
the selected menu. The use of this section overwrites the default highest 
level for the menu owner.

\vs

By default, users that are not listed, have no access to the menu. This can 
be overwritten with the \textsl{ALL{\_}USERS} element.

Valid security levels are listed in table \ref{tab:seclevels}.

\begin{table}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\begin{tabular}{lp{9cm}} \hline
\textsl{NONE} & The specified user has no access to the menu \\ \hline
\textsl{READ} & The user can enter the menu and see the choices, but cannot execute any of the options, or any command at the command line. The only way to leave the menu is by using \lt Ctrl/Z\gt . \\ \hline
\textsl{EXEC} &  The user has full access to all menu elements for execution \\ \hline
\textsl{WRITE} & The user can make modifications to the menu, using the \textsl{SET} or \textsl{RESET} command \\ \hline
\end{tabular}
\caption{Security levels in Security sections}\label{tab:seclevels}
\end{minipage}
\end{table}

When no security section is used, \textsl{READ, EXEC} is the default for all 
users except for the owner, who'll also have \textsl{WRITE} access.

\subsection{The PASSWORD element}
\index{password}
\index{security!password}
\index{menu!password}
\label{subsubsec:mylabel33}

The \textsl{PASSWORD} element\index{password}\index{security!password}\index{menu!password} holds 
the password in encrypted format. It cannot be modified using an editor; a 
password can only be set or changed with the \textsl{SET PASSWORD}\index{OMI 
commands!SET PASSWORD} command from the OMI prompt.

\vs

If it is required to add a password using the editor anyway, e.g. while 
creating a menu file, this can be done by specifying the password element 
with an equals-sign, but without a value: \\
\indent\textsf{PASSWORD =}\\
The password will default to \textsl{Omi{\$}System} (case sensitive!). This can be 
used as a reminder to change the password interactive.

\vs

The optional \textsl{PASSWORD{\_}LEVEL} element defines the security level for all 
users when a password is required. This is valid for all users, including 
the menu-owner.

If this element is not specified, the default security handling is used.

\vs

The value should be specified as an integer. Table \ref{tab:seclevelint}
provides an overview with the valid values and their corresponding security level.

\begin{table}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\begin{tabular}{ll}\hline
0 & NONE \\
1 & READ \\
2 & EXEC \\
3 & WRITE \\ \hline
\end{tabular} \newline 
\caption{Security levels in the PASSWORD{\_}LEVEL element}\label{tab:seclevelint}
\end{minipage}
\end{table}

\begin{figure}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\hrulefill \\
\begin{ttfamily}
\noindent[MENU{\_}MENU] \newline
\indent OWNER = SYSTEM \newline
\indent SECURITY = TOPLEVEL{\_}SECURITY \newline
\indent ITEM = First submenu{\#}SUBMENU{\#}FIRST \newline
\indent ITEM = Second submenu{\#}SUBMENU{\#}SECOND \newline
 \newline
\noindent[MENU{\_}FIRST] \newline
\indent OWNER = FIELD \newline
\indent PASSWORD = \newline
 \newline
\noindent[MENU{\_}SECOND] \newline
\indent SECURITY = SECONDLEVEL{\_}SECURITY \newline
 \newline
\noindent[TOPLEVEL{\_}SECURITY] \newline
\indent SYSTEM = READ,WRITE,EXEC \newline
\indent FIELD = READ,EXEC \newline
\indent ALL{\_}USERS = NONE ! Default when the SECURITY element\index{security}\index{menu!security} is used \newline
 \newline
\noindent[SECONDLEVEL{\_}SECURITY] \newline
\indent FIELD = READ \newline
\indent ALL{\_}USERS = READ,EXEC \newline
\end{ttfamily}
\noindent The owner of the main menu, and of the menu SECOND, is user SYSTEM. In the 
menu FIRST, the owner is FIELD. This menu is also protected with a 
password\footnote{ which is empty in this example, so it defaults to 
\textsl{Omi{\$}System}, but usually this will contain an encrypted value}.

The \textsl{SECURITY} element\index{security}\index{menu!security} defines the 
privileges for all listed users. If a user is not listed, the privileges 
from the \textsl{ALL{\_}USERS} will be used, or the value 
\textsl{NONE} if \textsl{ALL{\_}USERS} is not specified.

Note that user SYSTEM is granted \textsl{WRITE} on the main menu, even though it's 
the owner. This is necessary since the \textsl{SECURITY} 
element\index{security}\index{menu!security} is used.

In the menu FIRST, all users have \textsl{READ,EXEC} privilege, except user FIELD (the 
owner for that menu), who has \textsl{READ,WRITE,EXEC}, since that menu uses no 
\textsl{SECURITY} element.
\caption{Defining menu security}\label{fig:secexample}
\hrulefill
\end{minipage}
\end{figure}

\subsection{Interactive authorization}
\index{security!interactive dcl}
\index{OMI commands!SPAWN}
\index{OMI commands!DCL}
\index{OMI commands!SILENT{\_}DCL}
\index{OpenVMS prompt}
\index{{\$}}
\label{subsubsec:interactive}

Users can be blocked from using interactive DCL with the \textsl{SPAWN}, \textsl{DCL} or  
\textsl{SILENT{\_}DCL} command by including the section \textsl{[INTERACTIVE{\_}AUTH]} in 
the menu file. This section can contain user names that are, or are not 
authorized to use interactive DCL.

\vs

By default, all users can use DCL. Users that should be blocked can be 
included in this section, with value \textsl{FALSE}.

The default can by overwritten, by including the \textsl{ALL{\_}USERS} with value 
\textsl{FALSE}. All users are now disabled for interactive DCL, except those that are 
explicitly included with value \textsl{TRUE}.

\vs

Note that this does not affect the \textsl{(SILENT{\_})DCL} and \textsl{SPAWN} commands that 
are called by menu items; they can always be executed by all users that have 
\textsl{EXEC} privilege to the submenu that contains the items.

\begin{figure}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\hrulefill \\
\begin{ttfamily}
\noindent[INTERACTIVE{\_}AUTH] \newline
\indent SYSTEM = TRUE \newline
\indent SYSTEST = TRUE \newline
\indent DEVELOPER = TRUE \newline
\indent ALL{\_}USERS = FALSE ! Default is TRUE \newline
 \newline
\noindent[MENU{\_}MENU] \newline
\indent ITEM = Exit{\#}COMMAND{\#}DCL LOGOUT \newline
\indent ITEM = Mail{\#}COMMAND{\#}SPAWN MAIL \newline
\end{ttfamily}

\noindent When the menu file contains this section, the users SYSTEM, SYSTEST and 
DEVELOPER can use the commands \textsl{(SILENT{\_})DCL} and \textsl{SPAWN} at the OMI command 
line, all other users can't.

All users however can execute the items that are given in the main menu in 
the example. 
\caption{Disallow users to use interactive DCL}\label{fig:disallowdcl}
\hrulefill
\end{minipage}
\end{figure}

\section{The ITEM Element}
\label{subsec:mylabel4}

Items are used to define the menu structure, and the actual actions being 
taken. The basic layout of an item element has the keyword ITEM and a value
consisting of three arguments, separated by a hash 
(\textsl{{\#}}): \\
\indent\textsf{ITEM = Text on display{\#}item type{\#}value for type} 

\vs

Up til OMI V2.5, The keyword \textsl{ITEM} had to be followed by an integer, starting with `1', and 
without gaps in the counting, so if a menu has three item options, the 
elements had to be specified as \textsl{ITEM1}, \textsl{ITEM2} and \textsl{ITEM3}.\\
This explicit numbering is still supported, but since V2.6 the items are numbered automatically based
on the order in which they appear in the menufile.\footnote{ \textbf{NOTE:} In on-the-fly menus (see chapter \ref{sec:mylabel2}), items and inputs must still be explicitly numbered!}

\vs

The value of items consists of three arguments, separated by a hash (\textsl{{\#}}). 
The first argument represents how the option will be displayed on the 
window. The second argument specifies the item type, which can be \textsl{CALL}, 
\textsl{COMMAND} or \textsl{SUBMENU}. The meaning of the third argument depends on the item 
type.

\subsection{The CALL item type}
\index{menu actions!call a module}
\label{subsubsec:mylabel34}

The \textsl{CALL} item type\index{menu actions!call a module} specifies that an OMI 
module should be executed. The third argument of the item value should be 
the full path and name of a DCL procedure, without the at-sign (\textsl{@}). The 
default file type for OMI modules is OMI.

\vs

\hspace{-8mm}\textbf{NOTE:} When an OMI module is executed, all error, warning and 
informational messages generated by VMS are suppressed. If you don't want 
this (e.g. while creating and testing menus or modules), use the command \\
\indent\textsf{{\$} SET MESSAGE 'OMI{\$}{\_}MESSAGE'} \\
in the top of the procedure, or start OMI with the qualifier 
\textsl{/DEBUG}\index{debug mode}\index{OMI mode!debug}.

For a further description of OMI modules, refer to chapter \ref{sec:writing}.

\paragraph{Dynamic input}\label{para:dyninput}

If the procedure should be called with parameters, they can be specified in 
the third argument. These parameters, or a part of it, can be 
dynamic\index{dynamic input}. This means, the user is prompted to enter a 
value after selecting the menu option, but before the module is actually 
executed, as in figure \ref{fig:dyninput}.

\begin{figure}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\hrulefill \\
\noindent Extract from a menu file: \newline
\textsf{ITEM = Display the weekday{\#}CALL{\#}DISPLAY WEEKDAY \~{}?{\{}Enter a date{\}}} \newline
\vspace{1mm}
\noindent Example of DISPLAY.OMI: \newline
\begin{ttfamily}
{\$} IF P1 .EQS. "WEEKDAY" THEN {\$} GOTO WEEKDAY{\$} \newline
 . \newline
 . \newline
 . \newline
{\$}WEEKDAY{\$}: \newline
{\$} OMI{\$}DISPLAY{\_}MESSAGE "Weekday for ''p2': ", F{\$}CVTIME(P2,,"WEEKDAY") \newline
{\$} EXIT \newline
\end{ttfamily}
\noindent In this example, the user gets the prompt ``Enter a date'' when the CALL item 
type\index{menu actions!call a module} is selected. After entering a date, 
it will be passed to the module as the third parameter.

The prompt is enclosed by accolades in the item element. If omitted, the 
prompt specified as \textsl{DEFAULT{\_}INPUT} in the \textsl{[QUESTIONS]} section of the 
configuration file is used.
\caption{Using dynamic input in the CALL item type}\label{fig:dyninput}
\hrulefill
\end{minipage}
\end{figure}


Dynamic input can also be validated and formatted using a format section. 
This requires a prompt enclosed by accolades. After the prompt (still 
between the accolades), the name of the format section to use can be 
specified. The prompt and section name are separated by a pipe-sign (\textbar).
This is shown in figure \ref{fig:dyninputformat}.
For more information about formatting sections, refer to section 
\ref{subsubsec:formatting}. \\
Every item can have an unlimited number of dynamic inputs.

\subsection{The COMMAND item type}
\index{menu actions!execute a command}
\label{subsubsec:mylabel35}

The \textsl{COMMAND} item type is used to 
execute an OMI command. The command that should be executed is specified in 
the third argument of the item value, including all keywords and/or 
parameters. As with the \textsl{CALL} item type\index{menu actions!call a module}, a 
command can also have dynamic input\index{dynamic input!formatting}, as can be seen in
figure \ref{fig:dyninputformat}.

\begin{figure}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\hrulefill \\
\begin{ttfamily}
\indent ITEM = Type a text file{\#}COMMAND{\#} DCL TYPE /PAGE - \newline
\indent\indent\~{}?{\{}Filename:\textbar FILE{\_}FORMAT{\}} \newline
 \newline
\noindent [FILE{\_}FORMAT] \newline
\indent TYPE = FILESPEC \newline
\indent REQUIRED = TRUE \newline
\indent FTYPE = .TXT
\end{ttfamily}
\caption{Using dynamic input with a format section}\label{fig:dyninputformat}
\hrulefill
\end{minipage}
\end{figure}

For a further description of OMI modules, refer to chapter \ref{sec:writing}.

\subsection{The SUBMENU item type}
\index{menu actions!call a submenu}
\label{subsubsec:mylabel36}

This item type points to a submenu. The third argument has to contain the 
name of the menu section (without the \textsl{MENU{\_}} string!).

\vs

You can also specify dynamic menus. This is done in the third argument. In 
stead of \textit{my{\_}menu{\_}name}, it should contain the value \\
\textsl{{\{}\textit{Text}\textbar\textit{submenu}{\}}{\{}\textit{Text}\textbar\textit{submenu}{\}}\textit{prompt}},
as in\\
\indent\textsf{ITEM = Choose a submenu{\#}SUBMENU{\#}{\{}First submenu\textbar MYMENU1{\}} - }\\
\indent\indent\textsf{{\{}Second submenu\textbar MYNAME2{\}}Select a menu}

\vs

You can have as many menus in dynamic menu lists as you like, but take care 
the total length of the record in the MNU file, including leading blanks and 
the \textsl{ITEM\textit{n} = }, is less than 256 characters (instead of the VMS default of 
512)\index{menu elements!maximum size}!

Also, if the list is too long, displaying can screw up the window screen. 
This has no effect on the functionality, but the user will have to enter the 
\textsf{REFRESH}\index{OMI commands!REFRESH} command after selecting a menu.

Figure \ref{fig:submenu} illustrates the use of the \textsf{SUBMENU} element.

\begin{figure}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\hrulefill \\
\begin{ttfamily}
\noindent[MENU{\_}MENU] \newline
\indent ITEM = Go to the second Menu{\#}SUBMENU{\#}SECOND{\_}MENU \newline
 \newline
[MENU{\_}SECOND{\_}MENU] \newline
\indent ITEM = Dynamic Menu{\#}SUBMENU{\#}{\{}Menu 1\textbar SUB1{\}} - \newline
\indent\indent{\{}Menu 2\textbar SUB2{\}}Which Menu: \newline
 \newline
[MENU{\_}SUB1] \newline
\indent ! Menu definitions... \newline
 \newline
[MENU{\_}SUB2] \newline
\indent ! Menu definitions... \newline
\end{ttfamily}
\noindent OMI starts with a menu in which an option is displayed that is represented as 
``Go to the second Menu''. When the user chooses this option, the next menu is displayed, 
containing the option ``Dynamic Menu'". Choosing this option, results in the 
following `pop-up' window:

\hspace*{\fill}\fbox{\parbox{5em}{{\textbf{1\gt}} Menu 1 \newline {\textbf{2\gt}} Menu 2}}\hspace*{\fill}

\noindent and on the command line, the prompt ``Which Menu:''. The menu that will be called depends 
on the user input.\caption{Using the SUBMENU element}\label{fig:submenu}
\hrulefill
\end{minipage}
\end{figure}

\section{The INPUT element}
\index{menu actions!read user input}
\index{user input}\index{variables|(}
\label{subsec:mylabel5}

Inputs can be used to collect information from the user, which can be passed 
to OMI modules. Up til OMI V2.5, the khe keyword \textsf{INPUT} had to be followed by an integer, starting with `1', and without gaps in the counting, so if a menu had three input 
options, the elements have to be specified as \textsf{INPUT1}, \textsf{INPUT2} and \textsf{INPUT3}.\\
This syntax is still supported, but if \textsf{INPUT}s are given without number, they will be numbered automatically based on their order in the menufile.

\vs

The value of inputs consists of two to four arguments, separated by a hash 
(\textsf{{\#}}).

The first argument represents how the option will be displayed on the 
window.\\
This part is also used as prompt to ask for user input if the \textsl{[QUESTIONS]} section in the
configuration file doesn't contain an \textsl{INPUT} setting (see also section \ref{para:input})\footnote{ when all inputs are asked
at once using the \textsl{All input} option or the \textsl{ALL} command (see section \ref{subsubsec:entering}), this
part will always be used as prompt.}.

The second argument contains the variable name (the symbol that is defined 
after the user selected the corresponding option). This also indicates the 
input type, which can be `Free input', `Select list'\index{select lists} 
or `Tag list'\index{tag lists}.

The third argument can optionally contain a default value\footnote{ not valid in Tag lists.}.
Default values will be described in section \ref{subsubsec:defaults}

The fourth argument is only valid for the Free input and handles formatting. It will be 
described in section \ref{subsubsec:formatting}.

\subsection{The Free Input element}
\label{subsubsec:mylabel37}

The Free input type is an element that prompts the user for input (using 
the prompt represented by \textsf{INPUT} from the \textsf{[QUESTIONS]} section in the 
configuration file) when selected. The basic layout is as follows:\\
\indent\textsf{INPUT = Text on display{\#}VARIABLE{\_}NAME{\#}default value{\#}format} \\
in which the third argument, `default value', and the fourth argument, 
`format' (described below), are optional.

The default value will be initialized when OMI starts, so if the value is 
changed, and another submenu is chosen, the new value will not be 
overwritten when the same menu is called again.

\vs

The user input can be hidden using the \textsf{\{HIDDEN\}} option:\\ \index{user input!hidden}\index{hidden input}
\indent\textsf{INPUT = Text on display{\#}\{HIDDEN\}VARIABLE{\_}NAME} \\
Using this option, the input will not be echoed to the terminal and in the menu screen it will be
shown as asterisks (\textsl{*******}) making only the length of the input visible.

Note the original input can be displayed by modules, as can be seen in the example menu that comes with OMI.

\vs

If a FORMAT argument is used, without a default value, the default value has 
to be specified empty, as in \\
\indent\textsf{INPUT = Text on display{\#}variable name{\#}{\#}format}

\subsection{Formatting the input}
\index{format input}
\index{user input!formatting and validating}
\index{constants!formatting and validating}
\label{subsubsec:formatting}

If the Free input element contains a fourth argument, this should be the 
name of a format section. This section contains a description of what kind of
input is expected, and/or how the input should be formatted.\\
This applies to constants too if they have a fourth argument (see section \ref{sec:const}).

\vs

The keyword \textsf{TYPE} is required in the format section. This can be \textsf{STRING}, 
\textsf{FILESPEC}, \textsf{INTEGER}, \textsf{DATE} or \textsf{TIME}.

All booleans that can be used in the format sections described below, will 
be \textsf{FALSE} by default if omitted.

\vs

The keywords will either be used for validating the user response, which 
will return a warning message when validation fails (e.g. the \textsf{WILDCARDS} 
keyword in the \textsf{FILESPEC} type\index{filename}\index{format input!filename}), 
or for converting the user input (e.g. the \textsf{UPCASE} keyword in the \textsf{STRING} 
type\index{string}\index{format input!string}). This is described per 
keyword.

Section \ref{subsubsec:mylabel38} shows an example of the use format sections.

\paragraph{The FILESPEC type}
\index{filename}
\index{format input!filename}

This indicates the input should be a filename, with or without a device and 
directory specification.

If the input contains blanks, they will be removed, and the file name will 
automatically be converted to uppercase. \\
Valid keywords are listed in table \ref{tab:filespec}.

\begin{table}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\begin{tabular}{llp{6cm}} \hline
\textsl{REQUIRED} & [\textsf{TRUE} or \textsf{FALSE}] & If set to \textsl{TRUE}, OMI checks to see if the file exists. If not, an error is displayed.\\
\textsl{WILDCARDS} & [\textsf{TRUE} or \textsf{FALSE}] & If set to \textsl{TRUE}, OMI will allow wildcards (`*' and `\%') in the file name.\\
\textsl{FDEVICE} & [\textit{device name}] & This can specify a default device name. \\
\textsl{FDIRECORY} & [\textit{directory name}] & This can specify a default directory name. \\
\textsl{FTYPE} & [\textit{file type}] & This can specify a default file type. \\ \hline
\end{tabular}
\caption{Keywords for the FILESPEC format type}\label{tab:filespec}
\end{minipage}
\end{table}

\paragraph{The STRING type}
\index{string}
\index{format input!string}

This indicates the input should be of the \textsf{STRING} 
type\index{string}\index{format input!string}. An invalid response will 
result in a warning message. \\
Valid keywords are listed in table \ref{tab:string}.

\begin{table}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\begin{tabular}{llp{5cm}} \hline
\textsl{UPCASE} & [\textsf{TRUE} or \textsf{FALSE}] & If set to \textsl{TRUE}, the input string will be converted to uppercase.\\
\textsl{LOWERCASE} & [\textsf{TRUE} or \textsf{FALSE}] & If set to \textsl{TRUE}, the input string will be converted to lowercase.\\
\textsl{COLLAPSE} & [\textsf{TRUE} or \textsf{FALSE}] & If set to \textsl{TRUE}, all blanks and tabs will be removed from the 
input string\footnote{ In versions prior to 2.3, the keyword \textsl{BLANKS} was used for this
format, but this was very confusing, since \textsl{BLANKS = TRUE} would remove 
the blanks---all defaults are FALSE with the formatting keywords. Therefore, \textsl{BLANKS} has been replaced by \textsl{COLLAPSE}.
The \textsl{BLANKS} keyword is still supported, but will be overwritten by \textsl{COLLAPSE} if both are used.} \\
\textsl{MINLENGTH} & [\textit{integer value}] & Minimum number of characters. \\ 
\textsl{MAXLENGTH} & [\textit{integer value}] & Maximum number of characters.\\ 
\textsl{IVCHARS} & [\textit{list of invalid characters}] & Specify a list of characters that are not allowed in the input 
string. If any if the listed characters are encountered, a warning 
message will be displayed\footnote{ This list can NOT contain an exclamation mark (!)or a 
double quote ("). Also, if the list should contain a blank, it 
cannot be the first or the last character of the list, blanks 
are allowed, but have to be enclosed by other characters}.\\
\textsl{ALFANUM} & [\textsf{TRUE} or \textsf{FALSE}] & 
If set to \textsl{TRUE}, the keyword \textsl{IVCHARS} will be filled automatically with the character list: \verb"`'~^!?@#$%&* -+=(){}[]<>:;,.\|/"\footnote{ Unlike the use of \textsl{IVCHARS}
as a keyword directly, the exclamation mark (!) will be added to the list of invalid characters this way, but the
double quote (") still not. The \textsl{ALFANUM} keyword makes sure the formatted string
only accepts all characters (`A'-`Z'), numbers (0-9) and the underline (\_) as valid input.}. This overwrites any other value of \textsl{IVCHARS}! \\ \hline
\end{tabular}
\caption{Keywords for the STRING format type}\label{tab:string}
\end{minipage}
\end{table}

\paragraph{The INTEGER type}
\index{integer}
\index{format input!integer}
\label{para:mylabel4}

This indicates the input should be of the \textsl{INTEGER} 
type\index{integer}\index{format input!integer}. An invalid response will 
result in a warning message. \\
Valid keywords are listed in table \ref{tab:integer}.

\begin{table}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\begin{tabular}{llp{6cm}} \hline
\textsl{MIN} & [\textit{integer value}] & The lowest value allowed. \\
\textsl{MAX} & [\textit{integer value}] & The highest value allowed. \\
\textsl{FLOAT} & [\textsf{TRUE} or \textsf{FALSE}] & Specifies the input value can be a floating point\footnote{ When an integer can have a floating point, the \textsl{MIN} and 
\textsl{MAX} values will still be regular integers; they can never have 
floating point values.}. \\
\textsl{FLOAT\_POINT} & [\textsf{.} or \textsf{,}]&  Specifies which character will be used as the floating-point 
character. It overwrites the default value from the configuration 
file (see section \ref{para:float})\footnote{ Input entered by the user, must contain the same floating-point 
character!}.\\ \hline
\end{tabular}
\caption{Keywords for the INTEGER format type}\label{tab:integer}
\end{minipage}
\end{table}

\paragraph{The DATE type}
\index{date}
\index{format input!date}

This indicates the input should be of the \textsl{DATE} type. An invalid response 
will result in a warning message. The user response has to be in a valid 
\textsl{ABSOLUTE} time format (DD-MMM-YYYY). \\
Valid keywords are listed in table \ref{tab:date}.

\begin{table}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\begin{tabular}{llp{4cm}} \hline
\textsl{FORMAT} & [\textsf{ABSOLUTE}, \textsf{COMPARISON} or \textsf{DELTA}] & Specify the format to which the input will be converted.\\ \hline
\end{tabular}
\caption{Keywords for the DATE format type}\label{tab:date}
\end{minipage}
\end{table}

\paragraph{The TEXTAREA type}
\index{textarea}
\index{format input!textarea}
\label{para:mylabel5}

Enter free input, using a text editor. The value is both stored in a file, 
and in the specified variable name. The size of the value in the variable 
name is limited by VMS. This does not affect the value stored in the file.

\vs

When a valid filename is entered, the editor, specified in the configuration 
file (see section \ref{para:editorlement}), will be started. When 
the no filename is entered, a default value will be used. This is the 
default value from the menu file or a newly generated value if omitted. \\
The default location is \textsl{OMI{\$}MENU{\_}DIRECTORY:}\footnote{ Note that the
\textsl{OMI{\$}MENU{\_}DIRECTORY:} logical can be a search path; the first physical
directory in the seach list is used by default.}\label{fnote:slist}.
\newcounter{slist}\setcounter{slist}{\value{footnote}}

\vs

The file will only be available during the current OMI session, and the file 
will be deleted when OMI exits, unless \textsl{KEEP} is set to \textsl{TRUE}.
This and other valid keywords are listed in tabel \ref{tab:textarea}.

\begin{table}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\begin{tabular}{llp{6cm}} \hline
\textsl{FILENAME} & [textit{file name}] & The name of the temporary file that will be used to create the 
text area. The default location is \textsl{OMI\$MENU\_DIRECTORY:} (see footnote \arabic{slist} on page \pageref{fnote:slist}),
and the default type is \textsl{.TXT}. \linebreak
If this field is not specified, the name \textsl{TA\_\textit{menu}\$INPUT\textit{n}} will 
be used, where \textit{menu} is the current menu name, and \textsl{INPUT\textit{n}} the 
OMI internal element name\footnote{ \textit{n} can either be the explicit element number, or the automatic generated number}. \\
\textsl{KEEP} & [\textsf{TRUE} or \textsf{FALSE}] & If set to \textsl{TRUE}, the temporary file will not be removed when 
OMI exists, and so will be available for a future session.\\
\textsl{HISTORY} & [\textsf{TRUE} or \textsf{FALSE}] &  If set to \textsl{TRUE}, older version of the temporary file will also 
be saved, limited by the VMS VERSION\_LIMIT. When \textsl{KEEP} is set 
to \textsl{FALSE} or not specified, \textsl{HISTORY} is automatically set to \textsl{FALSE}. \linebreak
By default, only the last version will be saved (if \textsl{KEEP} is \textsl{TRUE})\\
\textsl{LARGE} & [\textsf{TRUE} or \textsf{FALSE}] &  The size of a textarea is limited to 255 characters by default. 
With this option it is possible to store values up to 1024 characters 
in the variable\footnote{ Setting this option to \textsl{TRUE}, can cause the command 
\textsl{SHOW TEXTAREA} not to show anything without a warning!}. \linebreak
The maximum size does not affect the value that is stored in 
the temporary file. \\ \hline
\end{tabular}
\caption{Keywords for the TEXTAREA format type}\label{tab:textarea}
\end{minipage}
\end{table}

\paragraph{The TIME element}
\index{time}
\index{format input!time}
\label{para:mylabel6}

This indicates the input should be of the \textsl{TIME} type. An invalid response 
will result in a warning message. The user response has to be a valid time 
format (\textsl{HH:MM [AM\textbar PM]}or \textsl{HH.MM [AM\textbar PM]}).\\ 
Valid keywords are listed in table \ref{tab:time}.

\begin{table}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\begin{tabular}{llp{6cm}} \hline
\textsl{HOURS} & [\textsf{12} or \textsf{24}] &  Specifies if the time should be in 12 or 24 hours format. In 
12 hours format, the string ``am'' or ``pm'' will be added, and the time 
value will, if necessary, be converted (e.g. ``21:45'' will be converted 
to ``9:45pm'', ``10:15'' will be converted to `10:15am''). \linebreak
When omitted, the default from the configuration file will be 
used (see section \ref{para:mylabel1}).\\
\textsl{SEPARATOR} & [\textit{separator string}] & By default, a colon (\textsl{:}) will be used to separate hours and minutes 
(HH:MM), but by using this element, any character string can 
be diaplayed in the output. For user input, only a colon (\textsl{:}) or a dot (\textsl{.}) are allowed. \\
\textsl{TRZERO} & [\textsf{TRUE} or \textsf{FALSE}] & If set to \textsl{TRUE}, trailing zeros will be included for the hours 
if necessary, e.g. ``9:45pm'' will be displayed as ``09:45pm''.\\
\textsl{UPCASE} & [\textsf{TRUE} or \textsf{FALSE}] &  If set to \textsl{TRUE}, the string am or pm will be converted to uppercase. 
This element will be ignored when \textsl{HOURS} is specified as \textsl{24}. \\ \hline
\end{tabular}
\caption{Keywords for the TIME format type}\label{tab:time}
\end{minipage}
\end{table}

\subsection{Example of the Free input type with Formatting.}\label{subsubsec:mylabel38}

\begin{figure}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\hrulefill \\
\begin{ttfamily}
\noindent[MENU{\_}INPUTS] \newline
\indent INPUT = Enter a file name{\#}FNAME{\#}{\#}FILNAM{\_}FRM ! No default value \newline
\indent INPUT = Enter a date{\#}DATE{\#}TODAY{\#}DATE{\_}FRM ! Default is Today \newline
 \newline
\noindent[FILNAM{\_}FRM] \newline
\indent TYPE = FILESPEC \newline
\indent REQUIRED = TRUE ! File has to exist \newline
 \newline
\noindent[DATE{\_}FRM] \newline
\indent TYPE = DATE \newline
\indent FORMAT = COMPARISON \newline
\end{ttfamily}
\caption{Formatting Free input}\label{fig:formatfree}
\hrulefill
\end{minipage}
\end{figure}

In the INPUTS menu in figure \ref{fig:formatfree}, the user can enter two values; a filename, which 
has to exist (a warning will be displayed if the file is not found), and a 
date, which will be the current date by default.

The filename will be converted to uppercase and all blanks will be removed 
before other validation is performed.

The date will be converted to the VMS COMPARISON type, so if the date 
entered is ``25-JUN-1997'', this will be changed to ``1997-06-25''.

\subsection{The Select list input element}
\index{select lists}
\label{subsubsec:mylabel39}

If the user cannot freely enter any input, a list with choices can be 
presented, from which the user can make a selection.

To do so, the variable name in the second argument is preceded with the \textsl{SEL} 
keyword, followed by the pipe sign (\textsl{\textbar}) and the name of a section 
with choices, enclosed by accolades: \\
\indent\textsf{INPUT = Text on display{\#}{\{}SEL\textbar section{\_}name{\}}variable{\_}name{\#}VALUEn} \\
The optional third argument points to the default value. This should be the 
locator of the value (\textsl{VALUE\textit{n}}, see below), \textit{not} the value itself. This input type 
accepts no fourth argument.

\vs

The select section contains a list of variables, called \textsl{VALUE1}...\textsl{VALUE\textit{n}}, 
that will be displayed in a pop-up window.

\vs

The name of a selectlist section can be freely chosen, but it must be the 
same as in the input element where it's being called from (the name after 
the pipe sign between accolades).

The selectlist section only contains numbered VALUE elements, like \\
\begin{textsf}
\indent VALUE1 = any value \newline
\indent VALUE2 = any value \newline
\indent VALUE3 = any value \newline
\end{textsf}

\noindent One of the options can be enclosed by accolades. This means, the user does 
not have to select from the list, but can also enter free input. It is 
recommended to use the last option for this purpose\footnote{ If this possibility is used, it won't display very nicely if 
the same list is used as a taglist somewhere else (refer to section 
\ref{subsubsec:mylabel40})}.

\begin{figure}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\hrulefill \\
\begin{ttfamily}
\noindent[MENU{\_}USERS] \newline
\indent INPUT = Select a user{\#}{\{}SEL\textbar SYSTEM{\_}USERS{\}}USRNAME{\#}VALUE3 \newline
\noindent[SYSTEM{\_}USERS] \newline
\indent VALUE1 = RDB{\$}REMOTE \newline
\indent VALUE2 = RDM{\_}MONITOR \newline
\indent VALUE3 = SYSTEM \newline
\indent VALUE4 = SYSTEST \newline
\indent VALUE5 = SYSTEST{\_}CLIG \newline
\indent VALUE6 = UCX{\$}FTP \newline
\indent VALUE7 = UCX{\$}NTP \newline
\indent VALUE8 = UCX{\$}REXEC \newline
\indent VALUE9 = UCX{\$}RSH \newline
\indent VALUE10 = UCX{\$}SNMP \newline
\indent VALUE11 = UCX{\_}LPD \newline
\indent VALUE12 = UCX{\_}SMTP \newline
\indent VALUE13 = DEFAULT \newline
\indent VALUE14 = {\{}Other user{\}}
\end{ttfamily}

This list lets the user select a VMS System username. The default username 
is SYSTEM (VALUE3). Selecting the option in the USERS menu, will display a 
pop-window like this:


\hspace*{\fill}\fbox{\parbox{10em}{\textbf{1\gt} RDB{\$}REMOTE \newline 
\textbf{2\gt} RDM{\_}MONITOR \newline
\textbf{3\gt} SYSTEM \newline
\textbf{4\gt} SYSTEST \newline
\textbf{5\gt} SYSTEST{\_}CLIG \newline
\textbf{6\gt} UCX{\$}FTP \newline
\textbf{7\gt} UCX{\$}NTP \newline
\textbf{8\gt} UCX{\$}REXEC \newline
\textbf{9\gt} UCX{\$}RSH \newline
\textbf{10\gt} UCX{\$}SNMP \newline
\textbf{11\gt} UCX{\_}LPD \newline
\textbf{12\gt} UCX{\_}SMTP \newline
\textbf{13\gt} DEFAULT \newline
\textbf{14\gt} Other user 
}}\hspace*{\fill}

\noindent However, if the user needs to select a username that's not in the list, 
selecting 14 will cause OMI to prompt for ``Other user''. The value 
between accolades is the value as displayed in the list, and will also be 
used as prompt when this option is selected.

\caption{Using the Select list}\index{select lists}\label{fig:freeselect}
\hrulefill
\end{minipage}
\end{figure}

\vs

\hspace{-8mm}\textbf{NOTE:} Free input in a select list, like option 14 in figure \ref{fig:freeselect}, 
can NOT be formatted or validated! So, if an OMI module is called with the 
variable USRNAME from the USER menu in the example, which requires the 
username to be in uppercase, lowercase user input will cause failures!

When this input is asked using the \textsl{ALL}\index{OMI commands!ALL} command, or 
the last input option from the menu (see section \ref{subsubsec:entering}, the current value is highlighted in the 
pop-up window, and won't be overwritten if no new value is selected.

\subsection{The Tag list input element}
\index{tag lists}
\label{subsubsec:mylabel40}

If a variable needs to contain a list of values, that can be searched in an 
OMI module using the F{\$}ELEMENT lexical, tag lists can be used as an 
input element.

\vs

This is done by preceding the variable name by keyword \textsl{TAG}, followed by a 
pipe sign (\textbar) and the name of a tag list, enclosed by accolades: \\
\indent\textsf{INPUT = Text on display{\#}{\{}TAG\textbar taglist{\_}name{\}}variable{\_}name} \\
When selected, all possible values will be displayed on the menu screen, and 
the user can select all desired values, which will be highlighted. The last 
option in the tag list will always be to reverse the current selection.

Pressing \lt Ctrl/Z\gt{} will return to the menu screen. By then, all values have 
been stored in the named variable, separated by a specified delimiter.

\vs

The tag list input element cannot have a default value (a third and fourth 
argument will be ignored).

The name of a taglist section can be freely chosen, but it must be the same 
as in the input element(s) from where it's being called.

\vs

The layout of the tag list section is the same as the select list section, 
with the following differences:

\begin{itemize}
\item The \textsl{DELIMITER} keyword is required. This must me a single character, which 
will be used to separate the selected items.

\item Using the optional keyword \textsl{MESSAGE}, a message can be displayed on the top of 
the screen to give the user a small explanation of what's expected.

\item A `Free input', as option 14 in figure \ref{fig:freeselect}, cannot be used.

\item Due to the same layout, Tag lists\index{tag lists}\index{enter input!tagging 
from a list} can be used as Select lists\index{select lists}\index{enter 
input!selecting from a list} and vice versa (as long as no 'Free input' is 
required for the Select list), since the \textsl{DELIMITER} and \textsl{MESSAGE} keywords are 
ignored by the Select input.
\end{itemize}

\begin{figure}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\hrulefill \\
\begin{ttfamily}
\noindent[MENU{\_}MODIFY-JOB] \newline
\indent INPUT = Select days{\#}{\{}TAG\textbar WEEKDAYS{\}}daylist \newline
\noindent[WEEKDAYS] \newline
\indent MESSAGE = Select the day(s) on which the job should run \newline
\indent DELIMITER = / \newline
\indent VALUE1 = Monday \newline
\indent VALUE2 = Tuesday \newline
\indent VALUE3 = Wednesday \newline
\indent VALUE4 = Thursday \newline
\indent VALUE5 = Friday \newline
\indent VALUE6 = Saturday \newline
\indent VALUE7 = Sunday
\end{ttfamily}
\caption{Using the Tag list}\index{tag lists}\label{fig:taglist}
\hrulefill
\end{minipage}
\end{figure}

Figure \ref{fig:taglist} shows how a tag list element can be created, with which the 
user can tag one ore more weekdays.

If this option is selected, the list of weekdays will be presented in the 
menu window with all days preceded by option numbers 1-7, and option 8 to 
reverse the current selection.

If the user selects the numbers 1, 3 and 5 (one at a time), the value of the 
variable DAYLIST will be ``Monday/Wednesday/Friday''.

\subsection{Reading Tag and Select values from files}
\index{select lists!from file}
\index{tag lists!from file}
\index{values for tag and select lists}
\label{subsubsec:reading}

It is possible to let OMI read the values for a tag list or a select list 
from a file. To do so, an input element and a named section should be 
created as described in the previous sections but in stead of the \textsl{VALUE\textit{n}} 
elements, the section should contain the \textsl{FILENAME} element, which points to 
the filename that contains the values. All other elements can still be used 
in the same way.

The default location of the file is \textsl{OMI{\$}MENU{\_}DIRECTORY:}, or \textsl{OMI{\$}:} if 
not found there.

\begin{figure}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\hrulefill \\
\textsl{Menu file:} \newline
\begin{ttfamily}
\noindent[MENU{\_}PLANNING] \newline
\indent INPUT = Weekends to work{\#}{\{}TAG\textbar WEEKENDS{\}}work{\_}weekends\newline
\noindent[WEEKENDS] \newline
\indent message = Select the weekend day(s) you want to work this month \newline
\indent delimiter = / \newline
\indent filename = ''F{\$}EXTRACT(3,3,F{\$}TIME())'.DAT
\end{ttfamily}

\textsl{File NOV.DAT:} \newline
\begin{ttfamily}
\noindent Saturday 1st \newline
\noindent Sunday 2nd \newline
\noindent Saturday 8th \newline
\noindent Sunday 9th \newline
\noindent Saturday 15th \newline
\noindent Sunday 16th \newline
\noindent Saturday 22nd \newline
\noindent Sunday 23rd \newline
\noindent Saturday 29th \newline
\noindent Sunday 30th \newline
\end{ttfamily}
\caption{File input in Tag and Select lists}\index{select lists}\label{fig:listfromfile}
\hrulefill
\end{minipage}
\end{figure}

Figure \ref{fig:listfromfile} shows the use for input files in tag- or select lists. The 
\textsl{VALUE\textit{n}} fields are filled dynamically with values from the specified file. 
The file in this example changes every month, and contains all dates for the 
weekends in the selected month.

In stead of reading the variable from F{\$}TIME(), it's also possible to use 
another input element to get the variable pointing to the requested value 
file.

If you have write privilege to the current menu, the value file can be 
modified with the \textsl{EDIT VALUE{\_}FILE} command.

\subsection{Set Tag and Select values by a module}
\index{select lists!set by a module}
\index{tag lists!set by a module}
\index{select lists!dynamic values}
\index{tag lists!dynamic value}
\index{values for tag and select lists}
\label{subsubsec:dynamicvalues}

Dynamic values for tag- and select lists can also be set by a module which will be called by 
OMI when the users enters the input option.

This is achieved with the \textsl{MODULE} element in the section describing the list. This element
must contain the name of an OMI module that will be called and which sets the global \textsl{VALUE\textit{n}} symbols for the section. \\
The section name is passed as the first parameter. Other parameters can be passed to the module
as shown in figure \ref{fig:valuesfrommodule}

The default location of the module is \textsl{OMI{\$}MENU{\_}DIRECTORY:}, or \textsl{OMI{\$}:} if 
not found there.

\begin{figure}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\hrulefill \\
\textsl{Menu file:} \newline
\begin{ttfamily}
\noindent[MENU{\_}JOBS] \newline
\indent INPUT = Select a process ID{\#}{\{}SEL\textbar PIDLIST{\}}process{\_}id\newline
\noindent[PIDLIST] \newline
\indent module = get{\_}processids  f{\$}getjpi(0, "username") \newline
\end{ttfamily}

\textsl{File GET{\_}PROCESSIDS.OMI:} \newline
\begin{ttfamily}
\noindent{\$} {\_}blockname = P1 \newline
\noindent{\$} {\_}username = P2 \newline
\noindent{\$} {\_}valuecounter = 1 \newline
\noindent{\$} ctx = "" \newline
\noindent{\$} temp = f{\$}context("process", ctx, "username", - \newline
\hspace*{5mm}    "''{\_}username'","eql") \newline
\noindent{\$}! \newline
\noindent{\$}get{\_}processes: \newline
\noindent{\$} pid = f{\$}pid(ctx) \newline
\noindent{\$} if pid .eqs. "" then {\$} exit omi{\$}{\_}ok \newline
\noindent{\$} '{\_}blockname'{\$}VALUE'{\_}valuecounter' == pid \newline
\noindent{\$} {\_}valuecounter = {\_}valuecounter + 1 \newline
\noindent{\$} goto get{\_}processes \newline
\end{ttfamily}
\caption{Dynamic values set by a module}\index{select lists}\label{fig:valuesfrommodule}
\hrulefill
\end{minipage}
\end{figure}

Figure \ref{fig:valuesfrommodule} shows the use for modules creating dynamic values in tag- or select lists. The 
\textsl{VALUE\textit{n}} fields are set by a module. \\ 
Note the module must set global symbols! 

\vs

A template module \textsl{VALUE{\_}MODULE.TEMPLATE} can be found in the \textsl{OMI{\$}:} directory.

\subsection{Default values}\label{subsubsec:defaults}\index{variables!default value}

The third argument in the input item description can optionally contain a default value.\\
Default values for Tag-lists are note supported\index{tag lists!default value}.

\vs

Default values can either be hardcoded in the menu file, or a module can be called to set the default at runtime.
To do this, the value must start with \textsl{CALL:}.\\
See section \ref{subsubsection:defaultbymodule} for more on this.

\subsubsection{Default for Free input}
When the input item is a Free input type (see secion \ref{subsubsec:mylabel37}), the default will be the exact
value as given in the input element.

If the input element contains a formating block and the default value is invalid\index{variables!invalid default value}, the value will be set to:\\
\texttt{Invalid default value}

\subsubsection{Default for Select lists}\label{subsubsection:defaultforselectlist}\index{select lists!default value}

For select lists, the third argument should not contain the value itself, but the value item from the block containing
all possible value (\textsl{VALUE\textit{n}}), e.g.:

\begin{ttfamily}
\indent INPUT = Select a day{\#}{\{}SEL\textbar WEEKDAYS{\}}selected{\_}day{\#}VALUE5\newline
\noindent[WEEKDAYS] \newline
\indent VALUE1 = Monday \newline
\indent VALUE2 = Tuesday \newline
\indent VALUE3 = Wednesday \newline
\indent VALUE4 = Thursday \newline
\indent VALUE5 = Friday \newline
\end{ttfamily}

In this example, the selected default will be \textsl{Friday}.

\subsubsection{Default values set by a module}\label{subsubsection:defaultbymodule}\index{variables!default value!set by modules}

A default value will be set at runtime when the given value starts with \textsl{CALL:}, as in:\\
\indent\textsf{INPUT = Text on display{\#}VARIABLE{\_}NAME{\#}CALL:SET{\_}DEFAULT MY{\_}PARAMETER}\\
This causes OMI to call the module names \textsl{SET{\_}DEFAULT.OMI} with \textsl{VARIABLE{\_}NAME} as the first
parameter.\\
In this example, \textsl{MY{\_}PARAMETER} will be passed as the second parameter.

The module must return the default value in the global symbol \textsl{OMI{\$}DEFAULT{\_}VALUE}. The default location of the module is \textsl{OMI{\$}MENU{\_}DIRECTORY:}, or \textsl{OMI{\$}:} if not found there.

\vs

The value will be exact as passed by the module for any variable type. This means, for select lists it should \textit{not} contain the \textsl{VALUE\textit{n}} reference!\index{select lists!default value}.\\
If a default value should be set by a module in the example of section \ref{subsubsection:defaultforselectlist},
\textsl{OMI{\$}DEFAULT{\_}VALUE} should contain the dayname, e.g. ``\textsl{Friday}''.

This way is it possible to set a value that is not in the select list (e.g. ``\textsl{Saturday}''). If this is done, OMI will display a warning, but the value \textit{is} accepted.

\vs

For Free input items with a formatting block, formatting will be done after the module is called.

\vs

A template module \textsl{VALUE{\_}DEFAULT.TEMPLATE} can be found in the \textsl{OMI{\$}:} directory.

\index{variables|)}

\section{The CONST element}\index{constants}\index{fixed value}\label{sec:const}

The \textsl{CONST} element is identical to the \textsl{INPUT} element (section \ref{subsec:mylabel5}  with the following differences:

\begin{itemize}
\item The first argument is ignored.
\item Values can only be set by the default value.
\item Constants will not be displayed.
\end{itemize}

The second bullet implies tag-lists are not supported since they can't have a default value, and select-lists are useless.

Values can be set either hardcoded in the menu file, or by calling a module (see section \ref{subsubsection:defaultbymodule} above).

All formatting rules (section \ref{subsubsec:formatting}) apply to constants too.

\vs

Constants are not visible to the user but can be used in modules.
Figure \ref{fig:usingconstants} shows a rewrite of the example in figure \ref{fig:valuesfrommodule} using constants.

\begin{figure}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\hrulefill \\
\textsl{Menu file:} \newline
\begin{ttfamily}
\noindent[MENU{\_}JOBS] \newline
\indent INPUT = Select a process ID{\#}{\{}SEL\textbar PIDLIST{\}}process{\_}id\newline
\indent\textit{CONST = (This part is ignored){\#}const{\_}usrname{\#}CALL:GET{\_}USERNAME}\newline
\noindent[PIDLIST] \newline
\indent module = get{\_}processids \newline
\end{ttfamily}

\textsl{File GET{\_}USERNAME.OMI:} \newline
\begin{ttfamily}
\noindent{\$} OMI{\$}DEFAULT{\_}VALUE == f{\$}getjpi(0, "username")\newline
\noindent{\$} exit omi{\$}{\_}ok \newline
\end{ttfamily}

\textsl{File GET{\_}PROCESSIDS.OMI:} \newline
\begin{ttfamily}
\noindent{\$} {\_}blockname = P1 \newline
\textit{\noindent{\$} {\_}username = const{\_}usrname} \newline
\noindent{\$} {\_}valuecounter = 1 \newline
\noindent{\$} ctx = "" \newline
\noindent{\$} temp = f{\$}context("process", ctx, "username", - \newline
\hspace*{5mm}    "''{\_}username'","eql") \newline
\noindent{\$}! \newline
\noindent{\$}get{\_}processes: \newline
\noindent{\$} pid = f{\$}pid(ctx) \newline
\noindent{\$} if pid .eqs. "" then {\$} exit omi{\$}{\_}ok \newline
\noindent{\$} '{\_}blockname'{\$}VALUE'{\_}valuecounter' == pid \newline
\noindent{\$} {\_}valuecounter = {\_}valuecounter + 1 \newline
\noindent{\$} goto get{\_}processes \newline
\end{ttfamily}
\caption{Using constants}\index{select lists}\label{fig:usingconstants}
\hrulefill
\end{minipage}
\end{figure}

\section{Including Standard Libraries}
\index{standard libraries}
\index{libraries}
\index{including libraries}
\label{subsec:including}

An \textsl{{\#}INCLUDE}\index{{\#}include} directive can be used to load one or more 
library menus into the menu file. Library menus are normal OMI menus, but 
they should not have a main menu (section \textsl{[MENU{\_}MENU]}). All sections from 
the library menu are available in the menu that includes the library. The 
default file type for libraries is \textsl{.OML}\index{libraries!file type}.

\vs

The \textsl{{\#}INCLUDE} directive can be used anywhere in the menu file. The number 
of includes is unlimited, but nested includes are not allowed (the 
\textsl{{\#}INCLUDE} directive cannot be used from within libraries).

\vs

\hspace{-8mm}\textbf{NOTE:} OMI comes with one standard library, 
\textsl{OMI{\$}LIBRARY.OML}. It is advised not to edit this library, but to 
create your own ones, since the library might be overwritten with a new 
distribution.

\subsection{Handling duplicate items}
\index{duplicate values!overwrite}
\index{leading values}
\index{{\#}LEADING attribute}\index{libraries!handling duplicate items}
\label{subsubsec:handling}

When including one or more standard libraries, it can happen that one of the 
libraries contains a section with values that is used in the calling menu 
file as well.

To prevent warning messages, the attribute \textsl{{\#}LEADING} can be added 
to the item that should be used.

\vs

The order in which the files are read is not relevant\footnote{ When a menu 
file is validated with the \textsl{/VALIDATE} qualifier (see section 
\ref{subsubsec:mylabel8}), a warning will be displayed if the first 
item of two duplicate item names was specified as leading. During run-time 
this is handled properly.}; the item that has been specified with 
\textsl{{\#}LEADING}, will be the value that is used. If all values are specified 
with \textsl{{\#}LEADING}, the last one will be used.

\vs

Figure \ref{fig:libraries} shows how libraries can be used and warning messages for 
duplicate values can be prevented.

\begin{figure}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\hrulefill \\
\textsl{The menu file contains:}

\begin{ttfamily}
\noindent[MENU{\_}MENU] \newline
\indent INPUT = Select a TCP product{\#}{\{}SEL\textbar TCPPRODS{\}}TCP{\_}PROD{\#}VALUE1 \newline
\noindent[ANOTHER{\_}SELECT] \newline
\indent VALUE1{\#}LEADING = Set in the menu file \newline
\indent VALUE2 = Also set in the menu file \newline
\noindent{\#}INCLUDE MY{\_}LIB \newline
\end{ttfamily}

\textsl{The file MY{\_}LIB.OML contains:}

\begin{ttfamily}
\noindent[TCPPRODS] \newline
\indent VALUE1 = UCX \newline
\indent VALUE2 = WOLLONGONG \newline
\indent VALUE3 = TCPWARE \newline
\indent VALUE4 = MULTINET \newline
\indent VALUE5 = CMU/TEK
\noindent[ANOTHER{\_}SELECT] \newline
\indent VALUE1 = Set in the library \newline
\indent VALUE2{\#}LEADING = Also set in the library file
\end{ttfamily}

\noindent The menu uses a select list that's not available in the menu file, but it is 
in the library that is included.

When OMI starts, the select list is initialized from the library, and UCX 
will be the default value stored in the variable TCP{\_}PROD.

The {\#}\textsl{LEADING} settings cause the duplicate values to be set as follows: \newline
\indent\textsl{ANOTHER{\_}SELECT{\$}VALUE1 = "Set in the menu file"} \newline
\indent\textsl{ANOTHER{\_}SELECT{\$}VALUE2 = "Also set in the library"}

\caption{Including standard libraries}\index{OMI!libraries}\label{fig:libraries}
\hrulefill
\end{minipage}
\end{figure}


\section{Adding descriptions to the Menu file}
\label{subsec:adding}

Menu files can contain descriptions, if they are outcommented using the 
exclamation mark (!). However, if a line starts with an exclamation mark, 
it's still read by OMI. To improve performance with long descriptions, they 
can be placed at the bottom of the file, after the string
\textsl{\lt EOF\gt}\index{long comments}\index{EOF}\index{forced end-of-file}.

\vs

Whenever OMI reads a line with (only!) this identifier string, it will 
consider it as the end-of-file, and will stop reading from the file. Figure \ref{fig:comments}.
shows an example of this.
The same identifier can also be used in configuration files.

\begin{figure}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\hrulefill \\
\begin{ttfamily}
\noindent! Comments are at the bottom of this file \newline
\noindent[MENU{\_}MENU] \newline
\indent ITEM = Leave this menu{\#}command{\#}exit \newline
\noindent! Pretty short menu, isn't it?! \newline
\noindent\lt EOF\gt \newline
\noindent The example you are reading now is not described in this document, 
since this text is still a part of the example. \newline
OMI won't read this from the menu file, since the end-of-file was 
already reached. Therefore, these lines don't need to be outcommented.
\end{ttfamily}
\caption{Comments in Menu files}\label{fig:comments}
\hrulefill
\end{minipage}
\end{figure}

\section{Special Characters}
\index{special characters}
\label{subsec:special}

This section briefly lists characters that are reserved by OMI in menu 
files.

\vs

The exclamation mark (\textsl{!}), double quote (\textsl{"}) and accolades (\textsl{{\{}{\}}}) cannot 
be used for elements or their values. \\
An exclamation mark should be used for comments.

\vs

The hash (\textsl{{\#}}), the pipe-sign (\textsl{\textbar}) and the combination of tilde and 
question mark (\textsl{\~{}?}) cannot be used in input- or item- elements.

\section{Creating menu- specific help files}\label{sec:mnhelp}
\index{menu!help file}\index{menu specific help}\index{help files}

Each menu file can have a help file. This file can be used for brief usage information
or other descriptions.

Help files have to be located in the same directory where the menu is found, and should
have the same name but with file type \texttt{.OMH}, e.g. if your menu file is
called \texttt{MY-MENU.MNU}, the help file should be called \texttt{MY-MENU.OMH}.

\vs

The layout of the menu file is similar to the menu file. There is a section name
between square brackets, which should be equal the menu name without the \texttt{MENU\_} prefix.
For the main menu---who's section in the menu file always has to be \texttt{[MENU\_MENU]}---this
means the help section is called \texttt{[MENU]}, and if a menu is created in the menu file
with section name \texttt{[MENU\_MY-FUNNY-SUBMENU]}, its helpsection is named \texttt{[MY-FUNNY-SUBMENU]}.

\vs

The text in the section is displayed on the screen as entered in the file.
As with long file descriptions, the \textsl{\lt EOF\gt}\index{EOF} identifier
can also be used to force the end of file (see also section~\ref{subsec:adding}).
Additionally, the textstring \textsl{\lt FF\gt}\index{FF} can be used to force
a newpage. By default, the user has to press \texttt{Return} when the last line
in the OMI screen is written, but \textsl{\lt FF\gt} forces an \texttt{OMI{\$}WAIT}\footnote{ see section~\ref{subsubsec:mylabel64}}
at the line where it occured.

\vs

If a menu contains an on-the-fly menu (see chapter \ref{sec:mylabel2}), it can be documented in the section \texttt{[OTF{\_}MENU]}.\index{on-the-fly menus!in helpfiles}

If a menu contains more on-the-menus that have to be documented in different sections, the key in the help file can be specified when defining the on-the-fly menu with the symbol \textsl{OTF{\_}MENU{\$}INFO{\_}KEY} (see also section \ref{subsec:otfhelp}).

\vs

Helpfiles are read with the \texttt{INFO}\index{OMI commands!INFO} command. For
more information on this command, refer to section~\ref{subsec:cmdinfo}.


\vs

The menu \texttt{OMI{\$}MANAGE}\index{omi\$manage menu}, which comes with the distribution,
has a help file that can be used as an example.

\chapter{Writing Modules}
\label{sec:writing}

Menu items can be used to start OMI modules, using the \textsl{CALL} item-type, as 
in: \\
\noindent\textsf{ITEM = Text on Display{\#}CALL{\#}FILENAME[.OMI]} \\
This item executes the module FILENAME.OMI when selected. Parameters can 
optionally be specified in the menu item, eventually using the dynamic input 
identifier (\textsl{\~{}?}), as described in section \ref{para:dyninput}.

\vs

This chapter describes a set of commands and symbols from OMI and the 
standard toolbox that are available for use in OMI modules.

\section{Return values of OMI commands}
\label{subsec:return}

The commands that are available in the standard OMI toolbox will be 
described in section \ref{subsec:mylabel6}. They all return their values as global symbols, if 
any value is returned. When OMI exits, all symbols will be removed.

\vs

\hspace{-8mm}\textbf{NOTE:} Make sure you don't use a local symbol with a name that's 
used for any of the global symbols in OMI commands, since that will always 
overwrite the returned value of this command!

The status return values of all functions can be:
\textsl{OMI{\$}{\_}OK} (normal successful completion)
\textsl{OMI{\$}{\_}WARNING} or \textsl{OMI{\$}{\_}ERROR}, where 
\textsl{OMI{\$}{\_}ERROR} has an integer value bigger than 
\textsl{OMI{\$}{\_}WARNING}. This can be used to see 
if there was any failure by checking the status as below:

\textsf{{\$} IF {\$}STATUS .GE. OMI{\$}{\_}WARNING THEN {\$} \lt \textit{error-handling}\gt} \\
If the return value of any command is equal to or greater than 
\textsl{OMI{\$}{\_}WARNING}, the global symbol which should be defined by the 
command, might not have been set, resulting in more errors or unpredictable 
behavior due to the use of the value of a former call if the return status 
is not checked.

\section{OMI Commands in modules}
\label{subsec:mylabel6}

All commands that are available for use in OMI modules start with the string 
OMI{\$}. The way they are defined, and can be extended, is described in 
chapter \ref{sec:adding}.

\subsection{OMI{\$}ASK}
\index{OMI commands in modules!OMI{\$}ASK}
\label{subsubsec:mylabel41}

\indent Format: \textsf{OMI{\$}ASK} \textit{question}\\*[3mm]
Prompt the user for input. The prompt is specified as a parameter. If no 
parameter is specified, the value \textsl{DEFAULT{\_}INPUT} from the section 
\textsl{[QUESTIONS]} from the configuration file is used.\\[3mm]
\textbf{Return value}\\*[3mm]
The user response is returned in the global symbol \textsl{OMI{\$}RESPONSE}. If the 
user enters \lt Ctrl/Z\gt, \textsl{OMI{\$}RESPONSE} will be empty, and the status code 
will be \textsl{OMI{\$}{\_}CANCELLED}.

\subsection{OMI{\$}CALC}
\index{calculator}
\index{OMI commands in modules!OMI{\$}CALC}
\label{subsubsec:mylabel42}

\indent Format: \textsf{OMI{\$}CALC \textit{calculation}}\\*[3mm]
Invoke the OMI calculator. For a description of the calculator, refer to 
section \ref{subsec:mylabel11}.
The result is returned in the global symbol \textsl{OMI{\$}CALCULATED}.

\subsection{OMI{\$}CALL}
\index{OMI commands in modules!OMI{\$}CALL}
\label{subsubsec:mylabel43}

\indent Format: \textsf{OMI{\$}CALL \textit{omi-module [parameters]}}\\*[3mm]
This command executes an OMI module. With this, it is possible to create 
several standard OMI modules that will perform generic actions, which will 
be executed from the action-specific modules.\\[3mm]
\textbf{Parameters}\\*[3mm]
The first parameter is required. It is the name of the OMI module that will 
be executed.

By default, the file has type \textsl{.OMI} and is located in \textsl{OMI{\$}:}. If not found 
there, OMI will look in \textsl{OMI{\$}MENU{\_}DIRECTORY:}, unless a full path was 
specified. \\
All other parameters will be passed to the module.\\[3mm]
\textbf{Return value}\\*[3mm]
The status code returned by this command is the final exit status of the 
called module.

\subsection{OMI{\$}CHECK}
\index{OMI commands in modules!OMI{\$}CHECK}
\label{subsubsec:mylabel44}

\indent Format: \textsf{OMI{\$}CHECK \textit{variable [message]} [[NO]EMPTY{\_}ALLOWED]}\\*[3mm]
This command can be used to perform checks on the existence of required 
variables. This is useful if an OMI module needs input, which has to be 
specified in a menu where no default values are used.\\[3mm]
\textbf{Parameters}\\*[3mm]
The first parameter is required. It specifies the variable name that needs 
to be checked.

If a message needs to be displayed when the required variable has not been 
specified, this can be passed in the second parameter. This is optional.

The third parameter indicates whether or not the variable is allowed to be 
empty (the variable does exist but has no value). By default, empty values 
are not allowed. You can override this by specifying \textsl{EMPTY{\_}ALLOWED} as the 
third parameter. This only influences the the message being displayed or not, the
return value will not change.\\[3mm]
\textbf{Return values}\\*[3mm]
When the variable is valid, the value \textsl{OMI{\$}{\_}OK} is returned. \\
When the variable exists but is empty, the value \textsl{OMI{\$}{\_}WARNING} is 
returned. When the variable doesn't exist at all, the value \textsl{OMI{\$}{\_}ERROR} 
is returned.\\[3mm]
\textbf{Examples}\\*[3mm]
\begin{textsf}
\indent{\$} OMI{\$}CHECK USERNM "* ERROR * You didn't specify a username" \newline
\indent{\$} IF {\$}STATUS .GE. OMI{\$}{\_}WARNING THEN {\$} EXIT
\end{textsf}\\*[3mm]
In this example, the OMI module requires a username as input. When this 
variable has not been filled with a value or has not been specified at all, 
the error message is displayed. The return value can be \textsl{OMI{\$}{\_}WARNING} 
or greater, indicating not all required information was specified, due to 
which control is returned to the menu.\\*[3mm]
\begin{small}
\begin{textsf}
\indent{\$} OMI{\$}CHECK FNAME "* ERROR * No file name specified" EMPTY{\_}ALLOWED \newline
\indent{\$} STATUS = {\$}STATUS \newline
\indent{\$} IF STATUS .EQ. OMI{\$}{\_}ERROR THEN {\$} EXIT \newline
\indent{\$} IF STATUS .EQ. OMI{\$}{\_}WARNING \newline
\indent{\$} THEN \newline
\indent{\$} OMI{\$}DISPLAY{\_}MESSAGE "* INFO * Using all files" \newline
\indent{\$} FNAME = "*.*" \newline
\indent{\$} ENDIF \newline
\end{textsf}
\end{small}\\[3mm]
This example shows how \textsl{OMI{\$}CHECK} can be used to check the value of the variable FNAME, 
allowing an empty value. \\
The parameter \textsl{EMPTY{\_}ALLOWED} causes OMI to display the error message only 
when the variable doesn't exist at all. The return value does indicate an 
empty value, but the message won't be displayed, and the OMI module takes 
action upon that.

\subsection{OMI{\$}CLEAR{\_}SCREEN}
\index{OMI commands in modules!OMI{\$}CLEAR{\_}SCREEN}

\indent Format: \textsf{OMI{\$}CLEAR{\_}SCREEN}\\*[3mm]
This command removes all text from the window, leaving the layout intact.

\subsection{OMI{\$}CMDLINE{\_}CLEAR}
\index{OMI commands in modules!OMI{\$}CMDLINE{\_}CLEAR}
\label{subsubsec:mylabel45}

\indent Format: \textsf{OMI{\$}CMDLINE{\_}CLEAR}\\*[3mm]
This command erases the contents of the command line of the OMI menu window.

\subsection{OMI{\$}CONFIRM}
\index{OMI commands in modules!OMI{\$}CONFIRM}
\label{subsubsec:mylabel46}

\indent Format: \textsf{OMI{\$}CONFIRM} \textit{question [default]}\\*[3mm]
This command asks a question that can be answered with Y(es) or N(o)\footnote{ refer
to section~\ref{subsubsec:mylabel18} to translate these possible answers}, and 
handles all input and output, returning the value back to the calling 
procedure.\\[3mm]
\textbf{Parameters}\\*[3mm]
The first parameter is a string, which will be displayed exactly on the 
input line of the menu string, followed by the choices than can be made 
``(Y/N)'', where `Y' and `N' are values that can
be modified in the [QUESTIONS] section of the configuration file (see section~\ref{subsubsec:mylabel18}).

The second parameter represents the default value. This parameter can be 
\textsl{'QUESTIONS{\$}ANSWER{\_}YES'} or \textsl{'QUESTIONS{\$}ANSWER{\_}NO'} (\textit{\textbf{note} the use of the single quotes (')!}). If omitted, no default 
value will be available, and the user is required to enter valid input.\\[3mm]
\textbf{Return value}\\*[3mm]
This command defines a global symbol \textsl{OMI{\$}CONFIRMED}\index{OMI commands in 
modules!OMI{\$}CONFIRM}. This can be \textsl{TRUE} or \textsl{FALSE}. The symbol will be 
cleaned up at the end of the procedure, but also every time the 
\textsl{OMI{\$}CONFIRM} command is called, to prevent conflicts.\\[3mm]
\textbf{Example}\\*[3mm]
\begin{textsf}
\indent{\$} OMI{\$}CONFIRM "Are you sure ?" 'QUESTIONS{\$}ANSWER{\_}NO \newline
\indent{\$} IF OMI{\$}CONFIRMED THEN {\$} GOTO USER{\_}IS{\_}SURE
\end{textsf}\\*[3mm]
This command will display the following question on the input line: \\
\indent\textsl{Are you sure ? (Y/[N])} \\
The square brackets indicate the default answer.

\subsection{OMI{\$}CREATE{\_}MBX}
\index{OMI commands in modules!OMI{\$}CREATE{\_}MBX}
\label{subsubsec:mylabel47}

\indent Format: \textsf{OMI{\$}CREATE{\_}MBX \textit{[logical-name]}}\\*[3mm]
Open a temporary mailbox\index{mailboxes}. This command creates a mailbox 
for read and write, and a logical which points to the I/O channel. 

The mailbox will automatically be removed when the command \\
\indent\textsf{{\$} CLOSE \textit{logical-name}} \\
is issued and no other processes have an open connection 
with the mailbox. This can be done by the OMI module, but when OMI exits, 
the mailboxes that are still opened, will be closed automatically.\\[3mm]
\textbf{Parameter}\\*[3mm]
The optional parameter specifies the name of the logical that points to the 
I/O channel, which is the same name that's used for the logical. An error 
occurs if the parameter specifies a name that's already in use for an 
existing logical.

If the parameter is omitted, the name will default to 
\textsl{OMI{\$}MAILBOX}.\index{logical names!OMI{\$}MAILBOX}\index{logical names!mailbox}\\[3mm]
\textbf{Return values}\\*[3mm]
OMI{\$}CREATE{\_}MBX
returns a logical name which points to the I/O channel. This can be used to 
write text to the mailbox using the command \\
\indent\textsf{{\$} WRITE logical-name "Line of text"} \\
or to read using the command \\
\indent\textsf{{\$} READ logical-name my-symbol} \\
A global symbol with the same name is also defined, containing the device 
name of the mailbox (MBAxxx:). This value can be transferred to other 
processes, with which they can open the same mailbox for communication: \\
\indent\textsf{{\$} OPEN /READ /WRITE my-logical 'symbol-name'}

\subsection{OMI{\$}CREATE{\_}OTF}
\index{OMI commands in modules!OMI{\$}CREATE{\_}OTF}
\index{on-the-fly menus}
\label{subsubsec:mylabel48}

\indent Format: \textsf{OMI{\$}CREATE{\_}OTF}\\*[3mm]
This command is used to invoke \textit{on-the-fly} menus. These menus are described in chapter 
\ref{sec:mylabel2}.

\subsection{OMI{\$}DATE{\_}INFO}
\index{OMI commands in modules!OMI{\$}DATE{\_}INFO}
\index{date information}
\label{subsubsec:mylabel49}

\indent Format: \textsf{OMI{\$}DATE{\_}INFO \textit{date}}\\*[3mm]
Calculates the current day number (day-of-year), week number and month 
number. The values are returned in the following global symbols: \\
\begin{itemize}
\item \textsl{OMI{\$}DAYNUMBER}

\item \textsl{OMI{\$}WEEKNUMBER}

\item \textsl{OMI{\$}MONTHNUMBER}
\end{itemize}

\vs

\noindent\textbf{Parameter}\\*[3mm]
A date can optionally be specified as a parameter. If omitted, it defaults 
to the current date. The date information is returned for the current date. 
The parameter has to be a date in valid ABSOLUTE time format.

\subsection{OMI{\$}DECRYPT}
\index{OMI commands in modules!OMI{\$}DECRYPT}
\label{subsubsec:mylabel50}

\indent Format: \textbf{OMI{\$}DECRYPT \textit{encrypted-string key-name}}\\*[3mm]
This command can be used to decrypt a string, that was encrypted with 
\linebreak\textsl{OMI{\$}ENCRYPT}\index{OMI commands in modules!OMI{\$}ENCRYPT}\index{OMI commands!ENCRYPT}.\\[3mm]
\textbf{Parameters}\\*[3mm]
The encrypted string has to be specified as a parameter. If the encrypted 
string is encrypted with OMI v1.1 or higher, an encryption key is required. 
That has to be the same key that was used for encrypting. This key is 
generated with the \textsl{SET KEY} command and stored in the user specific 
configuration file.

\vs

The second parameter should be the name of the key with which the string was 
encrypted. It has to exist at the keyring of the users configuration file 
(see section \ref{subsubsec:mylabel20}). If it's not there, it can be 
imported with the OMI command \textsl{IMPORT KEY}.

Strings that where encrypted with OMI v1.0b3 - v1.0 can still be decrypted 
without the need for a key.\\[3mm]
\textbf{Return value}\\*[3mm]
The decrypted result will be returned in the global symbol \textsl{OMI{\$}DECRYPTED}.

\subsection{OMI{\$}DISPLAY{\_}INFO}
\index{OMI commands in modules!OMI{\$}DISPLAY{\_}INFO}
\label{subsubsec:mylabel51}

\indent Format: \textbf{OMI{\$}DISPLAY{\_}INFO}\\*[3mm]
Writes specified information to the menu screen. The information has to be 
specified as separate records, named \textsl{OMI{\$}RECORD1}, \textsl{OMI{\$}RECORD2}, ... 
\textsl{OMI{\$}RECORD\textit{n}}.

The \textsl{OMI{\$}RECORD\textit{n}} symbols should be local.

\vs

\hspace{-8mm}\textbf{NOTE:}\label{note:dispinfo} If this command is called more than once during the same run 
(without any \textsl{exit} commands that clean up the local symbols 
OMI{\$}RECORDn), make sure the symbols \textsl{OMI{\$}RECORD\textit{n}} of the previous calls 
are erased or overwritten. \\
E.g. If the first call writes 5 records to the screen, and the second call 
should write 4 records, it'll also write the last record of the first call. 
The older fifth record should be removed using:\\
\indent\textsl{{\$} DELETE /SYMBOL /LOCAL OMI{\$}RECORD5} \\
or by specifying it as empty: \\
\indent\textsl{{\$} OMI{\$}RECORD5 = ""}\\[3mm]
\textbf{Example}\\*[3mm]
\begin{textsf}
\indent{\$} OMI{\$}RECORD1 = "Username : " + USR{\$}NAME \newline
\indent{\$} OMI{\$}RECORD2 = "Login dir : " + USR{\$}HOME \newline
\indent{\$} OMI{\$}RECORD3 = "Owner : " + USR{\$}OWNER \newline
\indent{\$} OMI{\$}RECORD4 = "Used quota : " + USR{\$}QUOTA \newline
\indent{\$} OMI{\$}DISPLAY{\_}INFO \newline
\indent{\$} OMI{\$}WAIT \newline
\indent{\$} OMI{\$}REFRESH \newline
\indent{\$} EXIT
\end{textsf}\\*[3mm]
In this example, information, gathered by the procedure, is stored in the 
\linebreak OMI{\$}RECORDn symbols, and presented on the menu window. After being 
displayed, \textsl{OMI{\$}WAIT}\index{OMI commands in modules!OMI{\$}WAIT} is called, 
to give the user the change to read the information before the menu window 
is set up again.

\subsection{OMI{\$}DISPLAY{\_}MESSAGE}
\index{OMI commands in modules!OMI{\$}DISPLAY{\_}MESSAGE}
\label{subsubsec:mylabel52}
\indent Format: \textbf{OMI{\$}DISPLAY{\_}MESSAGE \textit{message}}\\*[3mm]
This command writes a message to SYS{\$}ERROR, on the message line of the 
OMI menu window.\\[3mm]
\textbf{Parameter}\\*[3mm]
You can enter any string as a parameter, enclosed by double quotes (\textsl{"}), 
using double single quotes (\textsl{''}) for variable substitution, in exactly the 
same way as the DCL command WRITE.

\subsection{OMI{\$}DUMP{\_}INFO}
\index{OMI commands in modules!OMI{\$}DUMP{\_}INFO}
\label{subsubsec:mylabel53}

\indent Format: \textbf{OMI{\$}DUMP{\_}INFO \textit{filename}}\\*[3mm]
This command can be used to dump the information, that can be displayed by 
\textsl{OMI{\$}DISPLAY{\_}INFO} (see section \ref{subsubsec:mylabel51}) to a 
specified file. The information has to be specified as separate records, 
named \textsl{OMI{\$}RECORD1}, \textsl{OMI{\$}RECORD2}, ... \textsl{OMI{\$}RECORD\textit{n}}.

The \textsl{OMI{\$}RECORD\textit{n}} symbols should be local.
(See also the note on page \pageref{note:dispinfo}.)\\[3mm]
\textbf{Parameter}

\noindent A parameter is required, and should contain the name of the file to write 
the information to. If the file already exists, the new information will be 
added at the end of the file. Otherwise, the file will be created.


\subsection{OMI{\$}ENCRYPT}
\index{OMI commands in modules!OMI{\$}ENCRYPT}
\index{security!encrypting}
\index{encrypting}
\label{subsubsec:mylabel54}

\indent Format: \textbf{OMI{\$}ENCRYPT \textit{string}}\\*[3mm]
This command can be used to perform some rude encryption on the input 
string, which is specified as a parameter. The OMI encryption method 
requires an encryption key, which is stored in the user specific 
configuration file. This key is generated with the \textsl{SET KEY}\index{OMI 
commands!SET KEY} command.\\[3mm]
\textbf{Return value}

\noindent The result will be returned in the global symbol \textsl{OMI{\$}ENCRYPTED}

\subsection{OMI{\$}GET{\_}VMSMESSAGE}
\index{OMI commands in modules!OMI{\$}GET{\_}VMSMESSAGE}
\label{subsubsec:mylabel55}

\indent Format: \textbf{OMI{\$}GET{\_}VMSMESSAGE \textit{status-code}}\\*[3mm]
This command translates a VMS status code and returns it in the global 
symbol \textsl{OMI{\$}VMS{\_}MESSAGE}.\\[3mm]
\textbf{Parameter}\\*[3mm]
A valid status code is required. This must be an integer value, which can be 
specified as decimal or hexadecimal. \\[3mm]
\textbf{Return value}\\[3mm]
If a message was found, this function returns \textsl{OMI{\$}{\_}OK} and stores the 
found message in the global symbol \textsl{OMI{\$}VMS{\_}MESSAGE}.

If no message was found, this function returns \textsl{OMI{\$}{\_}WARNING}. On other 
warnings and errors, \textsl{OMI{\$}{\_}ERROR} is returned.

\subsection{OMI{\$}INPUT{\_}VALIDATE}
\index{OMI commands in modules!OMI{\$}INPUT{\_}VALIDATE}
\label{subsubsec:mylabel56}

\indent Format: \textbf{OMI{\$}INPUT{\_}VALIDATE}\\*[3mm]
On any input prompt, variables can be entered using single quotes. This 
command can be used to validate input entered by the user, to see if the 
string is fixed, or should be interpreted as a variable or a function.

\vs

Before the function is called, the variable \textsl{OMI{\$}VARIABLE} has to be 
defined, containing the name of the variable that should be checked.\\[3mm]
\textbf{Return value}\\*[3mm]
\textsl{OMI{\$}INPUT{\_}VALIDATE} returns \textsl{OMI{\$}{\_}OK} when the input 
string or variable has the correct syntax.

When a variable name was entered between two single quotes (e.g. 'USER-INPUT') 
and the variable (USER-INPUT in this example) is not defined, the function 
returns \textsl{OMI{\$}{\_}WARNING}.

When a variable name was entered between three single quotes (e.g. ''USER-INPUT') 
and the variable (USER-INPUT in this example) is not defined, the function 
returns \textsl{OMI{\$}{\_}ERROR}.

\textsl{OMI{\$}{\_}ERROR} is also the return value when \textsl{OMI{\$}VARIABLE} is not set.\\[3mm]
\textbf{Examples}\\*[3mm]
\begin{textsf}
\indent{\$} OMI{\$}ASK "Password: " \\
\indent{\$} OMI{\$}CMDLINE{\_}CLEAR \\
\indent{\$} OMI{\$}VARIABLE = "OMI{\$}RESPONSE" ! No single quotes! \\
\indent{\$} OMI{\$}INPUT{\_}VALIDATE \\
\indent{\$} IF {\$}STATUS .EQ. OMI{\$}{\_}ERROR \\
\indent{\$}   THEN \\
\indent{\$}     OMI{\$}DISPLAY{\_}MESSAGE "Invalid password" \\
\indent{\$}     RETURN \\
\indent{\$} ENDIF \\
\indent{\$} OMI{\$}ENCRYPT "''OMI{\$}RESPONSE'" \\
\end{textsf}\\*[3mm]
In this example, \textsl{OMI{\$}INPUT{\_}VALIDATE} is called to check the syntax of 
the password that was entered.

If the input was enclosed by single quotes ('USER-INPUT'), these are compared 
literally, but if three single quotes are used (''USER-INPUT'), USER-INPUT will be 
translated by the call of \textsl{OMI{\$}ENCRYPT}.

If USER-INPUT is a function like F{\$}PID(GOTO), the function is executed causing 
GOTO to be defined as a new symbol!\\[3mm]
\begin{textsf}
\indent{\$} OMI{\$}ASK "Password: " \\
\indent{\$} OMI{\$}CMDLINE{\_}CLEAR \\
\indent{\$} OMI{\$}VARIABLE = "OMI{\$}RESPONSE" \\
\indent{\$} OMI{\$}INPUT{\_}VALIDATE \\
\indent{\$} IF {\$}STATUS .EQ. OMI{\$}{\_}WARNING \\
\indent{\$}   THEN \\
\indent{\$}     OMI{\$}DISPLAY{\_}MESSAGE "Invalid password" \\
\indent{\$}     RETURN \\
\indent{\$} ENDIF \\
\indent{\$} OMI{\$}ENCRYPT OMI{\$}RESPONSE \\
\end{textsf}\\*[3mm]
The main difference in this example is the call of \textsl{OMI{\$}ENCRYPT}, where the 
password is not passed to the function between double quotes (causing the 
input to be translated to uppercase).

Due to this, the return value of \textsl{OMI{\$}INPUT{\_}VALIDATE} is checked on warning status; any input 
will be evaluated when enclosed by single quotes ('USER-INPUT').

\vs

If you're not sure if you should check on \textsl{OMI{\$}{\_}WARNING} or 
\textsl{OMI{\$}{\_}ERROR}, it's always safe to use the following check: \\
\indent\textsf{{\$} IF {\$}STATUS .GE. OMI{\$}{\_}WARNING} \\
This might cause valid input to be signaled as invalid, but it will never 
accept invalid input.

\subsection{OMI{\$}MSGLINE{\_}CLEAR}
\index{OMI commands in modules!OMI{\$}MSGLINE{\_}CLEAR}
\label{subsubsec:mylabel57}

\indent Format: \textbf{OMI{\$}MSGLINE{\_}CLEAR}\\*[3mm]
This command erases the contents of the message line of the OMI menu window.

\subsection{OMI{\$}REFRESH}
\index{OMI commands in modules!OMI{\$}REFRESH}
\index{refresh the screen}
\label{subsubsec:mylabel58}

\indent Format: \textbf{OMI{\$}REFRESH}\\*[3mm]
Rebuilds the menu window with the current menu options. This option is 
especially useful after the \textsl{OMI{\$}DISPLAY{\_}INFO} command.

\subsection{OMI{\$}POPUP}
\index{OMI commands in modules!OMI{\$}POPUP}
\label{subsubsec:mylabel59}


\indent Format: \textbf{OMI{\$}POPUP \textit{message} [\textit{OPTION}[,...]]}\\*[3mm]
This command displays a popup- message box on top of the menu screen. The 
user then has to press return to acknowledge the message.\\[3mm]
\textbf{Parameter}\\*[3mm]
The first parameter should be enclosed by double quotes. It contains the 
message that will be displayed in the popup box.\\[3mm]

\textbf{Options}\\*[3mm]

\begin{itemize}
\item \textsl{NOREFRESH} Prevent the screen to be refreshed after displaying a popup.
This is done by default, but when the command is called by an 
\textsl{ON{\_}INIT} element (see section \ref{subsubsec:mylabel22}), the menu 
screen is yet to be drawn. Use \textsl{NOREFRESH} in this situation to prevent the screen to be drawn twice.

\item \textsl{NOWAIT} Also default behaviour is a call of \textsl{OMI{\$}WAIT} after displaying
the popup. This can be suppressed by the option \textsl{NOWAIT}. This is useful
when the popup has a \textit{please wait...} function.

\item \textsl{CONFIRM} This options causes \textsl{OMI{\$}CONFIRM} to be called after displaying the popup. The  question that is asked is taken from the \textsl{[QUESTIONS]} section in the configuration file: \textsl{DEFAULT{\_}CONFIRM} (see section \ref{para:defconfirm}), without a default answer.\\
If \textsl{YES} is answered, \textsl{OMI{\$}POPUP} returns status \textsl{OMI{\$}{\_}OK}, otherwise \textsl{OMI{\$}{\_}WARNING}. This can be used to prevent leaving a submenu with an \textsl{ON{\_}EXIT} module.\\
The \textsl{CONFIRM} option implies \textsl{NOWAIT}.

\item \textsl{COLORSCHEME=\textit{\lt scheme\gt }} Select one of the following predefined colorschemes:\\
{\begin{description}
\item[\textsl{ALERT}] The popup will be displayed with inversed colors.
\item[\textsl{WARNING}] The popup will be displayed with black text on a yellow background.
\item[\textsl{ERROR}] The popup will be displayed with white text on a red background.
\end{description}}
\end{itemize}

Multiple options can be specified comma-seperated, but make sure there are \textit{no}
blanks between the options!

\subsection{OMI{\$}REVERSE}
\index{OMI commands in modules!OMI{\$}REVERSE}
\label{subsubsec:mylabel60}

\indent Format: \textbf{OMI{\$}REVERSE \textit{string}}\\*[3mm]
This command does what you would expect the DCL lexical 
\linebreak\textit{F{\$}EDIT(string,"REVERSE")} to do, if it would exist; it reverses
the string that is given as an argument.\\[3mm]
\textbf{Return value}\\*[3mm]
The reversed value of the input string will be returned in the global symbol 
\textsl{OMI{\$}REVERSED}.\\[3mm]
\textbf{Example}\\*[3mm]
\begin{small}
\begin{textsf}
\indent{\$} DIRECTORY = "DEVICE:[TOPDIR.SUBDIR]" \\
\indent{\$} OMI{\$}REVERSE 'DIRECTORY'                    \\
\indent{\$}!\hspace{3cm} result: ]RIDBUS.RIDPOT[:ECIVED \\
\indent{\$} REVERSED = OMI{\$}REVERSED - "]"              \\
\indent{\$}!\hspace{3cm} result: RIDBUS.RIDPOT[:ECIVED \\
\indent{\$} FILENAME = F{\$}ELEMENT(0, ".", REVERSED) \\
\indent{\$} REVERSED = REVERSED - "''FILENAME'."          \\
\indent{\$}!\hspace{3cm} result: RIDPOT[:ECIVED \\
\indent{\$} FILENAME = "RID." + FILENAME + "]" + REVERSED \\
\indent{\$}!\hspace{3cm} result: RID.RIDBUS]RIDPOT[:ECIVED \\
\indent{\$} OMI{\$}REVERSE 'FILENAME' \\
\indent{\$} FILENAME = OMI{\$}REVERSED \\
\end{textsf}
\end{small}\\*[3mm]
This example reads a directory specification as input, reverses it and 
filters the last directory as a filename. The new filename is composed 
completely reversed including the file type (reversed of ``.DIR'').

After this, the complete name is reversed again, resulting in the value 
\linebreak DEVICE:[TOPDIR]SUBDIR.DIR.


\subsection{OMI{\$}SIGNAL}
\index{OMI commands in modules!OMI{\$}SIGNAL}
\index{message handling}
\label{subsubsec:mylabel61}

\indent Format: \textbf{OMI{\$}SIGNAL \textsf{facility identifier[,variable,variable...]}}\\*[3mm]
This command signals a message that will be read from the message data file. \\
Message data files can be created and filled with the \textsl{OMI{\$}MANAGE}\index{messages}\index{omi\$manage menu} menu\footnote{ This menu is not documented, but comes with a basic OMI help file. Type \texttt{INFO} in the menu for more information.}.\\[3mm]
\textbf{Parameters}

\begin{description}
\item[Facility]
The first parameter points to the facility of which the message should be 
signaled. This requires the message file 
\textsl{OMI{\$}:\textit{facility}{\$}MESSAGES.DAT}

\item[Identifier]
The second parameter identifies the message. The message file has an indexed 
format, and the identifier is the key that will be used to read the message.

\item[\textit{variable(s)}]
If the message contains variables, the string in the data file has to 
contain the substring \textsl{\~{}S}, which will be replaced by the arguments that were 
given in the second argument, separated by commas.\\
\hspace{-3mm}\textbf{NOTE:} If arguments are passed to \textsl{OMI{\$}SIGNAL} using lexical 
functions they have to be preceded by a single quote, e.g.: \\
\textsl{{\$} OMI{\$}SIGNAL MYFACIL MYIDENT,VAR1,'F{\$}EDIT(STR2,"UPCASE")}
\end{description}

\subsection{OMI{\$}SUBSTITUTE}
\index{OMI commands in modules!OMI{\$}SUBSTITUTE}
\label{subsubsec:mylabel62}

\indent Format: \textbf{OMI{\$}SUBSTITUTE \textit{search-string replace-string input-string}}\\*[3mm]
This command can be used to replace a substring by another string in the 
input string.\\[3mm]
\textbf{Parameters}\\*[3mm]
The first parameter specifies the search string. This string will be 
replaced by the substring specified in the second parameter

The third parameter is the input string in which the substring has to be 
replaced.\\[3mm]
\textbf{Return value}\\*[3mm]
The result of this function is returned in the global symbol 
\textsl{OMI{\$}SUBSTITUTED}.

If the search string of the first argument was not found in the input 
string, this command returns \textsl{OMI{\$}{\_}WARNING}.

\subsection{OMI{\$}SUBMIT}
\index{OMI commands in modules!OMI{\$}SUBMIT}
\label{subsubsec:mylabel63}

\indent Format: \textbf{OMI{\$}SUBMIT \textit{omi-module}}\\*[3mm]
With this command, an OMI module can be started in the background. It works 
the same as using the qualifier \textsl{/BACKGROUND=BATCH} from the DCL 
prompt.

When starting a background process from the OMI prompt, a module can only be 
started as a batch job; not as a detached process. 

All defaults for the Submit command (batch queue, log file) are taken from 
the \textsl{[BGRPROCESS]} section in the user's configuration file.\\[3mm]
\textbf{Parameter}\\*[3mm]
The parameter is the name of the OMI module to start (\textsl{\textit{name}.OMI}). It has to be 
located in the \textsl{OMI{\$}MENU{\_}DIRECTORY:} search path. This module should be 
created to run unattended (e.g. using Mailboxes for communication).

\subsection{OMI{\$}WAIT}
\index{OMI commands in modules!OMI{\$}WAIT}
\label{subsubsec:mylabel64}

\indent Format: \textbf{OMI{\$}WAIT}\\*[3mm]
Causes the procedure to wait until the user hits the Return key. By default 
the user will be prompted with the line \textsl{Press \lt Return\gt{} to continue}. This can be overwritten by 
modifying the value of \textsl{WAIT{\_}PROMPT} in the section \textsl{[QUESTIONS]} of the 
configuration file.

This command is very useful when output is displayed, e.g. using the 
\textsl{OMI{\$}DISPLAY{\_}INFO}\index{OMI commands in modules!OMI{\$}DISPLAY{\_}INFO} 
command and the screen has to be refreshed before returning to the menu.

\vs

When running in batch mode (see section \ref{subsubsec:mylabel3}, this command
is ignored.\\[3mm]
\textbf{Return value}\\*[3mm]
By default, this command returns status code \textsl{OMI{\$}{\_}OK} (normal 
successful completion). When the user presses Ctrl/Z in stead of \lt Return\gt, 
this function returns \textsl{OMI{\$}{\_}CANCELLED}.\\[3mm]
\textbf{Example}\\*[3mm]
\begin{textsf}
\indent{\$}LOOP: \\
\indent{\$} READ /END{\_}OF{\_}FILE=END INPUT RECORD \\
\indent{\$} OMI{\$}RECORD1 = "Date : " + F{\$}ELEMENT(0, "{\#}", RECORD) \\
\indent{\$} OMI{\$}RECORD2 = "Count : " + F{\$}ELEMENT(1, "{\#}", RECORD) \\
\indent{\$} OMI{\$}DISPLAY{\_}INFO \\
\indent{\$} OMI{\$}WAIT \\
\indent{\$} IF {\$}STATUS .EQ. OMI{\$}{\_}CANCELLED THEN {\$} GOTO END \\
\indent{\$} GOTO LOOP \\
\indent{\$}! \\
\indent{\$}END: \\
\indent{\$}! \\
\indent{\$} CLOSE INPUT \\
\indent{\$} OMI{\$}REFRESH \\
\indent{\$} EXIT \\
\end{textsf}\\*[3mm]
In this example, information, read from an input file, is displayed record 
by record in a loop. When the user has seen enough, she can cancel the loop 
by pressing Ctrl/Z.

\section{OMI symbols}
\label{subsec:mylabel7}

\subsection{Symbols defined by OMI}
\index{OMI symbols}
\index{symbols in OMI}
\label{subsubsec:symbols}


When OMI starts, several symbols are defined that can be used in OMI 
modules. These symbols are all local. \\
A list of these symbols is provided in table \ref{tab:locsymbols}.

\begin{table}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\begin{tabular}{lp{9cm}} \hline
\textsl{OMI{\$}{\_}OK}\index{return values}\index{OMI{\$}{\_}OK}\index{OMI symbols!local symbols!OMI{\$}{\_}OK} & 
This is an exit status that indicates a normal successful completion. \\
\textsl{OMI{\$}{\_}WARNING}\index{return values}\index{OMI{\$}{\_}WARNING}\index{OMI symbols!local symbols!OMI{\$}{\_}WARNING} & 
This is an exit status that can be used for warnings. If an 
OMI module exits with a warning, OMI takes no action, but 
it might be useful when OMI modules call other procedures. \\
\textsl{OMI{\$}{\_}ERROR}\index{return values}\index{OMI{\$}{\_}ERROR}\index{OMI symbols!local symbols!OMI{\$}{\_}ERROR} & 
This is an exit status that can be used for errors. If an OMI 
module exits with an error, OMI takes no action, but it 
might be useful when OMI modules call other procedures. \\
\textsl{OMI{\$}{\_}CANCELLED}\index{return values}\index{OMI{\$}{\_}CANCELLED}\index{OMI symbols!local symbols!OMI{\$}{\_}CANCELLED} & 
This is an exit status that can be used for special purposes. \\
\textsl{OMI{\$}NODENAME}\index{nodename}\index{OMI{\$}NODENAME}\index{OMI{\$}NODENAME} & 
The nodename on which OMI is currently running. \\
\textsl{OMI{\$}CURRENT{\_}USER}\index{username}\index{OMI{\$}CURRENT{\_}USER}\index{OMI symbols!local symbols!OMI{\$}CURRENT{\_}USER} & 
The name of the user currently running the menu is stored in this symbol. \\
\textsl{OMI{\$}MENU{\_}FILE}\index{menu!filename}\index{OMI{\$}MENU{\_}FILE}\index{OMI symbols!local symbols!OMI{\$}MENU{\_}FILE} & 
The filename of the menu that's currently in use, without the directory specification. \\
\textsl{OMI{\$}MENU{\_}LOCATION}\index{OMI{\$}MENU{\_}LOCATION}\index{OMI symbols!local symbols!OMI{\$}MENU{\_}LOCATION} & 
The location of the menu file that is currently in use. \\
\textsl{OMI{\$}{\_}MESSAGE}\index{OMI commands in modules!debugging}\index{OMI{\$}{\_}MESSAGE}\index{OMI symbols!local symbols!OMI{\$}{\_}MESSAGE} & 
This symbol is used to store the environmental value of `message' in. Before
an OMI module is called, all messages are switched off with \newline
\indent\small{\textsf{{\$} SET MESSAGE /NOFACILITY /NOSEVERITY -}} \newline
\indent\indent\small{\textsf{/NOIDENTIFICATION /NOTEXT}} \newline
To switch it on, use the command \newline
\indent\small{\textsf{{\$} SET MESSAGE \'{}OMI{\$}{\_}MESSAGE}} \newline
This is especially useful when debugging OMI modules. In interactive subprocesses
(after the \textsl{SPAWN} command), the original message state is
automatically restored. \\
\textsl{OMI{\$}{\_}NOMATCH}\index{OMI{\$}{\_}NOMATCH}\index{OMI symbols!local symbols!OMI{\$}{\_}NOMATCH} & 
When using the VMS SEARCH command in OMI modules to search for 
values in files, the return status can be compared with this 
symbol to check if the value was found, as in: \linebreak
\indent\small{\textsf{{\$} IF {\$}STATUS .EQ. OMI{\$}{\_}NOMATCH THEN -}}\newline
\indent\indent\small{\textsf{{\$} GOTO NOTFOUND}}\\
\textsl{OMI{\$}OPTION}\index{OMI{\$}OPTION}\index{OMI symbols!local symbols!OMI{\$}OPTION} & 
This symbol contains the last numeric value that has been entered 
by the user, or the command line. \\
\textsl{OMI{\$}OPTION\_TYPE}\index{OMI{\$}OPTION\_TYPE}\index{OMI symbols!local symbols!OMI{\$}OPTION\_TYPE} & 
This symbol contains the option type of the latest item that was selected by
the user. This can be \textsl{SUBMENU}, \textsl{COMMAND} or \textsl{CALL}. \\
\hline
\end{tabular}
\caption{Local symbols in OMI}\index{OMI symbols!local symbols}\label{tab:locsymbols}
\end{minipage}
\end{table}

\subsection{Symbols for font- and color selection}\label{subsection:fontcolors}\index{fonts}\index{colors}\index{background color|see{colors}}

OMI provides several symbols that controls how text is displayed in the terminal. The symbols are based on the ANSI escape codes. \\
The full list of symbols provided by OMI are givben in table \ref{tab:fontsymbols}.

\vs

All symbols symbols can be specified in any combination as the following example shows:\\
\\
\textsf{\scriptsize{{\$} OMI{\$}DISPLAY{\_}MESSAGE "''SCREEN{\$}BG{\_}RED'''SCREEN{\$}FG{\_}BLACK'This is an " + - \\ \hspace*{5mm}"''SCREEN{\$}TEXT{\_}BOLD'important''SCREEN{\$}RESET{\_}BOLD' message!''SCREEN{\$}RESET{\_}ALL'"}}

\begin{table}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\begin{tabular}{lp{60mm}l} \hline
\textbf{Symbol}   & \textbf{Description}  & \textbf{Reset symbol} \\ \hline
\multicolumn{3}{l}{\textit{Font selection}\footnote{ Not all font variants are supported by all terminals and emulators}} \\ \hline
\scriptsize{\textsl{SCREEN{\$}TEXT{\_}BOLD}         }   & Select a bold font variant (increased density) & \scriptsize{\textsl{SCREEN{\$}RESET{\_}BOLD}         } \\
\scriptsize{\textsl{SCREEN{\$}TEXT{\_}FADED}        }   & Select a faded font variant (decreased density) & \scriptsize{\textsl{SCREEN{\$}RESET{\_}FADED}        } \\
\scriptsize{\textsl{SCREEN{\$}TEXT{\_}ITALIC}       }   & Select an italic font variant & \scriptsize{\textsl{SCREEN{\$}RESET{\_}ITALIC}       } \\
\scriptsize{\textsl{SCREEN{\$}TEXT{\_}UNDERLINE}    }   & Select an undelined font variant & \scriptsize{\textsl{SCREEN{\$}RESET{\_}UNDERLINE}    } \\
\scriptsize{\textsl{SCREEN{\$}TEXT{\_}BLINK}        }   & Select a font variant & \scriptsize{\textsl{SCREEN{\$}RESET{\_}BLINK}        } \\
\scriptsize{\textsl{SCREEN{\$}TEXT{\_}INVERSE}      }   & Inverse foreground- and background color & \scriptsize{\textsl{SCREEN{\$}RESET{\_}INVERSE}      } \\
\scriptsize{\textsl{SCREEN{\$}TEXT{\_}HIDDEN}       }   & Hide the foreground & \scriptsize{\textsl{SCREEN{\$}RESET{\_}HIDDEN}       } \\
\scriptsize{\textsl{SCREEN{\$}TEXT{\_}STRIKETRHOUGH}}   & Select a struck-out font variant & \scriptsize{\textsl{SCREEN{\$}RESET{\_}STRIKETRHOUGH}} \\
\hline\multicolumn{3}{l}{\textit{Foreground color selection}} \\ \hline
\scriptsize{\textsl{SCREEN{\$}FG{\_}BLACK}  }           & Set the foreground color to black   & \scriptsize{\textsl{SCREEN{\$}FG{\_}RESET}} \\
\scriptsize{\textsl{SCREEN{\$}FG{\_}MAROON} }           & Set the foreground color to maroon  & \scriptsize{\textsl{SCREEN{\$}FG{\_}RESET}} \\
\scriptsize{\textsl{SCREEN{\$}FG{\_}GREEN}  }           & Set the foreground color to green   & \scriptsize{\textsl{SCREEN{\$}FG{\_}RESET}} \\
\scriptsize{\textsl{SCREEN{\$}FG{\_}OLIVE}  }           & Set the foreground color to olive   & \scriptsize{\textsl{SCREEN{\$}FG{\_}RESET}} \\
\scriptsize{\textsl{SCREEN{\$}FG{\_}NAVY}   }           & Set the foreground color to navy    & \scriptsize{\textsl{SCREEN{\$}FG{\_}RESET}} \\
\scriptsize{\textsl{SCREEN{\$}FG{\_}PURPLE} }           & Set the foreground color to purple  & \scriptsize{\textsl{SCREEN{\$}FG{\_}RESET}} \\
\scriptsize{\textsl{SCREEN{\$}FG{\_}TEAL}   }           & Set the foreground color to teal    & \scriptsize{\textsl{SCREEN{\$}FG{\_}RESET}} \\
\scriptsize{\textsl{SCREEN{\$}FG{\_}SILVER} }           & Set the foreground color to silver  & \scriptsize{\textsl{SCREEN{\$}FG{\_}RESET}} \\
\scriptsize{\textsl{SCREEN{\$}FG{\_}GREY}   }           & Set the foreground color to grey    & \scriptsize{\textsl{SCREEN{\$}FG{\_}RESET}} \\
\scriptsize{\textsl{SCREEN{\$}FG{\_}RED}    }           & Set the foreground color to red	  & \scriptsize{\textsl{SCREEN{\$}FG{\_}RESET}} \\
\scriptsize{\textsl{SCREEN{\$}FG{\_}LIME}   }           & Set the foreground color to lime    & \scriptsize{\textsl{SCREEN{\$}FG{\_}RESET}} \\
\scriptsize{\textsl{SCREEN{\$}FG{\_}YELLOW} }           & Set the foreground color to yellow  & \scriptsize{\textsl{SCREEN{\$}FG{\_}RESET}} \\
\scriptsize{\textsl{SCREEN{\$}FG{\_}BLUE}   }           & Set the foreground color to blue    & \scriptsize{\textsl{SCREEN{\$}FG{\_}RESET}} \\
\scriptsize{\textsl{SCREEN{\$}FG{\_}FUCHSIA}}           & Set the foreground color to fuchsia & \scriptsize{\textsl{SCREEN{\$}FG{\_}RESET}} \\
\scriptsize{\textsl{SCREEN{\$}FG{\_}AQUA}   }           & Set the foreground color to aqua    & \scriptsize{\textsl{SCREEN{\$}FG{\_}RESET}} \\
\scriptsize{\textsl{SCREEN{\$}FG{\_}WHITE}  }           & Set the foreground color to white   & \scriptsize{\textsl{SCREEN{\$}FG{\_}RESET}} \\
\hline\multicolumn{3}{l}{\textit{Background color selection}} \\ \hline
\scriptsize{\textsl{SCREEN{\$}BG{\_}BLACK}  }           & Set the background color to black   & \scriptsize{\textsl{SCREEN{\$}BG{\_}RESET}} \\
\scriptsize{\textsl{SCREEN{\$}BG{\_}MAROON} }           & Set the background color to maroon  & \scriptsize{\textsl{SCREEN{\$}BG{\_}RESET}} \\
\scriptsize{\textsl{SCREEN{\$}BG{\_}GREEN}  }           & Set the background color to green   & \scriptsize{\textsl{SCREEN{\$}BG{\_}RESET}} \\
\scriptsize{\textsl{SCREEN{\$}BG{\_}OLIVE}  }           & Set the background color to olive   & \scriptsize{\textsl{SCREEN{\$}BG{\_}RESET}} \\
\scriptsize{\textsl{SCREEN{\$}BG{\_}NAVY}   }           & Set the background color to navy    & \scriptsize{\textsl{SCREEN{\$}BG{\_}RESET}} \\
\scriptsize{\textsl{SCREEN{\$}BG{\_}PURPLE} }           & Set the background color to purple  & \scriptsize{\textsl{SCREEN{\$}BG{\_}RESET}} \\
\scriptsize{\textsl{SCREEN{\$}BG{\_}TEAL}   }           & Set the background color to teal    & \scriptsize{\textsl{SCREEN{\$}BG{\_}RESET}} \\
\scriptsize{\textsl{SCREEN{\$}BG{\_}SILVER} }           & Set the background color to silver  & \scriptsize{\textsl{SCREEN{\$}BG{\_}RESET}} \\
\scriptsize{\textsl{SCREEN{\$}BG{\_}GREY}   }           & Set the background color to grey    & \scriptsize{\textsl{SCREEN{\$}BG{\_}RESET}} \\
\scriptsize{\textsl{SCREEN{\$}BG{\_}RED}    }           & Set the background color to red	  & \scriptsize{\textsl{SCREEN{\$}BG{\_}RESET}} \\
\scriptsize{\textsl{SCREEN{\$}BG{\_}LIME}   }           & Set the background color to lime    & \scriptsize{\textsl{SCREEN{\$}BG{\_}RESET}} \\
\scriptsize{\textsl{SCREEN{\$}BG{\_}YELLOW} }           & Set the background color to yellow  & \scriptsize{\textsl{SCREEN{\$}BG{\_}RESET}} \\
\scriptsize{\textsl{SCREEN{\$}BG{\_}BLUE}   }           & Set the background color to blue    & \scriptsize{\textsl{SCREEN{\$}BG{\_}RESET}} \\
\scriptsize{\textsl{SCREEN{\$}BG{\_}FUCHSIA}}           & Set the background color to fuchsia & \scriptsize{\textsl{SCREEN{\$}BG{\_}RESET}} \\
\scriptsize{\textsl{SCREEN{\$}BG{\_}AQUA}   }           & Set the background color to aqua    & \scriptsize{\textsl{SCREEN{\$}BG{\_}RESET}} \\
\scriptsize{\textsl{SCREEN{\$}BG{\_}WHITE}  }           & Set the background color to white   & \scriptsize{\textsl{SCREEN{\$}BG{\_}RESET}} \\
\hline\multicolumn{3}{l}{\textit{Other symbols}} \\ \hline
\scriptsize{\textsl{SCREEN{\$}LINE{\_}MODE}}            & Switch to linemode where some characters represent symbols from the extended ascii table & \scriptsize{\textsl{SCREEN{\$}NORMAL{\_}MODE}} \\
\scriptsize{\textsl{SCREEN{\$}RESET{\_}ALL}}            & Reset all foreground and background attributes---except linemode---to the terminal default & \textit{n/a} \\
\end{tabular}
\caption{Symbol for font- and color selection}\index{OMI symbols!fonts and colors}\label{tab:fontsymbols}
\end{minipage}
\end{table}


\subsection{Global symbols set by OMI commands}
\index{OMI commands in modules!return values}
\index{OMI symbols!global symbols}
\index{symbols in OMI!return values}
\label{subsubsec:global}

The commands, listed in table \ref{tab:globsymbols}, are available after the OMI command is 
called that sets the symbol. These commands are described in section \ref{subsec:mylabel6}. \\
All symbols will automatically be removed when OMI exits.

\begin{table}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\begin{tabular}{ll} \hline
\textbf{Symbol} & \textbf{Set by the command}\\ \hline
\textsl{OMI{\$}CALCULATED}\index{OMI{\$}CALCULATED}\index{OMI symbols!global symbols!OMI{\$}CALCULATED} & \textsl{OMI{\$}CALC} \\
\textsl{OMI{\$}CONFIRMED}\index{OMI{\$}CONFIRMED}\index{OMI symbols!global symbols!OMI{\$}CONFIRMED} & \textsl{OMI{\$}CONFIRM} \\
\textsl{OMI{\$}DAYNUMBER}\index{OMI{\$}DAYNUMBER}\index{OMI symbols!global symbols!OMI{\$}DAYNUMBER} & \textsl{OMI{\$}DATE{\_}INFO} \\
\textsl{OMI{\$}DECRYPTED}\index{OMI{\$}DECRYPTED}\index{OMI symbols!global symbols!OMI{\$}DECRYPTED} & \textsl{OMI{\$}DECRYPT} \\
\textsl{OMI{\$}ENCRYPTED}\index{OMI{\$}ENCRYPTED}\index{OMI symbols!global symbols!OMI{\$}ENCRYPTED} & \textsl{OMI{\$}ENCRYPT} \\
\textsl{OMI{\$}MAILBOX}\footnote{ this is the default logical name if none was specified (see section \ref{subsubsec:mylabel47})}\index{OMI{\$}MAILBOX}\index{OMI symbols!global symbols!OMI{\$}MAILBOX} & \textsl{OMI{\$}CREATE{\_}MBX} \\
\textsl{OMI{\$}MONTHNUMBER}\index{OMI{\$}MONTHNUMBER}\index{OMI symbols!global symbols!OMI{\$}MONTHNUMBER} & \textsl{OMI{\$}DATE{\_}INFO} \\
\textsl{OMI{\$}RESPONSE}\index{OMI{\$}RESPONSE}\index{OMI symbols!global symbols!OMI{\$}RESPONSE} & \textsl{OMI{\$}ASK} \\
\textsl{OMI{\$}REVERSED}\index{OMI{\$}REVERSED}\index{OMI symbols!global symbols!OMI{\$}REVERSED} & \textsl{OMI{\$}REVERSE} \\
\textsl{OMI{\$}WEEKNUMBER}\index{OMI{\$}WEEKNUMBER}\index{OMI symbols!global symbols!OMI{\$}WEEKNUMBER} & \textsl{OMI{\$}DATE{\_}INFO} \\
\hline
\end{tabular}
\caption{Symbols set by OMI commands}\index{OMI symbols!global symbols}\label{tab:globsymbols}
\end{minipage}
\end{table}

\chapter{Adding Toolboxes}
\index{toolbox}
\label{sec:adding}

All commands that can be used in OMI modules (the commands described in 
section \ref{subsec:mylabel6}) are defined in a toolbox. The standard toolbox is called 
\linebreak\textsl{OMI{\$}TOOLBOX}, and is defined by \textsl{OMI{\$}TOOLBOX.INI}.

Figure \ref{fig:toolboxini} shows how the file \textsl{OMI{\$}TOOLBOX.INI}\index{toolbox!initialisation file} looks like by default, 
without the comments.

\begin{figure}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\hrulefill \\
\begin{small}
\begin{ttfamily}
\noindent[OMI{\$}TOOLBOX] ! Default location is OMI{\$}:, default file type is .COM \\
\indent ASK \\
\indent CONFIRM \\
\indent CHECK \\
\indent CREATE{\_}MBX \\
\indent DECRYPT \\
\indent ENCRYPT \\
\indent INPUT{\_}VALIDATE \\
\indent REVERSE \\
\indent WAIT \\
\end{ttfamily}
\end{small}
\caption{The OMI Toolbox initialization file}\label{fig:toolboxini}
\hrulefill
\end{minipage}
\end{figure}

\vs

If you want to write you own OMI commands, it is possible to add a toolbox 
to this initialization file.

To do this, add a section, with the name of your toolbox file, enclosed by 
square brackets, as shown in figure \ref{fig:toolboxadd}. By default, OMI looks for a file 
with that name and file type \textsl{.COM}, in the \textsl{OMI{\$}:} directory, but this can be 
overridden by specifying the full path and filename.

\begin{figure}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\hrulefill \\
\begin{ttfamily}
\noindent[MY{\_}TOOLBOX] \\
\indent MY-EASY-COMMAND \\
\indent MY-USEFULL-COMMAND \\
\indent MY-OTHER-TOOL \\
\end{ttfamily}
\caption{Initializing a toolbox}\label{fig:toolboxadd}
\hrulefill
\end{minipage}
\end{figure}


Next, create a file called MY{\_}TOOLBOX.COM, and store it in the directory 
where OMI is located. The file should start with the following two 
statements: \\
\indent\textsf{{\$} GOSUB 'p1'{\$} ! Or use GOTO if all subroutines contain an EXIT} \\
\indent\textsf{{\$} EXIT} \\
Make sure the command file contains subroutines for all commands with the 
label ``MY-COMMAND{\$}''. You can \textit{not} change this label layout, since OMI checks 
for the existence of this label during startup!

\vs

To write the code for the commands defined in figure \ref{fig:toolboxadd}, the file 
\linebreak MY{\_}TOOLBOX.COM should look like something displayed in figure \ref{fig:toolboxcre}

\begin{figure}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\hrulefill \\
\begin{ttfamily}
\noindent{\$} EXIT{\_}STATUS = OMI{\$}{\_}OK ! Routines can change this to OMI{\$}{\_}WARNING \\
{\$}!\hspace{3cm}or OMI{\$}{\_}ERROR when errors show up. \\
{\$} GOSUB 'p1'{\$} \\
{\$} EXIT 'EXIT{\_}STATUS \\
{\$}! \\
{\$} MY-EASY-COMMAND{\$}: \\
{\$}! \\
{\$} \textit{\lt Write your DCL code here\gt} \\
{\$} IF \textit{\lt any-condition\gt} THEN {\$} EXIT{\_}STATUS = OMI{\$}{\_}ERROR \\
{\$} RETURN \\
{\$}! \\
{\$} MY-USEFULL-COMMAND{\$}: \\
{\$}! \\
{\$} \textit{\lt Write your DCL code here\gt} \\
{\$} IF \textit{\lt any-condition\gt} THEN {\$} EXIT{\_}STATUS = OMI{\$}{\_}ERROR \\
{\$} RETURN \\
{\$}! \\
{\$} MY-OTHER-TOOL{\$}: \\
{\$}! \\
{\$} \textit{\lt Write your DCL code here\gt} \\
{\$} IF \textit{\lt any-condition\gt} THEN {\$} EXIT{\_}STATUS = OMI{\$}{\_}ERROR \\
{\$} RETURN \\
\end{ttfamily}
\caption{Write Toolbox code}\label{fig:toolboxcre}
\hrulefill
\end{minipage}
\end{figure}


\vs

The examples in this section would define the following three commands that 
are available in all OMI modules: \\
\indent\textsl{OMI{\$}MY-EASY-COMMAND} \\
\indent\textsl{OMI{\$}MY-USEFULL-COMMAND} \\
\indent\textsl{OMI{\$}MY-OTHER-TOOL}

\vs

\hspace{-8mm}\textbf{NOTE:} It is \textit{not} recommended to add commands to the file 
\textsl{OMI{\$}TOOLBOX.COM}, since they might get lost in a future release! \\
You should add a new section to the initialization file, and a new toolbox 
command file.

\chapter{Creating on-the-fly menus}
\index{on-the-fly menus}
\index{menu!on-the-fly}
\label{sec:mylabel2}


OMI modules can create \textit{on-the-fly} menus. They are used to setup a temporary submenu.

To do so, all menu items have to be specified in the module as 
global symbols, with the menu-name \textsl{OTF{\_}MENU}, e.g.: \\
\begin{small}
\begin{textsf}
\indent{\$} OTF{\_}MENU{\$}ITEM1 == "Leave this menu{\#}COMMAND{\#}BACK NOEXIT{\_}MODULE" \\
\indent{\$} OTF{\_}MENU{\$}ITEM2 == "Do something, then leave{\#}COMMAND{\#}BACK" \\
\indent{\$} OTF{\_}MENU{\$}INPUT1 == "Some input please{\#}VARIABLE{\#}This is default" \\
\indent{\$} OTF{\_}MENU{\$}ON{\_}EXIT == MY{\_}EXIT{\_}MODULE \\
\end{textsf}
\end{small}

\vs

At least one item element and one input element are required.
The global symbols are cleaned up automatically when leaving the menu.

When all menu elements are defined, use the command \textsl{OMI{\$}CREATE{\_}OTF} to 
invoke the menu.

\section{Limitations}
\label{subsec:limitationsnu}

\subsection{Menu elements}
\label{subsubsec:mylabel65}

All elements that can be specified in menu files, can be specified in 
on-the-fly menus, except those listed in table \ref{tab:elmotf}.

\begin{table}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\begin{tabbing}
(indent) \= \textsl{PASSWORD}(...) \= (..) \= \kill
 \> \textsl{NAME}     \> Names are used for jumping, which is not \\
 \>                   \> \> allowed to and from on-the-fly menus \\
 \> \textsl{PASSWORD} \> Security checks are not performed on \\
 \> \textsl{SECURITY} \> \> on-the-fly menus \\
\end{tabbing}
\caption{Elements not allowed in on-the-fly menus}\label{tab:elmotf}
\end{minipage}
\end{table}

\subsection{OTF menus in help files}
\label{subsec:otfhelp}\index{on-the-fly menus!in helpfiles}

The name of an on-the-fly menu by default is \textsl{OTF{\_}MENU}, which can be used to describe the menu in the helpfile (see also section \ref{sec:mnhelp}).

The symbol \textsl{OTF{\_}MENU{\$}INFO{\_}KEY} can be used to let the \textsl{INFO} command read a named section, e.g.: \\
\begin{small}
\begin{textsf}
\indent{\$} OTF{\_}MENU{\$}INFO{\_}KEY == OTFMNU{\_}1 \\
\indent{\$} OTF{\_}MENU{\$}ITEM1 == "Exit without changes{\#}COMMAND{\#}BACK NOEXIT{\_}MODULE" \\
\indent{\$} OTF{\_}MENU{\$}ITEM2 == "Write changes and exit{\#}COMMAND{\#}BACK" \\
\end{textsf}
\end{small}

In this example, the help file should contain a section \textsl{[OTFMNU{\_}1]}.

\subsection{OMI Commands}
\label{subsubsec:mylabel66}

Since jumping is not allowed, and security checks are not performed, several 
OMI commands, like \textsl{JUMP} and \textsl{(RE)SET PASSWORD} are not allowed in on-the fly 
menus. The commands or options that are not allowed are marked with a \dag\ in chapter 
\ref{sec:mylabel1}.

\section{Tag- and select lists}
\index{tag lists!in otf menus}
\index{select lists!in otf menus}
\label{subsec:mylabel8}

Tag- and select lists can be used and setup in on-the-fly menus on the same 
way as they are used in regular menus, like in: \\
\indent{\small\textsf{{\$} OTF{\_}MENU{\$}INPUT1 == "Make a selection{\#}{\{}SEL\textbar MY{\_}LIST{\}}VARIABLE{\#}VALUE1"}} \\
In this example, the symbol VARIABLE will be filled with a value that is 
selected from MY{\_}LIST. This can be an existing section in the menu file, 
or a section created dynamically.

\vs

\hspace{-8mm}\textbf{NOTE:} All sections in an on-the-fly menu, \textit{except} the menu section itself, 
have to be defined as \textit{local} symbols! \\
E.g.: \\
\begin{textsf}
\indent{\$} MY{\_}LIST{\$}VALUE1 = "Yes" \\
\indent{\$} MY{\_}LIST{\$}VALUE2 = "No" \\
\indent{\$} MY{\_}LIST{\$}VALUE3 = "Maybe" \\
\indent{\$} MY{\_}LIST{\$}DELIMITER = "/" ! So it can be used as a taglist as well \\
\end{textsf}

\vs

\begin{figure}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\hrulefill \\
\begin{small}
\begin{ttfamily}
\indent{\$}! First, define a symbol containing a filename \\
\indent{\$}! \\
\indent{\$} VALUE{\_}FILE = SYS{\$}SCRATCH:OMI{\$}VALUES{\_}'F{\$}CVTIME(,,"WEEKDAY")'.{\_}TMP{\$} \\
\indent{\$}! \\
\indent{\$}! Global symbols to define the menu \\
\indent{\$}! \\
\indent{\$} OTF{\_}MENU{\$}ON{\_}INIT == WRITE{\_}VALUE{\_}FILE 'VALUE{\_}FILE \\
\indent{\$} OTF{\_}MENU{\$}ON{\_}EXIT == 'OMI{\$}CURRENT{\_}USER'{\_}MODULE{\$} \\
\indent{\$} OTF{\_}MENU{\$}ITEM1 == "Exit without changes{\#}COMMAND{\#}BACK NOEXIT{\_}MODULE" \\
\indent{\$} OTF{\_}MENU{\$}ITEM2 == "Write changes and exit{\#}COMMAND{\#}BACK" \\
\indent{\$} OTF{\_}MENU{\$}INPUT1 == "Record ID{\#}UPDATE{\_}REC{\#}''CURRENT{\_}VALUE'{\#}FRM{\_}RECID"  \\
\indent{\$} OTF{\_}MENU{\$}INPUT2 == "Select value{\#}{\{}SEL\textbar REC{\_}VALUES{\}}{\#}NEW{\_}VALUE" \\
\indent{\$}! \\
\indent{\$}! Local symbols to define additional sections \\
\indent{\$}! \\
\indent{\$} REC{\_}VALUES{\$}FILENAME = "''VALUE{\_}FILE'" ! Read values from this file \\
\indent{\$}! \\
\indent{\$} FRM{\_}RECID{\$}TYPE = "INTEGER" \\
\indent{\$} FRM{\_}RECID{\$}MIN = 100 \\
\indent{\$} FRM{\_}RECID{\$}MAX = 999 \\
\indent{\$}! \\
\indent{\$}! Invoke the menu \\
\indent{\$}! \\
\indent{\$} OMI{\$}CREATE{\_}OTF \\
\indent{\$}! \\
\indent{\$} EXIT {\$}STATUS \\
\end{ttfamily}
\end{small}
\caption{Creating on-the-fly menus}\label{fig:otfcre}
\hrulefill
\end{minipage}
\end{figure}


A useful way to use tag- and select lists in on-the-fly menus, is with a 
FILENAME element combined with an \textsl{ON{\_}INIT} element to create a value file, 
as in the figure~\ref{fig:otfcre}.

This example shows an OMI module that sets up an on-the-fly menu. When the 
menu is invoked, the \textsl{ON{\_}INIT} module WRITE{\_}VALUE{\_}FILE.OMI is 
executed. Let's say that one reads the parameter (which contains a 
filename), and creates a list of values, that's called by the select list in 
input element 2.

Selecting input element 2 causes OMI to read all possible values from the 
specified file and creating a select list with it. When the user leaves the 
menu, using element 2 (``Write changes...''), the \textsl{ON{\_}EXIT} module is called.
This module is user specific (which means it should be there for all users in
this example).

\section{Saving an on-the-fly menu}
\label{subsec:saveotf}
\index{on-the-fly menus!save environment}

\textit{On-the-fly} menus are volatile envinroments, that disappear immediatly
after leaving the menu.

It might be useful however to save on \textit{on-the-fly} menu so a user
can return to the menu at any time.

\vs

To do so, the temporary file -- used by OMI to collect all -- can be
saved. An example of this trick can be seen in figure~\ref{fig:otfsavres}\footnote{ I still need to sort a few things out here. The example
given here doesn't work just like that, but with small modifications it works.
What I still need to sort out, is how it can be documented easily. \\
If you're reading this note, that means I forgot to update the docs---at the time of
writing this I don't have the time to continue, so I'll have to do it later.\\
Sorry for that, Oscar van Eijk, April 19, 2004.}.

\begin{figure}[h!tb]
\begin{minipage}[h!tb]{\textwidth}
\hrulefill \\
\begin{small}
\begin{ttfamily}
\indent{\$} IF F{\$}SEARCH ("SYS{\$}SCRATCH:OMI{\$}CHECK{\_}OTF{\_}MENU.{\_}TMP{\$}") .NES. "" THEN - \\
\indent\indent {\$} COPYY SYS{\$}SCRATCH:OMI{\$}CHECK{\_}OTF{\_}MENU.{\_}TMP{\$} - \\
\indent\indent SYS{\$}SCRATCH:OMI{\$}CHECK{\_}OTF{\_}MENU{\_}SAVED{\$}.{\_}TMP{\$} \\
\vspace{2mm}\\
\textsl{Call other menus or modules here} \\
\vspace{2mm}\\
\indent{\$} IF F{\$}SEARCH ("SYS{\$}SCRATCH:OMI{\$}CHECK{\_}OTF{\_}MENU{\_}SAVED{\$}.{\_}TMP{\$}") .NES. "" \\
\indent{\$} \indent THEN \\
\indent{\$} \indent\indent COPYY SYS{\$}SCRATCH:OMI{\$}CHECK{\_}OTF{\_}MENU{\_}SAVED{\$}.{\_}TMP{\$} - \\
\indent\indent\indent\indent SYS{\$}SCRATCH:OMI{\$}CHECK{\_}OTF{\_}MENU.{\_}TMP{\$} \\
\indent{\$} \indent\indent OMI{\$}CURRENT{\_}MENU = "OTF{\_}MENU" \\
\indent{\$} \indent\indent DELETEE SYS{\$}SCRATCH:OMI{\$}CHECK{\_}OTF{\_}MENU{\_}SAVED{\$}.{\_}TMP{\$};* \\
\indent{\$} ENDIF 
\end{ttfamily}
\end{small}
\caption{Save and restore an on-the-fly menu}\label{fig:otfsavres}
\hrulefill
\end{minipage}
\end{figure}


\chapter{OMI Command Reference}
\label{sec:mylabel1}

This command reference describes the commands that can be entered by the 
user on the OMI prompt, or as the third argument in the \textsl{COMMAND} item 
type\index{menu actions!execute a command} (see section \ref{subsubsec:mylabel35}).

Commands marked with a \dag\ are not available in 
\textsl{on-the-fly}\index{menu!on-the-fly}\index{on-the-fly menus} menus.

\section{ALL}
\index{OMI commands!ALL}
\label{subsec:mylabel9}

\indent Format: \textbf{ALL}\\*[3mm]
In a window where you can specify input fields, this command enables you to 
enter all values, without the need to select all options separately.

In those windows, the last option will always perform this command. The way 
you are prompted for it, can be modified in the OMI configuration file by 
changing the value of \textsl{ALL{\_}OPTIONS} in the section \textsl{[QUESTIONS]}.

\section{BACK}
\index{OMI commands!BACK}
\label{subsec:mylabel10}

\indent Format: \textbf{BACK [NOEXIT{\_}MODULE]}\\*[3mm]
With this command, you can go up one level. When you are at the top level, 
this will exit the menu.

This command performs the same function as the keystroke \lt Ctrl/Z\gt, or 
entering ``0'' (zero), followed by \lt Return\gt.\\[3mm]
\textbf{Parameter}\index{menu!exit module!skipping}\\*[3mm]
The option \textsl{NOEXIT{\_}MODULE} can optionally be specified, which causes the 
\textsl{ON{\_}EXIT} module not to be executed.

By default, if an \textsl{ON{\_}EXIT} module is specified, it will always be executed 
if the current (sub)menu exits.

\section{CALC}
\index{OMI commands!CALC}
\label{subsec:mylabel11}

\indent Format: \textbf{CALC \textit{calculation}}\\*[3mm]
This command calls the internal OMI calculator. This calculator is very 
simple, but it can work with floating points and simple functions, and 
supports parentheses.

\vs

\textbf{Parameter}

\noindent The calculation is entered as one up to eighth parameters (integers, 
operator and parentheses can be entered as one parameter, or with blanks 
between them).

Integers can have a floating point. Dots (\textsl{.}) and commas (\textsl{,}) are recognized 
as floating points.

Operations currently supported are add (e.g. ``-12.4 + 8.53''), subtract (e.g. 
\textsl{14 - 68.032}), multiply (e.g. ``1.4 * 7'') and divide
(e.g. \textsl{156 / -2.56}).

\vs

When using more complex functions, like: ``(2+5)*((8-3)*4/2)/2'', OMI 
will just display the result: ``35''. To view all steps as they are 
calculated by OMI, simply put a question mark (?) somewhere in the formula 
(e.g.: ``(2+5)*((8-3)*4/2)/2?''). This will cause OMI to show all 
separate calculations as they are performed and substituted. \\
The question mark itself will be removed before calculation starts.

\vs

\hspace{-8mm}\textbf{NOTE:} The maximum size of the numbers (without the floating point) 
is 9 digits. This is a limitation in DCL\footnote{ The maximum value of an 
integer is 2,147,483,647. For several internal checks, the maximum value has to be 
reduced to 999,999,999 in OMI)}.

\section{CLS}
\index{OMI commands!CLS}

\indent Format: \textbf{CLS}\\*[3mm]
This command removes all text from the window, leaving the layout intact.

\section{DCL}
\index{OMI commands!DCL}
\label{subsec:mylabel12}

\indent Format: \textbf{DCL \textit{dcl{\_}command}} \\
\indent or: \textbf{{\$} \textit{dcl{\_}command}}\\*[3mm]
Enter any DCL command. The output of the DCL command will be displayed your 
terminal, and you'll have to press \lt Return\gt{} when execution is completed.

If you don't want the output on your screen, you can use the command 
\textsl{SILENT{\_}DCL}\index{OMI commands!SILENT{\_}DCL}.

\vs

In stead of the command \textsl{DCL}, the dollar sign 
(\textsl{{\$}})\index{{\$}}\index{dollar-sign} can also be used.

\vs

If the current user is not authorized for interactive DCL, a warning message 
will be displayed.\\[3mm]
\textbf{Parameter}\\*[3mm]
Enter any valid DCL command. If you omit a parameter, you will be prompted 
for the command.

When the command DCL is used in a \textsl{.MNU} file, OMI can prompt for additional 
input for the command, if the string \textsl{\~{}?} is used in the parameter
(see also section \ref{subsubsec:mylabel34} on page \pageref{para:dyninput}).

\section{DELETE}
\index{OMI commands!DELETE}
\label{subsec:delete}

This command deletes values from the current menu environment.

\subsection{DELETE TEXTAREA}
\index{textarea!delete}
\label{subsubsec:delete}

\indent Format: \textbf{DELETE TEXTAREA \textit{[sequence-number]}}\\*[3mm]
Delete the value of a text area from the current menu and the file in which 
the value is stored. If the current menu has more than 1 text area, a 
sequence number is required, indicating which text area should be displayed. 
This sequence number is not the same as the option number\footnote{\label{footnote:optionnumber} Option number refers to the number
of the input as displayed in the menu, which can either be given explicitly in the menufile, or
depends on the order in the menufile is \textsl{INPUT} elements are given without numbering}; if internal variable \textsl{INPUT2} is a textarea, and \textsl{INPUT1} is not, \textsl{INPUT2} has sequence number 1!

A text area can only be deleted if the format section of the input element 
has the option \textsl{KEEP} set to \textsl{TRUE} (see section \ref{para:mylabel5} on page \pageref{para:mylabel5}).

\vs

By default, this command will ask for a confirmation. This can be changed 
with the \textsl{CONFIRM} element in the configuration file (see section 
\ref{para:confirmput} on page \pageref{para:confirmput}).

This command requires \textsl{WRITE} privilege to the current menu.

\section{EDIT}
\index{OMI commands!EDIT}
\label{subsec:mylabel13}

This command modifies menu elements. All edit commands require write 
privilege to the menu in which it is invoked.

\subsection{EDIT ELEMENT}
\index{OMI commands!EDIT ELEMENT}
\label{subsubsec:mylabel67}

\indent Format: \textbf{EDIT ELEMENT \textit{option{\_}nr}}\dag\\*[3mm]
Use this command to edit one of the elements in the current menu. It starts 
an \textit{on-the-fly} menu, in which modifications to the selected element can be made. When 
the menu file is updated, changes are in effect immediately.\\[3mm]
\textbf{Parameter}\\*[3mm]
The parameter should be the option number as displayed on the screen, so 
it's the same number users should enter to select the element.

\subsection{EDIT MENU{\_}FILE}
\index{OMI commands!EDIT MENU{\_}FILE}
\index{menu!edit the file}
\label{subsubsec:mylabel68}

\indent Format: \textbf{EDIT MENU{\_}FILE}\dag\\*[3mm]
This command starts an interactive edit session with the editor
specified in  the user's configuration file, in which the current menu 
file can be modified. This command is only 
available in the top-level menu.

\subsection{EDIT VALUE{\_}FILE}
\index{OMI commands!EDIT VALUE{\_}FILE}
\index{select lists!from file}
\index{tag lists!from file}
\label{subsubsec:mylabel69}

\indent Format: \textbf{EDIT VALUE{\_}FILE \textit{option{\_}nr}}\\*[3mm]
If one of the options in the current menu has an input element with a tag- 
or select list that reads the values from a file (see section 
\ref{subsubsec:reading}), that file can be modified with this command.

When this command is entered, the editor, specified in the user's 
configuration file, is started to edit the file.\\[3mm]
\textbf{Parameter}\\*[3mm]
The parameter should be the option number as displayed on the screen, so 
it's the same number users should enter to select the input element.


\section{ENCRYPT}
\index{OMI commands!ENCRYPT}
\index{security!encrypting}
\index{encrypting}
\label{subsec:encrypt}

\indent Format: \textbf{ENCRYPT \textit{section-name element-name key-name}}\dag\\*[3mm]
Encrypt the specified element in the menu file. The encrypted new value is 
written to the menu file. Therefore, \textsl{WRITE} privilege to the current menu is 
required.

Since v1.1, encrypting an element requires a key, so you must have generated 
an own key using the \textsl{SET KEY}\index{OMI commands!SET KEY} command.

\vs

This command also changes the value of the selected element in the current 
OMI session, so the value can only be used again if the OMI module in which 
the value is required, calls \textsl{OMI{\$}DECRYPT}\index{OMI commands in 
modules!OMI{\$}DECRYPT} (see section \ref{subsubsec:mylabel50}).\\[3mm]
\textbf{Parameters}\\*[3mm]
This command requires three parameters. If they are omitted, OMI will prompt 
for them.

\vs

The first parameter specifies the section which holds the element that 
should be encrypted. Square brackets can be omitted.

The second parameter is the element name.

The third parameter should be the name of the key with which the string has 
to be encrypted. It has to exist at the keyring of the user's configuration 
file. If it's not there, it can be imported with the OMI command \textsl{IMPORT KEY}, 
or created with the \textsl{SET KEY} command.

\vs

Please note that encrypting an element that was already encrypted can cause 
unpredictable behavior!

\section{EXIT}
\index{OMI commands!EXIT}
\label{subsec:mylabel14}

\indent Format: \textbf{EXIT}\dag\\*[3mm]
Use this command to leave OMI. This will return control to your previous 
interface (e.g. the DCL prompt), from any menu level.

If you started a new menu using the \textsl{MENU} command, control will \textit{not} return to 
the previous menu.

\vs

\textsl{EXIT}\index{OMI commands!EXIT} and \textsl{QUIT}\index{OMI commands!QUIT} are 
synonymous.

\section{EXPORT KEY}
\index{OMI commands!EXPORT}
\index{encrypting!export key}
\label{subsec:export}

\indent Format: \textbf{EXPORT KEY \textit{key-name}}\\*[3mm]
Copy a key from the user specific keyring to the global keyring. This 
requires write privilege to the \textsl{OMI{\$}:} directory.\\[3mm]
\textbf{Parameter}\\*[3mm]
Specify the name of the key as a parameter. This has to be an existing key 
at the user specific keyring.

\section{HELP}
\index{OMI commands!HELP}
\label{subsec:mylabel15}

\indent Format: \textbf{HELP \textit{[topic]}}\\*[3mm]
This displays the online help file of OMI.

\section{IMPORT KEY}
\index{OMI commands!IMPORT}
\index{encrypting!import key}
\label{subsec:import}

\indent Format: \textbf{IMPORT KEY \textit{key-name}}\\*[3mm]
Copy a key from the global keyring to the user specific keyring.\\[3mm]
\textbf{Parameter}\\*[3mm]
Specify the name of the key as a parameter. This file must be made available 
at the global keyring. Keys with the same name at the user specific keyring 
are not allowed to exist.

\section{INCREASE}
\index{OMI commands!INCREASE}
\index{counters!increase}
\label{subsec:increase}

\indent Format: \textbf{INCREASE [REFRESH]}

\noindent Increase the counter for the current menu with 1. If the current menu has no 
counter, a message will be displayed.

The counter is automatically increased, every time the menu is accessed.\\[3mm]
\textbf{REFRESH}\\*[3mm]
If this option is specified, the menu screen will be refreshed after the 
increase. This option can be used if input fields with the previous counter 
value have to be cleared, or a comment line containing the counter value 
should be updated.

\section{INFO}
\index{OMI commands!INFO}
\label{subsec:cmdinfo}

\indent Format: \textbf{INFO}\\*[3mm]
If the current menu has an info section in the menu specific help
file\footnote{ \textsl{OMI\$MENU\_DIRECTORY:\textit{menu-file-name}.OMH}, 
where \textit{menu-file-name} is the same as the filename of the current menu file}, the
\textsl{INFO} command can be used to display the information. This way it is possible to add menu specific help.

For more information on writing help files, please refer to rection~\ref{sec:mnhelp}

\section{JUMP}
\index{OMI commands!JUMP}
\label{subsec:mylabel16}

\indent Format: \textbf{JUMP \textit{menu-name}}\dag\\*[3mm]
Jump immediately to the submenu with the name that's specified as a 
parameter of this command.

The name of submenus can be displayed using the
\textsl{SHOW NAME}\index{OMI commands!SHOW NAME}\index{name}\index{menu!name}
command, or automatically by setting the option \textsl{DISPLAY{\_}NAMES} in the
\textsl{[SCREEN]}\index{configuration file!modify the layout of OMI}
section of the configuration file to \textsl{TRUE}.

\section{MAIN}
\index{OMI commands!MAIN}
\label{subsec:mylabel17}

\indent Format: \textbf{MAIN}\dag\\*[3mm]
This command will always return to the top- level menu, from anywhere in the 
structure.

\section{MENU}
\index{OMI commands!MENU}
\label{subsec:mylabel18}

\indent Format: \textbf{MENU \textit{menu{\_}name}}\dag\\*[3mm]
Select another menu to work with. This command cleans up the current 
environment completely, causing the menu that you are working with, to be 
erased from memory.

\vs

\hspace{-8mm}\textbf{NOTE:} All values that have been entered during the current OMI 
session will be lost!\\[3mm]
\textbf{Parameter}\\*[3mm]
Enter a valid menu file. If the parameter is omitted, you will be prompted 
to enter one. The new menu will be loaded in memory, overwriting the current 
menu.

To retrieve a listing of all available menu files in \textsl{OMI{\$}:} and 
\linebreak\textsl{OMI{\$}MENU{\_}DIRECTORY:}\index{menu!listing of all menu files}, enter a 
question mark (\textsl{?}).

\section{QUIT}
\index{OMI commands!QUIT}
\label{subsec:mylabel19}

\indent Format: \textbf{QUIT}\dag\\*[3mm]
Use this command to leave OMI. This will return control to your previous 
interface (e.g. the DCL prompt), from any menu level.

If you started a new menu using the \textsl{MENU} command, control will NOT return to 
the previous menu.

\vs

\textsl{QUIT}\index{OMI commands!QUIT} and \textsl{EXIT}\index{OMI commands!EXIT} are 
synonymous.

\section{REFRESH}
\index{OMI commands!REFRESH}
\index{refresh the screen}
\label{subsec:refresh}

\indent Format: \textbf{REFRESH}

\noindent Refresh the menu screen.

\section{RESET}
\index{OMI commands!RESET}
\label{subsec:reset}

This command resets or removes the value of the variable, specified by a 
keyword.

\subsection{RESET AUTO{\_}REFRESH}
\index{OMI commands!RESET AUTO{\_}REFRESH}
\label{subsubsec:reset}

\indent Format: \textbf{RESET AUTO{\_}REFRESH}\\*[3mm]
Use this command to disable the automatic screen refresh is disabled.

\subsection{RESET COUNTER}
\index{OMI commands!RESET COUNTER}
\index{counters!reset}
\label{subsubsec:mylabel70}

\indent Format: \textbf{RESET COUNTER}\\*[3mm]
Set the counter of the current menu to 0 (zero) (see also footnote 
\arabic{resetfnote} on page \pageref{fnote:resetcounter}).
If the current menu has no counter, a message will be displayed.

\subsection{RESET NAME}
\index{OMI commands!RESET NAME}
\index{name}
\index{menu!name}
\label{subsubsec:mylabel71}

\indent Format: \textbf{RESET NAME}\dag\\*[3mm]
Remove the name of the current menu. A name can be used to jump between 
menus, or to startup in a submenu when the name is specified on the DCL 
prompt. This command requires \textsl{WRITE} privilege to the current menu.

\subsection{RESET ORDER}
\index{OMI commands!RESET ORDER}
\index{enter input!required order}
\label{subsubsec:mylabel72}

\indent Format: \textbf{RESET ORDER}\\*[3mm]
If the current menu has a required order (see section 
\ref{subsubsec:mylabel29}), a list is maintained in the background, 
which remembers the input elements that have already been selected. The list 
changes every time one of the required inputs is selected for the first 
time. If all required inputs have been selected, the list is empty, and will 
remain empty during the current OMI session, unless the command \textsl{RESET ORDER} 
is issued in the menu having the list.

\subsection{RESET PASSWORD}
\index{OMI commands!RESET PASSWORD}
\label{subsubsec:mylabel73}

\indent Format: \textbf{RESET PASSWORD}\dag\\*[3mm]
This command removes the password for the current menu, if one was set. This 
requires \textsl{WRITE} privilege to the current menu.

\subsection{RESET VARIABLES}
\index{OMI commands!RESET VARIABLES}
\label{subsubsec:resetvar}

\indent Format: \textbf{RESET VARIABLES [BACKGROUND]}\\*[3mm]
Use this command to reset all variables in the current menu to
their default values as specified in the menu file.

The \textsl{BACKGROUND} option can be added to prevent OMI from refreshing the
screen and displaying a message if the command is called in the background.

\section{SET}
\label{subsec:mylabel20}

The \textsl{SET} command can be used to change the value of an internal OMI variable.

\subsection{SET AUTO{\_}REFRESH}
\index{OMI commands!SET AUTO{\_}REFRESH}
\index{refresh the screen!automatically}
\label{subsubsec:mylabel74}

\indent Format: \textbf{SET AUTO{\_}INCREASE \textit{value}}

\noindent Use this command to set or change the interval in seconds with which the 
menu screen is automatically refreshed. The value should be between 0 and 
255. When set to 0, the automatic refresh is disabled.

\subsection{SET COUNTER}
\index{OMI commands!SET COUNTER}
\index{menu!counter}
\label{subsubsec:mylabel75}

\indent Format: \textbf{SET COUNTER}\\*[3mm]
Use this command to set the counter for the current menu to another value. 
If the current menu has no counter, a message will be displayed.

\subsection{SET KEY}
\index{OMI commands!SET KEY}
\index{security!encryption key}
\index{encrypting!define key}
\label{subsubsec:mylabel76}

\indent Format: \textbf{SET KEY \textit{value}}\\*[3mm]
This command defines a personal key. This key will be used for the 
\textsl{ENCRYPT}\index{OMI commands!ENCRYPT} command in OMI, and for the 
\textsl{OMI{\$}ENCRYPT}\index{OMI commands in modules!OMI{\$}ENCRYPT} and 
\textsl{OMI{\$}DECRYPT}\index{OMI commands in modules!OMI{\$}DECRYPT} command in OMI 
modules.

\vs

When menu items are encrypted using any of these commands, they can only be 
decrypted by the same user, or by users who have the same key defined.

Keys cannot be shared between users (except in shared installations, see 
section \ref{subsubsec:shared}). Every user can define only one key.

\noindent\textbf{Parameter}\\[3mm]
The parameter must be an integer value between 1 and 1,000,000.

\subsection{SET NAME}
\index{OMI commands!SET NAME}
\index{name}
\index{menu!name}
\label{subsubsec:mylabel77}

\indent Format: \textbf{SET NAME \textit{menu-name}}\dag\\*[3mm]
Modify the name of the current menu, or define one if the current menu has 
no name. A name can be used to jump between menus, or to startup in a 
submenu when the name is specified on the DCL prompt.

This command requires \textsl{WRITE} privilege to the current menu.

\vs

\hspace{-8mm}\textbf{NOTE:} If you want a menu to have the name \textsl{RESET}, you need to set 
this name using the editor, this won't work with the \textsl{SET} command, since this 
name conflicts with OMI internal names.\\[3mm]
\textbf{Parameter}\\*[3mm]
The new menu name can optionally be specified as a parameter. If omitted, 
OMI will prompt for a new menu name.

The parameter cannot be \textsl{RESET}.

\subsection{SET PASSWORD}
\index{OMI commands!SET PASSWORD}
\label{subsubsec:mylabel78}

\indent Format: \textbf{SET PASSWORD}\dag \\*[3mm]
Change the password for the current menu. If the current menu has no 
password, it will be defined using this command. The password must be at 
least five characters long.

This command requires \textsl{WRITE} privilege to the current menu.

\vs

\hspace{-8mm}\textbf{NOTE:} The password can not have the value \textsl{RESET}!

\subsection{SET WIDTH}
\index{OMI commands!SET WIDTH}
\label{subsubsec:mylabel79}

\indent Format: \textbf{SET WIDTH \textit{value}}\\*[3mm]
Use this command to modify the screen width. The value can be 80 or 132.

\section{SHOW}
\label{subsec:showthis}

This command displays the value of an internal OMI variable.

\subsection{SHOW COUNTER}
\index{OMI commands!SHOW COUNTER}
\index{menu!counter}
\label{subsubsec:mylabel80}

\indent Format: \textbf{SHOW COUNTER}\\*[3mm]
Show the current value of the counter for this menu. If the current menu has 
no counter, a warning message will be displayed.

\subsection{SHOW NAME}
\index{OMI commands!SHOW NAME}
\index{name}
\index{menu!name}
\label{subsubsec:mylabel81}

\indent Format: \textbf{SHOW NAME}\\*[3mm]
Display the name of the current menu, if one has been set. These names can 
be used to jump to the menu immediately from anywhere in the menu structure, 
or by specifying the menu name as the second parameter on the DCL command 
line when OMI is started.

\subsection{SHOW ORDER}
\index{OMI commands!SHOW ORDER}
\index{enter input!required order}
\label{subsubsec:mylabel82}

\indent Format: \textbf{SHOW ORDER}

\vs

If the current menu has a required order (see section 
\ref{subsubsec:mylabel29}), this command can be used to display the 
list which is maintained in the background, to see which input elements 
still have to be selected, and in which order.

\subsection{SHOW TEXTAREA}
\index{OMI commands!SHOW TEXTAREA}
\index{textarea!display contents}
\label{subsubsec:mylabel83}

\indent Format: \textbf{SHOW TEXTAREA [sequence-number]}\\*[3mm]
Display the value of a text area from the current menu. If the current menu 
has more than 1 text area, a sequence number is required, indicating which 
text area should be displayed. This sequence number is not the same as the 
option number (see footnote \ref{footnote:optionnumber} on page \pageref{footnote:optionnumber});
if internal variable \textsl{INPUT2} is a textarea, and \textsl{INPUT1} is not, 
\textsl{INPUT2} has sequence number 1

\vs

If the option \textsl{LARGE} in the format section of the variable is set to \textsl{TRUE} 
(see section \ref{para:mylabel5}), it is possible that this 
command does not display anything without warning.

\subsection{SHOW VERSION}
\index{OMI commands!SHOW VERSION}
\label{subsubsec:mylabel84}

\indent Format: \textbf{SHOW VERSION}\\*[3mm]
Show the current version of OMI.

\subsection{SHOW VMS{\_}MESSAGE}
\index{OMI commands!SHOW VMS{\_}MESSAGE}
\label{subsubsec:mylabel85}

\indent Format: \textbf{SHOW VMS{\_}MESSAGE \textit{status-code}}\\*[3mm]
This command translates a VMS status\index{VMS!error 
messages}\index{VMS!status codes} code to a message and displays it on the 
OMI message line.\\[3mm]
\textbf{Parameter}\\*[3mm]
A valid status code is required. If omitted, OMI will prompt for a status 
code. The value can be specified as decimal or hexadecimal integer value.

\section{SILENT{\_}DCL}
\index{OMI commands!SILENT{\_}DCL}
\label{subsec:silent}

\indent Format: \textbf{SILENT{\_}DCL \textit{dcl{\_}command}}\\*[3mm]
Enter any DCL command. The output of the command will not be displayed on 
the screen, leaving your layout intact.

The destination of the output, including errors, is defined in the OMI 
configuration file, element \textsl{SILENT{\_}OUTPUT} in section \textsl{[MAIN]}. By default, 
this will be NLA0:

The final status code will be displayed on the OMI message line.\\[3mm]
\textbf{Parameter}\\*[3mm]
Enter any valid DCL command. If you omit a parameter, you will be prompted 
for the command.

When the command \textsl{SILENT{\_}DCL} is used in a menu file, OMI can prompt for 
additional input for the command, if the string \textsl{\~{}?} is used in the parameter.

If the current user is not authorized for interactive DCL, a warning message 
will be displayed.

\section{SPAWN}
\index{OMI commands!SPAWN}
\label{subsec:spawn}

\indent Format: \textbf{SPAWN \textit{dcl{\_}command}}\\*[3mm]
Spawn an interactive subprocess without leaving OMI. Any VMS command can 
optionally be given as a parameter. If the command is entered, control is 
returned to the calling process when the execution of the command is 
completed.

If the current user is not authorized for interactive DCL, a warning message 
will be displayed.\\[3mm]
\textbf{Parameter}\\*[3mm]
Enter any valid DCL command. If you omit a parameter, you will be prompted 
for the command.

When the command SPAWN is used in a menu file, OMI can prompt for additional 
input for the command, if the string \textsl{\~{}?} is used in the parameter.

\section{SUBMIT}
\index{OMI commands!SUBMIT}
\index{OMI mode!batch}
\label{subsec:submit}

\indent Format: \textbf{SUBMIT \textit{omi{\_}module}}\\*[3mm]
With this command, an OMI module can be started in the background. It works 
the same as using the qualifier \textsl{/BACKGROUND=BATCH} from the DCL 
prompt.

When starting a background process from the OMI prompt, a module can only be 
started as a batch job; not as a detached process. 

\vs

All defaults for the Submit command (batch queue, log file) are taken from 
the \textsl{[BGRPROCESS]} section in the user's configuration file.\\[3mm]
\textbf{Parameter}\\*[3mm]
The parameter is the name of the OMI module to start (\textit{name}.OMI). It has to be 
located in the \textsl{OMI{\$}MENU{\_}DIRECTORY:} search path. This module should be 
created to run unattended (e.g. using Mailboxes for communication).


\appendix
\chapter{Example OMI Menu}

This example is included in the distribution as \textsl{OMI{\$}EXAMPLE.MNU}.

\begin{verbatim}
[MENU_MENU]
  owner = system
  title = OMI Example Menu
  name  = Main                                  ! Menu name for shortcut
  item  = Print the menu file#command#silent_dcl print -
          /queue=~?{Printer queue:} /notify omi$:omi$example.mnu
                                                ! Print this menu file to read
                                                ! on paper what's happening.
  item  = Exit#command#exit                     ! Command item, EXIT the menu
  item  = Protected Menu#submenu#pwdtest        ! Submenu item, calls PWDTEST
  item  = Get some inputs#submenu#inptest       ! Submenu item, calls INPTEST
  item  = Counter menu#submenu#cnttest          ! Submenu item, calls CNTTEST

[MENU_PWDTEST]
  password = <90>Ë<8f>¼<8e>Ê<8d>Ë<8c><88><8b><89><8a><8a>Õ
! password_level = 2                            ! If not outcommented, nobody
                                                ! can change the password.
  name  = Protected                             ! Menu name for shortcut
  comment = This menu is password protected     ! Put a comment line on screen
  security = grant_me_write                     ! Define authorisation
  title = Dummy Menu                            ! Give this one another title
  item = Main Menu#command#back                 ! Command item, one level BACK


[MENU_INPTEST]
  name = Input                                  ! Menu name for shortcut
  on_exit = omi$example onexit                  ! Execute this module when
                                                ! leaving this submenu
  item = Main Menu#command#back                 ! Command item, one level BACK
  item = Formatted inputs#submenu#frmtest       ! Submenu item, calls FRMTEST
  item = Display the inputs#call#omi$example display
                                                ! Call a test procedure to
                                                ! display the inputs.
  item = Reset inputs#command#reset variables   ! Reset everythinh to default
  input = Select a weekday#{SEL|weekdays}inp_weekday#value1
                                                ! Select from a predefined
                                                ! list. Default is "Monday"
  input = Select some months#{TAG|months}inp_months
                                                ! Select one ore more months.
  input = Enter free input#{HIDDEN}inp_free     ! Free input, not shown on screen

[MENU_FRMTEST]
  name  = Format                                ! Menu name for shortcut
  item = Main Menu#command#main                 ! Command item, back to MAIN
  item = Previous Menu#command#back             ! Command item, one level BACK
  const = #const_session_start#call:omi$example set_const_value
                                                ! Constant initiated at startup
  input = Enter a date#inp_date#today#date_frm  ! Input item, should be a date
                                                ! Default is "TODAY"
  input = Enter a valid filename#inp_file##fname_frm
                                                ! Input item, should be a filename
  input = Enter an int between 0 and 100#inp_int##int_frm
                                                ! Input item, should be an integer

[MENU_CNTTEST]
  counter = just_a_counter                      ! Define a counter for this menu
  comment = The counter is now {counter$just_a_counter}
  name  = Counter1                              ! Menu name for shortcut
  item = Main Menu#command#back                 ! Command item, one level BACK
  item = More counters#submenu#cnttest2         ! Submenu item, calls CNTTEST2

[MENU_CNTTEST2]
  counter = another_counter                     ! Define a counter for this menu
  comment = The counter is now {counter$another_counter}
  name  = Counter2                              ! Menu name for shortcut
  item = Main Menu#command#main                 ! Command item, back to MAIN
  item = Previous Menu#command#back             ! Command item, one level BACK
  item = Reset the counter#command#reset counter
                                                ! Command item, RESET counter
  item = Increase the counter#command#increase refresh
                                                ! Command item, INCREASE counter
                                                ! followed by a screen refresh
                                                ! to update the comment line
  item = Display the arrays#command#dcl show symbol inp_array*
                                                ! Command item, call to DCL
                                                ! to display the inputs
  input = Enter anything#inp_arraya'counter$another_counter
  input = Select a day#{SEL|weekdays}inp_arrayb'counter$another_counter

[DATE_FRM]
  type = date                                   ! Input should be a valid date
  format = absolute                             ! Will be convert. to absolute

[FNAME_FRM]
  type = filespec                               ! Input should be of FILESPEC type
  wildcards = true                              ! Wildcards are allowed
  required = false                              ! The file does not have to exist

! The arguments below are from version 1.0b2, the FILESPEC type was implemented
! later, but with the arguments below, used in the STRING type, almost
! the same result can be reached.
! The arguments are outcommented in stead of remove, so they can remain here
! as an extra example.
!
!  upcase   = true                              ! String will be conver. to upcase
!  collapse = false                             ! All blanks will be removed
!  ivchars   = @#$%^&*()'?/|\+`~{}[]<>          ! These characters are not allowed


[INT_FRM]
  type = integer                                ! Input should be an integer
  min = 0                                       ! Input value should be between
  max = 100                                     !  '0' and '100'


[WEEKDAYS]
!
! Define the days of the week from which a selection can be made
! using the SEL input in the INPTEST menu (input1).
!
  value1 = Monday
  value2 = Tuesday
  value3 = Wednesday
  value4 = Thursday
  value5 = Friday
  value6 = Saturday
  value7 = Sunday

[MONTHS]
!
! Define the months that can be tagged using the TAG input in the
! INPTEST menu (input2).
!
  delimiter = /
  value1  = January
  value2  = February
  value3  = March
  value4  = April
  value5  = May
  value6  = June
  value7  = July
  value8  = August
  value9  = September
  value10 = October
  value11 = November
  value12 = December


[COUNTER]
  just_a_counter  = 0
  another_counter = 0

[GRANT_ME_WRITE]
!
! This security section was added, granting write privilege to my userid,
! to enable me to set a password on the PWDTEST menu, without the need
! to log in as SYSTEM (the owner of the menu)
!
  oscar     = write
  all_users = read, exec

<EOF>

The '<EOF>' above will be interpreted as an end-of-file. This means the
OMI will never read these lines. This is done to improve performance while
initializing; long comments can now be written past the end-of-file.
\end{verbatim}

\chapter{Example OMI Module}

This example is included in the distribution as \textsl{OMI{\$}EXAMPLE.OMI}.

\begin{verbatim}
$!	set message 'omi$_message'	! Uncomment this for debugging
$!
$!	Normally you'ld so some checking on the parameter...
$	if p2 .eqs. "SET_CONST_VALUE"
$	   then $ omi$default_value == f$cvtime(,"absolute", "time")
$	   else $ gosub 'p1' ! Call the requested subroutine.
$	endif
$	exit $status

$ display:
$!
$!	Setup the output records to show the inputs that were entered
$	omi$record1 = "This session started at ''const_session_start'"
$	omi$record2 = "The weekday you have selected was:"
$	omi$record3 = "  ''inp_weekday'"
$	omi$record4 = "The month(s) you have tagged were:"
$	_counter = 0
$	omi$check inp_months "" empty_allowed
$	if $status .ge. omi$_warning
$	   then 	! Month input was not yet selected
$		omi$record5 = "  <None>"
$		goto month$end_loop
$	endif
$!
$ month$_loop:
$!
$	_month = f$element(_counter, months$delimiter, inp_months)
$	if _month .eqs. "" .or. _month .eqs. months$delimiter then -
	   $ goto month$end_loop
$	_record = '_counter + 5
$	omi$record'_record = "  ''_month'"
$	_counter = _counter + 1
$	goto month$_loop
$!
$ month$end_loop:
$!
$	_counter = _counter + 4
$	omi$record'_counter = "Your free input was: ''inp_free'"
$!
$!	We got all output records, now display them
$	omi$display_info
$!
$!	Check if the user wants to see some more
$	omi$confirm "More ? " 'questions$answer_yes
$	if .not. omi$confirmed then $ goto end_display
$!
$!	He/she does... considering the fact we got this far.
$!	Fill some more records...
$	omi$record1 = " The date you entered was     : ''inp_date'"
$	omi$record2 = " The filename you entered was : ''inp_file'"
$	omi$reverse "''inp_file'" "''inp_date'"
$	omi$record3 = " Reversing this results in    : ''omi$reversed'"
$	omi$record4 = " The integer you entered was  : ''inp_int'"
$	omi$record5 = " You called the Counter menu ''counter$another_counter' times"
$!
$!	Make sure the list with months won't be redisplayed, starting with rec. 5
$	if f$type(omi$record6) .nes. "" then -
	   deletee/symbol/local omi$record5
$!
$!	... and display them
$	omi$display_info
$	omi$wait
$	omi$refresh
$!
$ end_display:
$!
$	return omi$_ok

$ onexit:
$!
$!	This routine is called when the user leaves the Inputs submenu
$!	Here we check if all inputs that have been enteres were reset.
$!	If not, we display a popup and confirm is the user wants to leave.
$	if inp_weekday .eqs. weekdays$value1 - ! The default value
	   .and. f$type(inp_months) .eqs. "" - ! Not set by default
	   .and. f$type(inp_free) .eqs. ""   - ! Not set by default
	   then $ return omi$_ok               ! Ok, everyhting was reset
$!
$	omi$popup "Please note the given input variables have not been reset" confirm,colorscheme=alert
$!
$!	If "N" is answered we get an omi$_warning status, otherwise omi$_ok.
$!	Just return the status; OMI will handle this and won't leave the menu
$!	if the status is not omi$_ok.
$	return $status
\end{verbatim}

\chapter{History}
\index{history}

\section*{Version x.x, Released: xx-xx-xxxx}

\begin{itemize}
\item Fix: set default values for \textsl{SELECT} lists in \textsl{OTF} menus properly
\item Introduced symbols for font- and color section (section \ref{subsection:fontcolors}).
\item Added the \textsl{COLORSCHEME} option to \textsl{OMI{\$}POPUP}
\item Added support for the \textsl{INFO} command in \textsl{OTF} menus
\item Configurable prompt for Tag- and Selectlists
\end{itemize}

\section*{Version 2.6, Released: 16-05-2019}

\begin{itemize}
\item Fix: \textsl{OMI{\$}CALCULATOR} did not pass the full calculation
\item Calculator results are now rounded
\item Added a CONFIRM option to \textsl{OMI{\$}POPUP}
\item Automatic numbering of items and inputs
\item Allow tag- and selectlist values to be set by a module
\item Allow default values for input items to be set by a module
\item Introduced the \textsl{CONST} element
\item Cosmetic: fix \textsl{\%DCL-W-UNDSYM} on exit in batchmode
\item Cosmetic: Don't messup the screen when a message is too long
\end{itemize}

\section*{Version 2.5, Released: 17-03-2019}

\begin{itemize}
\item Fix: Modules where not found if not located in the first index when \textsl{OMI{\$}MENU{\_}DIRECTORY} is a searchpath.
\item Fix: Find a given menu when the menu name is also a logical pointing somewhere else
\item Fix: Clear input when a format block returns an error or warning.
\item Dont't show \textsl{All input} when a menu has only one input-item
\item Use input descriptiont as prompt when \textsl{QUESTIONS{\$}INPUT} is not set
\item Moved the project to GitHub.
\end{itemize}

\section*{Version 2.4, Released: 04-10-2018}

\begin{itemize}
\item Added the \textsl{\{HIDDEN\}} option for free input types
\item Keep the current screen width and height when the value for \textsl{width}, \textsl{height} and/or \textsl{exit{\_}width} is set to \textsl{0} in the \textsl{[screen]} section.
\item Introduced \textsl{exit{\_}height} in the configuration file's \textsl{[screen]} section.
\item Search order for modules that are called without explicit path is now reversed: first check is in \textsl{OMI{\$}MENU{\_}DIRECTORY}, if not found look for the module in \textsl{OMI{\$}}.
\item Bugfix in the \textsl{INFO} command: clear textbuffers after display.
\item Bugfix in \textsl{TAG} inputs: entering negative values caused OMI to crash.
\end{itemize}

\section*{Version 2.3, Released: 25-06-2004}

\begin{itemize}
\item Added keywords \textsl{DCLERRORS} and \textsl{DCLFATALS} to the \textsl{/IGNORE} qualifier
\item The keyword \textsl{BLANKS} in \textsl{STRING} formatting type is now deprecated, it's replaced by \textsl{COLLAPSE}
\item Added the keyword \textsl{ALFANUM} in the \textsl{STRING} formatting type
\item Made the answers \textsl{Yes} and \textsl{No} configurable using the values \textsl{answer{\_}yes} and \textsl{answer{\_}no} in the \textsl{[questions]} section of the configuration file.\\
\textbf{NOTES:}
\begin{itemize}
\item The default answer when using \textsl{OMI{\$}CONFIRM} should be changed in your applications from \textsl{Y} to \textsl{'questions{\$}answer{\_}yes'}, and from \textsl{N} to \textsl{'questions{\$}answer{\_}no'} if you want to change the values in the configuration file as well.\\
See section \ref{subsubsec:mylabel46}.
\item The message \texttt{\%OMI-W-IVANS} now requires 2 parameters. If you use this message in your software, you will need to change it to:\\
\textsl{OMI{\$}SIGNAL OMI IVANS,QUESTIONS{\$}ANSWER{\_}YES,QUESTIONS{\$}ANSWER{\_}NO}
\end{itemize}
\item Bugfix the last page when scrolling select lists
\item Bugfix in the \textsl{INFO} command
\item Added the commands \textsl{CLS} and \textsl{OMI{\$}CLEAR{\_}SCREEN}
\item Added the option \textsl{NOWAIT} to the \textsl{OMI{\$}POPUP} command
\item Bugfix in reading \textsl{TAG}- and \textsl{SELECT} lists from a file; files where not found when they located in the \textsl{OMI{\$}MENU{\_}DIRECTORY} searchpath, but not in the first index.\\
This is because the VMS lexical \textsl{F{\$}PARSE()} expands to the first index only.
\item Allow submenus in on-the-fly menus
\item Added the error messages \texttt{OUTOFRA} and \texttt{PROOUTRA} that signals when an intermediate value in the calculator is or might be out of range.\\
This prevents random results when a temporary value exceeds the DCL limit (2,147,483,647)
\end{itemize}

\section*{Version 2.2, Released: 29-08-2002}

\begin{itemize}
\item Bugfix in \textsl{INTEGER} input type (new bug in 2.1)
\item Bugfix in \textsl{REQUIRED{\_}ORDER}
\item Bugfix in \textsl{OMI{\$}DISPLAY{\_}INFO}; couldn't handle double quotes
\item Several minor bugs and one major bug (possible loop in \textsl{REQUIRED{\_}ORDER}) where fixed by Edward Vlak, EDS. Thanks!
\item Fixed a bug in scrolling long \textsl{TAG} and \textsl{SELECT} lists
\item Added the command \textsl{RESET VARIABLES}
\item Added the option to call OMI commands i.s.o. modules in \textsl{ON{\_}INIT} and \textsl{ON{\_}EXIT}
\item \textsl{OMI{\$}MENU{\_}DIRECTORY} is now the default location for all modules
\item Added basic menu- specific help support using \textsl{.OMH} files and the new command \textsl{INFO}
\item Documented the OMI{\$}Manage menu
\item Bugfixes in the OMI{\$}Manage menu and standard OMI modules \textsl{LIST{\_}FILES.OMI} and \textsl{TYPE{\_}FILE.OMI}
\item Added the \textsl{/[NO]IGNORE} qualifier with keyword \textsl{DUPLICATES} to suppress \texttt{\%OMI-W-DUPL} messages.
\end{itemize}

\section*{Version 2.1, Released: 25-08-2001}

\begin{itemize}
\item Ignore \textsl{OMI{\$}WAIT} in Batch- mode
\item Bugfix in updating menu- files; when \textsl{OMI{\$}MENU{\_}DIRECTORY} is a search path, update commands always wrote the update menu file back in the first directory of the path.
\item Bugfix in the user installation procedure.
\item Restore the original VMS message state in spawned processes.
\item Added more checks when running with \textsl{/VALIDATE}.
\item Added support for leading values using the \textsl{{\#}LEADING} attribute in item names to make sure the leading value is used when an item is duplicate within a menu file and/or included library.
\item Removed the SQL toolbox that was never - and never will be - finished.
\item Changed the default file type for libraries to \textsl{.OML}.
\item Rewrote the installation procedure.
\item This was on my wish list for quite some time already: converted the manual from MSWord to \LaTeXe\, and completely reviewed the manual.
\end{itemize}

\section*{Version 2.0, Released: 22-06-1999}

\begin{itemize}
\item Extended the calculator to work with longer formulas and parentheses.
\item Added the \textsl{{\#}INCLUDE} directive to include standard libraries in menu files.
\item Added the \textsl{/BACKGROUND=(BATCH|DETACH)} qualifier to run an OMI module unattended as a batch- or detached process from the DCL prompt.
\item Implemented support for background jobs (batch only) using the \textsl{SUBMIT} command at the OMI prompt or \textsl{OMI{\$}SUBMIT} within modules.
\item Added some accompanying elements in the configuration file for background job support
\item Fixed a bug that caused the cursor to disappear when the \textsl{OMI{\$}WAIT }command was used and OMI was called with the \textsl{/BATCH} qualifier.
\item Fixed a bug in the \textsl{/JUMPS} causing a \texttt{\%DCL-W-UNDSYM} warning.
\item Some minor bugfixes in the message handling
\end{itemize}

\section*{Version 2.0b1, Released: 10-11-1998}

\begin{itemize}
\item Message files do not have to be located in the \textsl{OMI{\$}} directory anymore, but they can be stored in the search list \textsl{OMI{\$}MENU{\_}DIRECTORY}, where your applications are stored as well.\\
Messages files created with the \textsl{OMI{\$}MANAGE} menu are still created in \textsl{OMI{\$}:}, but they can be moved manually.
\item Implemented a simple calculator which can be called with the \textsl{CALC} command from the OMI prompt, and with the \textsl{OMI{\$}CALC} command from within OMI modules.
\item Implemented the \textsl{FLOAT} and \textsl{FLOAT{\_}POINT} elements for \textsl{INTEGER} input type, and support for a default value for \textsl{FLOAT{\_}POINT} in the configuration file.
\item Renamed the \textsl{SEPERATE{\_}INPUTS} element from the \textsl{[SCREEN]} section in the configuration file to \textsl{SEPARATE{\_}INPUTS} (forgive me my bad English :-/).
\item Fixed a bug from the \textsl{OMI{\$}CALL} command that occured when parameters contained blanks.
\item Added the \textsl{/VALIDATE[=logfile]} qualifier which signals the most common errors in menu files.
\item Added the \textsl{OMI{\$}POPUP} command to the default toolbox.
\item Added the \textsl{REQUIRED{\_}ORDER} menu element and the \textsl{RESET ORDER} and  \textsl{SHOW ORDER} commands.
\item Implemented the \textsl{TIME} format type.
\end{itemize}

\section*{Version 1.41, Released: 01-05-1998}

This release includes patch 1.4a. Other changes:
\begin{itemize}
\item The dollar-sign (\textsl{{\$}}) is now supported as a synonym for the OMI command \textsl{DCL}
\item Added the \textsl{CONFIRM} element to the configuration file (default is \textsl{TRUE})
\item Enhanced the \textsl{TEXTAREA} input format, and added the new commands \textsl{SHOW TEXTAREA} and \textsl{DELETE TEXTAREA}
\item Added validation and formatting options for dynamic input using format sections
\item Added multiple mailbox support, by allowing the logical name, which could only be \textsl{OMI{\$}MAILBOX} in previous versions, to be specified by a parameter. \textsl{OMI{\$}MAILBOX} is still the default value.
\end{itemize}

\section*{Version 1.4a, Released: 21-04-1998}
                                                                               
This version is distributed as a patch for v1.4, and fixes a bug in de command
element type using the DCL command 
The patch is still available as a 3 kB ascii file at
ftp://ftp.oveas.net/pub/oveas/omi/omi{\$}patch{\_}1-4a.com, but can only be used for
v1.4. If you still use this version, an upgrade is recommended.

\section*{Version 1.4, Released: 19-02-1998}

\begin{itemize}
\item Renamed the file \textsl{OMI{\$}CREATE{\_}HELPLIB.COM} to \textsl{OMI{\$}INSTALL.COM} which is a better name for what it does. \\
The old \textsl{OMI{\$}INSTALL.COM} is now called \textsl{OMI{\$}USER{\_}INSTALL.COM}.
\item The logical \textsl{OMI{\$}MENU{\_}DIRECTORY} can bow be a search list. The user specific file \textsl{OMI{\$}SETUP.COM} (created by \textsl{OMI{\$}USER{\_}INSTALL.COM}) now scans the given menu directory for subdirectories, and adds them all to the logical. By editing \textsl{OMI{\$}SETUP.COM} manually, more directories can be added.
\item Added the \textsl{[INTERACTIVE{\_}AUTH]} section support to prevent users from executing the \textsl{DCL} or \textsl{SPAWN} commands, except when these commands are called by a menu item.
\item Added the \textsl{AUTO{\_}REFRESH} menu element, and the \textsl{(RE)SET AUTO{\_}REFRESH} command
\item Added qualifier support with the following qualifiers:
\begin{itemize}
\item \textsl{/[NO]DEBUG}
\item \textsl{/[NO]BATCH}
\item \textsl{/SUBMENU=menu-name}
\item \textsl{/JUMPS=option-list}
\item \textsl{/[NO]PROGRESS}
\end{itemize}
\end{itemize}

\section*{Version 1.3, Released: 19-11-1997}

\begin{itemize}
\item Added multiple key support for encryption, using a user specific keyring, stored in the configuration file, and a global keyring, to and from which keys can be exported and imported with the new commands \textsl{EXPORT KEY} and \textsl{IMPORT KEY}
\item Added support for on-the-fly menus
\item Added the \textsl{NOEXIT{\_}MODULE} option in the \textsl{BACK} command
\item The \textsl{BACK} command and option \textsl{0} don't exit the menu anymore when at the toplevel. \lt Ctrl/Z\gt{} still does.
\item Fixed a bug for \textsl{ON{\_}INIT} and \textsl{ON{\_}EXIT} elements using parameters where the file type was not specified
\item Fixed a bug in the \textsl{TEXTAREA} input field that occured when the logical \textsl{OMI{\$}MENU{\_}DIRECORY} is not defined
\item Added the \textsl{FIXED} option for \textsl{TEXTAREA} input types
\item Added the \textsl{ELEMENT} and \textsl{MENU{\_}FILE} options to the \textsl{EDIT} command
\item Added the option to have Tag- and Select lists retrieve their values from a file, and the \textsl{EDIT VALUE{\_}FILE} command to enable (privileged) users to maintain those files
\item Added the \textsl{PRINTER} element to the section MAIN in the configuration file
\item Added the module command \textsl{OMI{\$}DUMP{\_}INFO}
\item Added the module command \textsl{OMI{\$}GET{\_}VMSMESSAGE}
\item Added the \textsl{SHOW VMS{\_}MESSAGE} command
\item Added the question mark option for the \textsl{MENU} command, and the listing of all available menus when OMI is started without a menu, or with an invalid menu.
\item Added the symbols \textsl{OMI{\$}OPTION} and \textsl{OMI{\$}OPTION{\_}TYPE} to the internal symbol list.
\end{itemize}

\section*{Version 1.2, Released: 10-09-1997}

\begin{itemize}
\item Added the \textsl{TEXTAREA} format type.
\item The elements \textsl{ON{\_}INIT} and \textsl{ON{\_}EXIT} now work for all menu levels, and will also be executed when the \textsl{MENU} command is entered.
\item Modified the \textsl{HELP} command so it now accepts topics that were entered as a parameter on the OMI prompt
\item Added the \textsl{FDEVICE}, \textsl{FDIRECTORY} and \textsl{FTYPE} keywords to the \textsl{FILESPEC} format type, to specify default attributes for files.
\item Added the possability to let lines in the menu- and configuration files span more lines, using the dash (-) to continue on the next line.
\item Implemented a new message handler, and added the command \textsl{OMI{\$}SIGNAL} to call this handler in OMI modules.
\item Added the module command \textsl{OMI{\$}SUBSTITUTE}
\item Fixed the default values for stack variables, after every increase, the variables using counters will now get their default value.
\item Fixed the bug that did not allow the user to cancel dynamic input (\textsl{~?}) with \lt Ctrl/Z\gt.
\item Fixed the bug due to which the Auto Mode did not work for Dynamic Menus.
\item Added the \textsl{SET WIDTH} command.
\item Added the \textsl{OMI{\$}CALL} command, which can be used to call standard modules from OMI modules.
\item Added the \textsl{PROMPT} element to the menu sections, to allow different prompts for all menu levels.
\item OMI now displays the percentage of lines read from the menu file during initialization. This is usefull for large menu files.
\item Added the \textsl{SHOW{\_}PROGRESS} and \textsl{PROTECT{\_}PROMPT} elements to the configuration file.
\item Removed the \textsl{VERSION{\_}ID} from the configuration file. This element is now obsolete.
\end{itemize}

\section*{Version 1.1, Released: 21-06-1997}

\begin{itemize}
\item Fixed a bug due to which the logical \textsl{OMI{\$}CONFIG} was overwritten,
\item Added a proper error message when there are more items in a menu than can fit on the screen, in stead of running out of the screen.
\item Added a proper error message when a tag- list is too long to fit on one screen in stead of running out of the screen.
\item Fixed a bug in the tag lists which would display no than one value per column when more than two columns are required.
\item Added the \textsl{NEXT} and \textsl{PREVIOUS} commands in the Select list option, due to which selections can now be made from multiple screens.
\item Added defaults to the configuration settings, so not not all fields in the configuration file are required.
\item Added checks in the configuration routine to encounter duplicate items. The user will now be prompted to ask if an existing item should be overwritten.
\item Again, implemented a new encryption method, using keys, since I expect everybody who tried hard enough found the encryption method by now. The new method can still decrypt strings encrypted with v1.0b3 and up.
\item Changed the password prompt for password protected menus so when an invalid password is given the user can retry it, three times in total.
\item Added intrusion settings when the same user entered an invalid password on the same menu for nine times during one session.
\item Added the \textsl{SET KEY} command.
\item Changed the default prompt to \texttt{OMI\gt}.
\end{itemize}

\section*{Version 1.0, Released: 30-05-1997}

\begin{itemize}
\item Added the option to specify a parameter for \textsl{OMI{\$}DATE{\_}INFO}, which enables date information for other dates. Default is 'today'.
\item Fixed a bug in \textsl{OMI{\$}DATE{\_}INFO}, which miscalculates after september.
\item Some minor documentation bugs in the \textsl{HELP} file fixed.
\end{itemize}

\section*{Version 1.0b4, Released: 13-05-1997}

\begin{itemize}
\item Bugfix for the \texttt{\%DCL-W-UNDSYM} error on password protected menus.
\item Implemented the \textsl{ASK} command.
\item Implemented the \textsl{OMI{\$}INPUT{\_}VALIDATE} command, that fixes a possible bug when a user enteres \textsl{''F{\$}PID(GOTO)'} as input.\\
Thanks to Henry Juengst (juengst@saph1.iskp.uni-bonn.de) for making me aware of this.
\end{itemize}

\section*{Version 1.0b3, Released: 09-05-1997}

\begin{itemize}
\item Fixed a security bug; a security block in the main menu wasn't properly handled.
\item Added the \textsl{QUIT} command as a synonym for \textsl{EXIT}.
\item Added extra parameters to select a submenu by name and the options immediatly from the DCL command line when starting OMI, and the \textsl{JUMP} command.
\item Moved most extra options (like the encryption module and the \textsl{OMI{\$}CHECK} command) to the newly created \textsl{OMI{\$}TOOLBOX.COM}.
\item Added the commands \textsl{OMI{\$}CREATE{\_}MBX}, \textsl{OMI{\$}ENCRYPT}, \textsl{OMI{\$}DECRYPT} and \textsl{OMI{\$}REVERSE}.
\item Added the \textsl{FILESPEC} format type.
\item Enhanced the encryption method, which is incompatible with the encryption of v1.0b2.\\
\textbf{NOTE:} Due to this, password checks will now fail if the password was set with an older release. The password value needs to be removed manually from the MNU file, after which it will default to 'Omi{\$}System'. It can then be set again with the \textsl{SET PASSWORD} command.
\item Added the \textsl{\lt EOF\gt} identifier for menu and config files.
\item Added the \textsl{ENCRYPT} command.
\end{itemize}

\section*{Version 1.0b2, Released: 15-04-1997}

\begin{itemize}
\item Added type definitions for the input items.
\item Added tag lists
\item Added the \textsl{CALL} item- type and several commands that can be used by modules.
\item Added the free option in select lists.
\end{itemize}

\section*{Version 1.0b1, Date: 14-03-1997  (not released)}

Added dynamic menu's, counters, OMI commands \textsl{SET}, \textsl{RESET} and \textsl{SHOW}, implemented the version number, the comment field and the password option.

\section*{Version 0.0, Date: 11-03-1997  (not released)}

Initial release, containing submenus, commands with input option, free inputs and selection lists.

\section*{OMB -- Oscar's Menu Builder (1990-1995)}
\index{OMI!predecessor}

OMB was OMI's predecessor I wrote and maintained in the early 90's. It was meant for private use only... and for the fun of it of course ;)

\newpage
\addcontentsline{toc}{chapter}{Index}
\printindex

\end{document}
